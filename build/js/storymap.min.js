function SlideBar(i){const d={maxSlides:10,slideIconRegex:/^slide-icon-\w+$/,slidesContainerId:"#slidesContainer",slideListId:"#slideList",addSlideButton:"#storymap_add_slide"};this.options=$.extend(!0,{},d,i),this.addEvents(),this.addSlide()}SlideBar.prototype.addEvents=function(){const i=this;$(i.options.addSlideButton).click(()=>{i.addSlide()})},SlideBar.prototype.addSlide=function(){const i=this,d=new SlideIcon;d.appendTo(this.options.slideListId),$(d).on("Slide:deleted",(d,e)=>{i.removeSlide(e)}),$(this.options.slidesContainerId).scrollTop(Math.max(0,$(this.options.slideListId).height()-$(this.options.slideListId).parent().height())),d.clicked()},SlideBar.prototype.removeSlide=function(i){$(`${this.options.slideListId} li:nth-child(${i+1})`).remove()};
function SlideIcon(e){const t={text:"",templateId:"#storymap_slide_template",slideClass:".slide"};this.options=$.extend(!0,{},t,e),this.template=_.template($(this.options.templateId).html().trim()),this.slideDOMElem=$(this.template(this.options)),this.deleteDOMElem=$('<a class="close" href="javascript:">&nbsp;</a>'),this.addEvents()}SlideIcon.prototype.addEvents=function(){const e=this;e.slideDOMElem.click(()=>{e.clicked()}),e.deleteDOMElem.click(()=>{e.deleteButtonPressed()})},SlideIcon.prototype.clicked=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);return $(":focus").blur(),$(`${this.options.slideClass}.selected`).removeClass("selected"),$(e.slideDOMElem).addClass("selected"),$(e).trigger("Slide:selected",[t]),!1},SlideIcon.prototype.deleteButtonPressed=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);$(e).trigger("Slide:deleted",[t])},SlideIcon.prototype.appendTo=function(e){this.slideDOMElem.appendTo(e),this.deleteDOMElem.appendTo(this.slideDOMElem)};
function SlideInfo(t,o){const n={urlLoadButtonId:"#storymap_load",urlClearButtonId:"#storymap_unload",infoButtonId:"#obrir_menu",saveSlideButtonId:"#storymap_save_slide",urlInputId:"#urlMap",titolInputId:"#urlMap",textInputId:"#summernote",iFrameId:"#instamapsMap",iFrameContainerId:"#mapaFrame",dataContainerId:"#dataSection",defaultUrl:"https://www.instamaps.cat/geocatweb/visor.html"};this.options=$.extend(!0,{},n,o),this.addEvents(),$(this.options.textInputId).summernote()}SlideInfo.prototype.addEvents=function(){const t=this;$(t.options.urlLoadButtonId).on("click",()=>{const o=$(t.options.urlInputId).val();$(t.options.iFrameId).attr("src",o)}),$(t.options.urlClearButtonId).on("click",()=>{$(t.options.urlInputId).val(""),$(t.options.iFrameId).attr("src",t.options.defaultUrl)}),$(t.options.infoButtonId).on("click",()=>{$(t.options.iFrameContainerId).hasClass("expanded")?($(t.options.iFrameContainerId).removeClass("expanded"),$(t.options.dataContainerId).hide()):($(t.options.iFrameContainerId).addClass("expanded"),$(t.options.dataContainerId).show())}),$(t.options.saveSlideButtonId).on("click",()=>{$(this).trigger("SlideInfo:saveSlidePressed")})},SlideInfo.prototype.getURL=function(){return $(this.options.urlInputId).val()},SlideInfo.prototype.getTitol=function(){return $(this.options.titolInputId).val()},SlideInfo.prototype.getDescripcio=function(){return $(this.options.textInputId).summernote("click")},SlideInfo.prototype.reset=function(){$(this.options.iFrameId).src="http://www.instamaps.cat/geocatweb/visor.html",$(this.options.urlInputId).val(""),$(this.options.titolInputId).val(""),$(this.options.textInputId).summernote("click","")};
function StoryMap(e){const i={language:"en",slideIconRegex:/^slide-icon-\w+$/,slideTemplate:"#storymap_slide_template",maxSlides:10,strings:{en:{maxSlides:"Maximum number of slides reached"},ca:{maxSlides:"Màxim número de slides assolit"},es:{maxSlides:"Has llegado al número máximo de slides"}}};this.options=$.extend(!0,{},i,e),this._currentSlideIndex=-1,this._storyMapData=null,this.slides=null,this.idEditor="",this.idStoryMap="",this.slideBar=new SlideBar,this.slideInfoPanel=new SlideInfo,this.server=new StoryMapServer,this.addEvents()}StoryMap.prototype.addEvents=function(){const e=this;$(e.slideInfoPanel).on("SlideInfo:saveSlidePressed",()=>{e.saveSlide()})},StoryMap.prototype.saveSlide=function(){const e={id:this.slides.length,url_mapa:this.slideInfoPanel.getURL(),titol:this.slideInfoPanel.getTitol(),descripcio:this.slideInfoPanel.getDescricio()};this.slides.push(e),this.save().then(()=>{this.slideInfoPanel.reset()})},StoryMap.prototype.addSlide=function(){const e=$.extend(!0,{},this.options.slideData);if(this._slides.length===this.options.maxSlides)alert(this.options.strings[this.options.language].maxSlides);else{this._slides.push(e),$(this).trigger("StoryMap:changed");const i=this.slideBar.addSlide(e);i.on("SlideBar:slideSelected",this._slideSelected),i.on("SlideBar:deleteSlidePressed",this._slideDeletePressed)}},StoryMap.prototype._slideSelected=function(e,i){if(null!=this.slides){const e=this.slides[i];alert(e)}},StoryMap.prototype._slideDeletePressed=function(e,i){const t=this._slides[i],s=t.text?t.text.headline||"(untitled)":"(untitled)";this.showConfirm(`Delete "${s}" slide?`,this.options.slideElem,i)},StoryMap.prototype.save=function(){const e=$.Deferred();return""!==this.idStoryMap?""===this.idEditor?this.server.editMapSlides(this.idStoryMap).then(function(i){this.idEditor=i.id_editor,this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()})},()=>{e.reject()}):this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()}):this.server.newMapSlides(JSON.stringify(this.slides)).then(i=>{this.idStoryMap=i.id,this.idEditor=i.id_editor,e.resolve()},()=>{e.reject()}),e.promise()},StoryMap.prototype.load=function(e){this.idEditor=e,this.server.editMapSlides(e).then(e=>{this.slides=JSON.parse(e.slides)})},StoryMap.prototype.show_confirm=function(){};
function StoryMapServer(t){const e={urlStoryMap:"http://172.70.1.32/storymaps/"};this.options=$.extend(!0,{},e,t)}StoryMapServer.prototype.getMapSlides=function(t){return $.ajax({method:"GET",url:this.options.urlStoryMap+t})},StoryMapServer.prototype.editMapSlides=function(t){return $.ajax({method:"GET",url:`${this.options.urlStoryMap}edit/${t}`,async:!1}).responseText},StoryMapServer.prototype.newMapSlides=function(t){return $.ajax({method:"POST",url:`${this.options.urlStoryMap}edit/`,dataType:"json",data:{id:0,id_editor:0,slides:t}})},StoryMapServer.prototype.updateMapSlides=function(t,e,o){return $.ajax({method:"PUT",url:`${this.options.urlStoryMap}edit/${t}`,dataType:"json",data:{id:e,id_editor:t,slides:o}})},StoryMapServer.prototype.deleteMapSlides=function(t,e){$.ajax({method:"DELETE",url:`${this.options.urlStoryMap}edit/${t}/${e}`,contentType:"application/json"}).done(()=>{})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNsaWRlQmFyLmpzIiwic2xpZGVJY29uLmpzIiwic2xpZGVJbmZvLmpzIiwic3RvcnlNYXAuanMiLCJzdG9yeU1hcFNlcnZlci5qcyJdLCJuYW1lcyI6WyJTbGlkZUJhciIsIm9wdGlvbnMiLCJfZGVmYXVsdE9wdGlvbnMiLCJtYXhTbGlkZXMiLCJzbGlkZUljb25SZWdleCIsInNsaWRlc0NvbnRhaW5lcklkIiwic2xpZGVMaXN0SWQiLCJhZGRTbGlkZUJ1dHRvbiIsInRoaXMiLCIkIiwiZXh0ZW5kIiwiYWRkRXZlbnRzIiwiYWRkU2xpZGUiLCJwcm90b3R5cGUiLCJzZWxmIiwiY2xpY2siLCJzbGlkZSIsIlNsaWRlSWNvbiIsImFwcGVuZFRvIiwib24iLCJldmVudCIsImlkIiwicmVtb3ZlU2xpZGUiLCJzY3JvbGxUb3AiLCJNYXRoIiwibWF4IiwiaGVpZ2h0IiwicGFyZW50IiwiY2xpY2tlZCIsInJlbW92ZSIsInRleHQiLCJ0ZW1wbGF0ZUlkIiwic2xpZGVDbGFzcyIsInRlbXBsYXRlIiwiXyIsImh0bWwiLCJ0cmltIiwic2xpZGVET01FbGVtIiwiZGVsZXRlRE9NRWxlbSIsImRlbGV0ZUJ1dHRvblByZXNzZWQiLCJjdXJyZW50U2xpZGVJbmRleCIsImluZGV4IiwiYmx1ciIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJ0cmlnZ2VyIiwiU2xpZGVJbmZvIiwidXJsTG9hZEJ1dHRvbklkIiwidXJsQ2xlYXJCdXR0b25JZCIsImluZm9CdXR0b25JZCIsInNhdmVTbGlkZUJ1dHRvbklkIiwidXJsSW5wdXRJZCIsInRpdG9sSW5wdXRJZCIsInRleHRJbnB1dElkIiwiaUZyYW1lSWQiLCJpRnJhbWVDb250YWluZXJJZCIsImRhdGFDb250YWluZXJJZCIsImRlZmF1bHRVcmwiLCJzdW1tZXJub3RlIiwidXJsIiwidmFsIiwiYXR0ciIsImhhc0NsYXNzIiwiaGlkZSIsInNob3ciLCJnZXRVUkwiLCJnZXRUaXRvbCIsImdldERlc2NyaXBjaW8iLCJyZXNldCIsInNyYyIsIlN0b3J5TWFwIiwibGFuZ3VhZ2UiLCJzbGlkZVRlbXBsYXRlIiwic3RyaW5ncyIsImVuIiwiY2EiLCJlcyIsIl9jdXJyZW50U2xpZGVJbmRleCIsIl9zdG9yeU1hcERhdGEiLCJzbGlkZXMiLCJpZEVkaXRvciIsImlkU3RvcnlNYXAiLCJzbGlkZUJhciIsInNsaWRlSW5mb1BhbmVsIiwic2VydmVyIiwiU3RvcnlNYXBTZXJ2ZXIiLCJzYXZlU2xpZGUiLCJsZW5ndGgiLCJ1cmxfbWFwYSIsInRpdG9sIiwiZGVzY3JpcGNpbyIsImdldERlc2NyaWNpbyIsInB1c2giLCJzYXZlIiwidGhlbiIsImRlZmF1bHREYXRhIiwic2xpZGVEYXRhIiwiX3NsaWRlcyIsImFsZXJ0IiwiX3NsaWRlU2VsZWN0ZWQiLCJfc2xpZGVEZWxldGVQcmVzc2VkIiwiY3VycmVudFNsaWRlIiwiZGF0YSIsInNsaWRlVGl0bGUiLCJoZWFkbGluZSIsInNob3dDb25maXJtIiwic2xpZGVFbGVtIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImVkaXRNYXBTbGlkZXMiLCJyZXN1bHRzIiwiaWRfZWRpdG9yIiwidXBkYXRlTWFwU2xpZGVzIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc29sdmUiLCJyZWplY3QiLCJuZXdNYXBTbGlkZXMiLCJwcm9taXNlIiwibG9hZCIsInBhcnNlIiwic2hvd19jb25maXJtIiwidXJsU3RvcnlNYXAiLCJnZXRNYXBTbGlkZXMiLCJpZE1hcGEiLCJhamF4IiwibWV0aG9kIiwiaWRNYXBhRWRpdGluZyIsImFzeW5jIiwicmVzcG9uc2VUZXh0IiwianNvblNsaWRlcyIsImRhdGFUeXBlIiwiZGVsZXRlTWFwU2xpZGVzIiwiY29udGVudFR5cGUiLCJkb25lIl0sIm1hcHBpbmdzIjoiQUFFQSxTQUFTQSxTQUFTQyxHQUVqQixNQUFNQyxHQUNMQyxVQUFXLEdBQ1hDLGVBQWdCLG1CQUNoQkMsa0JBQW1CLG1CQUNuQkMsWUFBYSxhQUNiQyxlQUFnQix1QkFJakJDLEtBQUtQLFFBQVVRLEVBQUVDLFFBQU8s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T0FBUSxTQUNSbkUsT0FBUW5ELEtBQUtQLFFBQVF5SCxtQkFBbUJLLEtBQWlCSCxJQUN6RFMsWUFBYSxxQkFHWkMsS0FBSyIsImZpbGUiOiJzdG9yeW1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgJCwgU2xpZGVJY29uKi9cblxuZnVuY3Rpb24gU2xpZGVCYXIob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblx0XHRtYXhTbGlkZXM6IDEwLFxuXHRcdHNsaWRlSWNvblJlZ2V4OiAvXnNsaWRlLWljb24tXFx3KyQvLFxuXHRcdHNsaWRlc0NvbnRhaW5lcklkOiBcIiNzbGlkZXNDb250YWluZXJcIixcblx0XHRzbGlkZUxpc3RJZDogXCIjc2xpZGVMaXN0XCIsXG5cdFx0YWRkU2xpZGVCdXR0b246IFwiI3N0b3J5bWFwX2FkZF9zbGlkZVwiLFxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblx0dGhpcy5hZGRTbGlkZSgpO1xuXG59XG5cblNsaWRlQmFyLnByb3RvdHlwZS5hZGRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0JChzZWxmLm9wdGlvbnMuYWRkU2xpZGVCdXR0b24pLmNsaWNrKCgpID0+IHtcblxuXHRcdHNlbGYuYWRkU2xpZGUoKTtcblxuXHR9KTtcblxufTtcblxuU2xpZGVCYXIucHJvdG90eXBlLmFkZFNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdGNvbnN0IHNsaWRlID0gbmV3IFNsaWRlSWNvbigpO1xuXHRzbGlkZS5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpO1xuXHQkKHNsaWRlKS5vbihcIlNsaWRlOmRlbGV0ZWRcIiwgKGV2ZW50LCBpZCkgPT4ge1xuXG5cdFx0c2VsZi5yZW1vdmVTbGlkZShpZCk7XG5cblx0fSk7XG5cdCQodGhpcy5vcHRpb25zLnNsaWRlc0NvbnRhaW5lcklkKS5zY3JvbGxUb3AoTWF0aC5tYXgoMCwgJCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpLmhlaWdodCgpIC1cblx0XHQkKHRoaXMub3B0aW9ucy5zbGlkZUxpc3RJZCkucGFyZW50KCkuaGVpZ2h0KCkpKTtcblx0c2xpZGUuY2xpY2tlZCgpO1xuXG59O1xuXG5TbGlkZUJhci5wcm90b3R5cGUucmVtb3ZlU2xpZGUgPSBmdW5jdGlvbiAoaWQpIHtcblxuXHQkKGAke3RoaXMub3B0aW9ucy5zbGlkZUxpc3RJZH0gbGk6bnRoLWNoaWxkKCR7aWQgKyAxfSlgKS5yZW1vdmUoKTtcblxufTtcbiIsIi8qIGdsb2JhbCAkLCBfKi9cblxuZnVuY3Rpb24gU2xpZGVJY29uKG9wdGlvbnMpIHtcblxuXHRjb25zdCBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR0ZXh0OiBcIlwiLFxuXHRcdHRlbXBsYXRlSWQ6IFwiI3N0b3J5bWFwX3NsaWRlX3RlbXBsYXRlXCIsXG5cdFx0c2xpZGVDbGFzczogXCIuc2xpZGVcIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQodGhpcy5vcHRpb25zLnRlbXBsYXRlSWQpLmh0bWwoKS50cmltKCkpO1xuXHR0aGlzLnNsaWRlRE9NRWxlbSA9ICQodGhpcy50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMpKTtcblx0dGhpcy5kZWxldGVET01FbGVtID0gJChcIjxhIGNsYXNzPVxcXCJjbG9zZVxcXCIgaHJlZj1cXFwiamF2YXNjcmlwdDpcXFwiPiZuYnNwOzwvYT5cIik7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxufVxuXG5TbGlkZUljb24ucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRzZWxmLnNsaWRlRE9NRWxlbS5jbGljaygoKSA9PiB7XG5cblx0XHRzZWxmLmNsaWNrZWQoKTtcblxuXHR9KTtcblx0c2VsZi5kZWxldGVET01FbGVtLmNsaWNrKCgpID0+IHtcblxuXHRcdHNlbGYuZGVsZXRlQnV0dG9uUHJlc3NlZCgpO1xuXG5cdH0pO1xuXG59O1xuXG5TbGlkZUljb24ucHJvdG90eXBlLmNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0Y29uc3QgY3VycmVudFNsaWRlSW5kZXggPSAkKHNlbGYub3B0aW9ucy5zbGlkZUNsYXNzKS5pbmRleChzZWxmLnNsaWRlRE9NRWxlbSk7XG5cdCQoXCI6Zm9jdXNcIikuYmx1cigpOyAvLyBmb3JjZSBjaGFuZ2UgZXZlbnQhXG5cblx0JChgJHt0aGlzLm9wdGlvbnMuc2xpZGVDbGFzc30uc2VsZWN0ZWRgKS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpO1xuXHQkKHNlbGYuc2xpZGVET01FbGVtKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuXG5cdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlOnNlbGVjdGVkXCIsIFtjdXJyZW50U2xpZGVJbmRleF0pO1xuXG5cdHJldHVybiBmYWxzZTtcblxufTtcblxuU2xpZGVJY29uLnByb3RvdHlwZS5kZWxldGVCdXR0b25QcmVzc2VkID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdGNvbnN0IGN1cnJlbnRTbGlkZUluZGV4ID0gJChzZWxmLm9wdGlvbnMuc2xpZGVDbGFzcykuaW5kZXgoc2VsZi5zbGlkZURPTUVsZW0pO1xuXHQkKHNlbGYpLnRyaWdnZXIoXCJTbGlkZTpkZWxldGVkXCIsIFtjdXJyZW50U2xpZGVJbmRleF0pO1xuXG59O1xuXG5TbGlkZUljb24ucHJvdG90eXBlLmFwcGVuZFRvID0gZnVuY3Rpb24gKGlkKSB7XG5cblx0dGhpcy5zbGlkZURPTUVsZW0uYXBwZW5kVG8oaWQpO1xuXHR0aGlzLmRlbGV0ZURPTUVsZW0uYXBwZW5kVG8odGhpcy5zbGlkZURPTUVsZW0pO1xuXG59O1xuIiwiLyogZ2xvYmFsICQqL1xuXG5mdW5jdGlvbiBTbGlkZUluZm8oaW5kZXgsIG9wdGlvbnMpIHtcblxuXHRjb25zdCBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR1cmxMb2FkQnV0dG9uSWQ6IFwiI3N0b3J5bWFwX2xvYWRcIixcblx0XHR1cmxDbGVhckJ1dHRvbklkOiBcIiNzdG9yeW1hcF91bmxvYWRcIixcblx0XHRpbmZvQnV0dG9uSWQ6IFwiI29icmlyX21lbnVcIixcblx0XHRzYXZlU2xpZGVCdXR0b25JZDogXCIjc3RvcnltYXBfc2F2ZV9zbGlkZVwiLFxuXHRcdHVybElucHV0SWQ6IFwiI3VybE1hcFwiLFxuXHRcdHRpdG9sSW5wdXRJZDogXCIjdXJsTWFwXCIsXG5cdFx0dGV4dElucHV0SWQ6IFwiI3N1bW1lcm5vdGVcIixcblx0XHRpRnJhbWVJZDogXCIjaW5zdGFtYXBzTWFwXCIsXG5cdFx0aUZyYW1lQ29udGFpbmVySWQ6IFwiI21hcGFGcmFtZVwiLFxuXHRcdGRhdGFDb250YWluZXJJZDogXCIjZGF0YVNlY3Rpb25cIixcblx0XHRkZWZhdWx0VXJsOiBcImh0dHBzOi8vd3d3Lmluc3RhbWFwcy5jYXQvZ2VvY2F0d2ViL3Zpc29yLmh0bWxcIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMuYWRkRXZlbnRzKCk7XG5cblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoKTtcblxufVxuXG5TbGlkZUluZm8ucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy51cmxMb2FkQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0Y29uc3QgdXJsID0gJChzZWxmLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKCk7XG5cdFx0JChzZWxmLm9wdGlvbnMuaUZyYW1lSWQpLmF0dHIoXCJzcmNcIiwgdXJsKTtcblxuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy51cmxDbGVhckJ1dHRvbklkKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdCQoc2VsZi5vcHRpb25zLnVybElucHV0SWQpLnZhbChcIlwiKTtcblx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVJZCkuYXR0cihcInNyY1wiLCBzZWxmLm9wdGlvbnMuZGVmYXVsdFVybCk7XG5cblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMuaW5mb0J1dHRvbklkKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdGlmICgkKHNlbGYub3B0aW9ucy5pRnJhbWVDb250YWluZXJJZCkuaGFzQ2xhc3MoXCJleHBhbmRlZFwiKSkge1xuXG5cdFx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVDb250YWluZXJJZCkucmVtb3ZlQ2xhc3MoXCJleHBhbmRlZFwiKTtcblx0XHRcdCQoc2VsZi5vcHRpb25zLmRhdGFDb250YWluZXJJZCkuaGlkZSgpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0JChzZWxmLm9wdGlvbnMuaUZyYW1lQ29udGFpbmVySWQpLmFkZENsYXNzKFwiZXhwYW5kZWRcIik7XG5cdFx0XHQkKHNlbGYub3B0aW9ucy5kYXRhQ29udGFpbmVySWQpLnNob3coKTtcblxuXHRcdH1cblxuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5zYXZlU2xpZGVCdXR0b25JZCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJTbGlkZUluZm86c2F2ZVNsaWRlUHJlc3NlZFwiKTtcblxuXHR9KTtcblxufTtcblxuU2xpZGVJbmZvLnByb3RvdHlwZS5nZXRVUkwgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbCgpO1xuXG59O1xuXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldFRpdG9sID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy50aXRvbElucHV0SWQpLnZhbCgpO1xuXG59O1xuXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldERlc2NyaXBjaW8gPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnRleHRJbnB1dElkKS5zdW1tZXJub3RlKFwiY2xpY2tcIik7XG5cbn07XG5cblNsaWRlSW5mby5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuaUZyYW1lSWQpLnNyYyA9IFwiaHR0cDovL3d3dy5pbnN0YW1hcHMuY2F0L2dlb2NhdHdlYi92aXNvci5odG1sXCI7XG5cdCQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbChcIlwiKTtcblx0JCh0aGlzLm9wdGlvbnMudGl0b2xJbnB1dElkKS52YWwoXCJcIik7XG5cdCQodGhpcy5vcHRpb25zLnRleHRJbnB1dElkKS5zdW1tZXJub3RlKFwiY2xpY2tcIiwgXCJcIik7XG5cbn07XG4iLCIvKiBnbG9iYWwgJCwgYWxlcnQsIFNsaWRlQmFyLCBTbGlkZUluZm8sIFN0b3J5TWFwU2VydmVyKi9cblxuZnVuY3Rpb24gU3RvcnlNYXAob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdGxhbmd1YWdlOiBcImVuXCIsXG5cdFx0c2xpZGVJY29uUmVnZXg6IC9ec2xpZGUtaWNvbi1cXHcrJC8sXG5cdFx0c2xpZGVUZW1wbGF0ZTogXCIjc3RvcnltYXBfc2xpZGVfdGVtcGxhdGVcIixcblx0XHRtYXhTbGlkZXM6IDEwLFxuXHRcdHN0cmluZ3M6IHtcblx0XHRcdGVuOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJNYXhpbXVtIG51bWJlciBvZiBzbGlkZXMgcmVhY2hlZFwiLFxuXHRcdFx0fSxcblx0XHRcdGNhOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJNw6B4aW0gbsO6bWVybyBkZSBzbGlkZXMgYXNzb2xpdFwiLFxuXHRcdFx0fSxcblx0XHRcdGVzOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJIYXMgbGxlZ2FkbyBhbCBuw7ptZXJvIG3DoXhpbW8gZGUgc2xpZGVzXCIsXG5cdFx0XHR9LFxuXHRcdH0sXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuXHR0aGlzLl9jdXJyZW50U2xpZGVJbmRleCA9IC0xO1xuXHR0aGlzLl9zdG9yeU1hcERhdGEgPSBudWxsO1xuXHR0aGlzLnNsaWRlcyA9IG51bGw7XG5cdHRoaXMuaWRFZGl0b3IgPSBcIlwiO1xuXHR0aGlzLmlkU3RvcnlNYXAgPSBcIlwiO1xuXHR0aGlzLnNsaWRlQmFyID0gbmV3IFNsaWRlQmFyKCk7XG5cdHRoaXMuc2xpZGVJbmZvUGFuZWwgPSBuZXcgU2xpZGVJbmZvKCk7XG5cdHRoaXMuc2VydmVyID0gbmV3IFN0b3J5TWFwU2VydmVyKCk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxufVxuXG5TdG9yeU1hcC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdCQoc2VsZi5zbGlkZUluZm9QYW5lbCkub24oXCJTbGlkZUluZm86c2F2ZVNsaWRlUHJlc3NlZFwiLCAoKSA9PiB7XG5cblx0XHRzZWxmLnNhdmVTbGlkZSgpO1xuXG5cdH0pO1xuXG59O1xuXG5TdG9yeU1hcC5wcm90b3R5cGUuc2F2ZVNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdC8vIEFnYWZhciBsZXMgZGFkZXMgZGUgbCdzbGlkZUluZm9QYW5lbCBpIGd1YXJkYXItbGVzIGEgbCdvYmplY3RlIGRlIGwnc2xpZGVcblx0Y29uc3Qgc2xpZGUgPSB7XG5cdFx0aWQ6IHRoaXMuc2xpZGVzLmxlbmd0aCxcblx0XHR1cmxfbWFwYTogdGhpcy5zbGlkZUluZm9QYW5lbC5nZXRVUkwoKSxcblx0XHR0aXRvbDogdGhpcy5zbGlkZUluZm9QYW5lbC5nZXRUaXRvbCgpLFxuXHRcdGRlc2NyaXBjaW86IHRoaXMuc2xpZGVJbmZvUGFuZWwuZ2V0RGVzY3JpY2lvKCksXG5cdH07XG5cblx0dGhpcy5zbGlkZXMucHVzaChzbGlkZSk7XG5cblx0Ly8gR3VhcmRlbSBsZXMgZGFkZXMgYWwgc2Vydmlkb3Jcblx0dGhpcy5zYXZlKCkudGhlbigoKSA9PiB7XG5cblx0XHR0aGlzLnNsaWRlSW5mb1BhbmVsLnJlc2V0KCk7XG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5hZGRTbGlkZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBkZWZhdWx0RGF0YSA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMuc2xpZGVEYXRhKTtcblx0Y29uc3QgbiA9IHRoaXMuX3NsaWRlcy5sZW5ndGg7XG5cdGlmIChuID09PSB0aGlzLm9wdGlvbnMubWF4U2xpZGVzKSB7XG5cblx0XHRhbGVydCh0aGlzLm9wdGlvbnMuc3RyaW5nc1t0aGlzLm9wdGlvbnMubGFuZ3VhZ2VdLm1heFNsaWRlcyk7XG5cblx0fVx0ZWxzZSB7XG5cblx0XHR0aGlzLl9zbGlkZXMucHVzaChkZWZhdWx0RGF0YSk7XG5cdFx0JCh0aGlzKS50cmlnZ2VyKFwiU3RvcnlNYXA6Y2hhbmdlZFwiKTtcblx0XHRjb25zdCBzbGlkZSA9IHRoaXMuc2xpZGVCYXIuYWRkU2xpZGUoZGVmYXVsdERhdGEpO1xuXHRcdHNsaWRlLm9uKFwiU2xpZGVCYXI6c2xpZGVTZWxlY3RlZFwiLCB0aGlzLl9zbGlkZVNlbGVjdGVkKTtcblx0XHRzbGlkZS5vbihcIlNsaWRlQmFyOmRlbGV0ZVNsaWRlUHJlc3NlZFwiLCB0aGlzLl9zbGlkZURlbGV0ZVByZXNzZWQpO1xuXG5cdH1cblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLl9zbGlkZVNlbGVjdGVkID0gZnVuY3Rpb24gKGV2ZW50LCBpbmRleCkge1xuXG5cdGlmICh0aGlzLnNsaWRlcyAhPSBudWxsKSB7XG5cblx0XHRjb25zdCBjdXJyZW50U2xpZGUgPSB0aGlzLnNsaWRlc1tpbmRleF07XG5cblx0XHQvLyBUT0RPOiBQYXNzYXIgYSBsJ1NsaWRlSW5mb1xuXHRcdGFsZXJ0KGN1cnJlbnRTbGlkZSk7XG5cblx0fVxuXG59O1xuXG5TdG9yeU1hcC5wcm90b3R5cGUuX3NsaWRlRGVsZXRlUHJlc3NlZCA9IGZ1bmN0aW9uIChldmVudCwgaW5kZXgpIHtcblxuXHRjb25zdCBkYXRhID0gdGhpcy5fc2xpZGVzW2luZGV4XTtcblx0Y29uc3Qgc2xpZGVUaXRsZSA9ICgoZGF0YS50ZXh0KSA/IChkYXRhLnRleHQuaGVhZGxpbmUgfHwgXCIodW50aXRsZWQpXCIpIDogXCIodW50aXRsZWQpXCIpO1xuXG5cdHRoaXMuc2hvd0NvbmZpcm0oYERlbGV0ZSBcIiR7c2xpZGVUaXRsZX1cIiBzbGlkZT9gLCB0aGlzLm9wdGlvbnMuc2xpZGVFbGVtLCBpbmRleCk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuXG5cdGlmICh0aGlzLmlkU3RvcnlNYXAgIT09IFwiXCIpIHtcblxuXHRcdGlmICh0aGlzLmlkRWRpdG9yID09PSBcIlwiKSB7XG5cblx0XHRcdC8vIGphIGV4aXN0ZWl4IGwnc3RvcnltYXAgY3JlYXQuIEVudHJlbSBlbiBtb2RlIGVkaWNpw7Ncblx0XHRcdHRoaXMuc2VydmVyLmVkaXRNYXBTbGlkZXModGhpcy5pZFN0b3J5TWFwKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG5cblx0XHRcdFx0dGhpcy5pZEVkaXRvciA9IHJlc3VsdHMuaWRfZWRpdG9yO1xuXG5cdFx0XHRcdHRoaXMuc2VydmVyLnVwZGF0ZU1hcFNsaWRlcyh0aGlzLmlkRWRpdG9yLCB0aGlzLmlkU3RvcnlNYXAsXG5cdFx0XHRcdFx0SlNPTi5zdHJpbmdpZnkodGhpcy5zbGlkZXMpKS50aGVuKFxuXG5cdFx0XHRcdFx0KCkgPT4ge1xuXG5cdFx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKCk7XG5cblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XG5cblx0XHRcdFx0XHR9LFxuXG5cdFx0XHRcdCk7XG5cblx0XHRcdH0sXG5cdFx0XHQoKSA9PiB7XG5cblx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0dGhpcy5zZXJ2ZXIudXBkYXRlTWFwU2xpZGVzKHRoaXMuaWRFZGl0b3IsIHRoaXMuaWRTdG9yeU1hcCwgSlNPTi5zdHJpbmdpZnkodGhpcy5zbGlkZXMpKS50aGVuKFxuXG5cdFx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuXHRcdFx0XHR9LFxuXHRcdFx0XHQoKSA9PiB7XG5cblx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblxuXHRcdFx0XHR9LFxuXG5cdFx0XHQpO1xuXG5cdFx0fVxuXG5cdH0gZWxzZSB7XG5cblx0XHQvLyBubyBleGlzdGVpeCBsJ3N0b3J5bWFwLiBFbiBjcmVlbSB1biBkZSBub3UgYW1iIGxhIGluZm8gY29ycmVzcG9uZW50XG5cdFx0dGhpcy5zZXJ2ZXIubmV3TWFwU2xpZGVzKEpTT04uc3RyaW5naWZ5KHRoaXMuc2xpZGVzKSkudGhlbigocmVzdWx0cykgPT4ge1xuXG5cdFx0XHR0aGlzLmlkU3RvcnlNYXAgPSByZXN1bHRzLmlkO1xuXHRcdFx0dGhpcy5pZEVkaXRvciA9IHJlc3VsdHMuaWRfZWRpdG9yO1xuXHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSgpO1xuXG5cdFx0fSxcblx0XHQoKSA9PiB7XG5cblx0XHRcdGRlZmVycmVkLnJlamVjdCgpO1xuXG5cdFx0fSk7XG5cblx0fVxuXG5cdHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGlkKSB7XG5cblx0dGhpcy5pZEVkaXRvciA9IGlkO1xuXG5cdHRoaXMuc2VydmVyLmVkaXRNYXBTbGlkZXMoaWQpLnRoZW4oKHJlc3VsdHMpID0+IHtcblxuXHRcdHRoaXMuc2xpZGVzID0gSlNPTi5wYXJzZShyZXN1bHRzLnNsaWRlcyk7XG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5zaG93X2NvbmZpcm0gPSBmdW5jdGlvbiAoKSB7IC8qIChtc2csIHNsaWRlRWxlbSwgc2xpZGVJbmRleCkge1xuXG5cdGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2dfZGVsZXRlX3NsaWRlXCIpO1xuXHQkKFwiI21zZ1wiKS5odG1sKGA8c3Bhbj4ke21zZ308L3NwYW4+YCk7XG5cdG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cblx0JChcIiNkaWFsb2dfZGVsZXRlX3NsaWRlIC5idG4tZGVmYXVsdFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2dfZGVsZXRlX3NsaWRlXCIpO1xuXHRcdG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuXHRcdGNvbnN0IGhlaWdodCA9ICQoXCIjc2xpZGVzXCIpLmhlaWdodCgpIC0gc2xpZGVFbGVtLm91dGVySGVpZ2h0KHRydWUpO1xuXG5cdFx0Ly8gRGVsZXRlIHRoZSBzbGlkZSBkYXRhXG5cdFx0X3NsaWRlcy5zcGxpY2Uoc2xpZGVJbmRleCwgMSk7XG5cdFx0c3RvcnltYXBfZGlydHkoMSk7XG5cblx0XHQvLyBSZW1vdmUgRE9NIGVsZW1lbnRcblx0XHRzbGlkZUVsZW0ucmVtb3ZlKCk7XG5cblx0XHQvLyBBZGp1c3Qgc2xpZGUgY29udGFpbmVyIGhlaWdodFxuXHRcdCQoXCIjc2xpZGVzXCIpLmNzcyhcImhlaWdodFwiLCBgJHtoZWlnaHR9cHhgKTtcblxuXHRcdGlmKF9jdXJyZW50X3NsaWRlX2luZGV4ID09IDApIHtcblxuXHRcdFx0Ly8gVXBkYXRlIG92ZXJsYXkgdmlld1xuXHRcdCAgIC8vIF9tYXAucmVtb3ZlTWFya2VyKHNsaWRlSW5kZXggLSAxKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdC8vIFJlc2V0IGN1cnJlbnQgc2xpZGVcblx0XHRcdGlmKHNsaWRlSW5kZXggPCBfY3VycmVudF9zbGlkZV9pbmRleCkge1xuXG5cdFx0XHRcdF9jdXJyZW50X3NsaWRlX2luZGV4LS07XG5cdFx0XHRcdC8vc3RvcnltYXBfYXV0b19zYXZlKCk7XG5cblx0XHRcdH0gZWxzZSBpZihzbGlkZUluZGV4ID09IF9jdXJyZW50X3NsaWRlX2luZGV4KSB7XG5cblx0XHRcdFx0Y29uc3QgbiA9IE1hdGgubWluKF9jdXJyZW50X3NsaWRlX2luZGV4LCBfc2xpZGVzLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHQkKFwiLnNsaWRlXCIpLmVxKG4pLmNsaWNrKCk7XG5cblx0XHRcdH1cblxuXHRcdH1cblxuXHR9KTtcblx0XG5cdCQoXCIjZGlhbG9nX2RlbGV0ZV9zbGlkZSAuY2xvc2VcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlhbG9nX2RlbGV0ZV9zbGlkZVwiKTtcblx0XHRtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0fSk7XG5cdFxuXHQkKFwiI2RpYWxvZ19kZWxldGVfc2xpZGUgLmJ0bi1kYW5nZXJcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlhbG9nX2RlbGV0ZV9zbGlkZVwiKTtcblx0XHRtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0fSk7Ki9cblxufTtcbiIsIi8qIGdsb2JhbCAkKi9cblxuZnVuY3Rpb24gU3RvcnlNYXBTZXJ2ZXIob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdHVybFN0b3J5TWFwOiBcImh0dHA6Ly8xNzIuNzAuMS4zMi9zdG9yeW1hcHMvXCIsXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxufVxuXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUuZ2V0TWFwU2xpZGVzID0gZnVuY3Rpb24gKGlkTWFwYSkge1xuXG5cdC8vIEV4YW1wbGU6IGh0dHA6Ly8xNzIuNzAuMS4zMi9zdG9yeW1hcHMvNzY4ZGRjNjAtNjZlMi0xMWU3LWFmNWUtMDlhZmYwMDcyMzBkXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIkdFVFwiLFxuXHRcdHVybDogdGhpcy5vcHRpb25zLnVybFN0b3J5TWFwICsgaWRNYXBhLFxuXG5cdH0pO1xuXG59O1xuXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUuZWRpdE1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZE1hcGFFZGl0aW5nKSB7XG5cblx0Ly8gRXhhbXBsZTogaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy9lZGl0Lzc2ZDIxZjAwLTQ4ZTAtNDIxNi1iYjUyLTg0YThhNDFjYzZhMlxuXHRyZXR1cm4gJC5hamF4KHtcblxuXHRcdG1ldGhvZDogXCJHRVRcIixcblx0XHR1cmw6IGAke3RoaXMub3B0aW9ucy51cmxTdG9yeU1hcH1lZGl0LyR7aWRNYXBhRWRpdGluZ31gLFxuXHRcdGFzeW5jOiBmYWxzZSxcblxuXHR9KS5yZXNwb25zZVRleHQ7XG5cbn07XG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUubmV3TWFwU2xpZGVzID0gZnVuY3Rpb24gKGpzb25TbGlkZXMpIHtcblxuXHQvLyBodHRwOi8vMTcyLjcwLjEuMzIvc3RvcnltYXBzL2VkaXQvXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIlBPU1RcIixcblx0XHR1cmw6IGAke3RoaXMub3B0aW9ucy51cmxTdG9yeU1hcH1lZGl0L2AsXG5cdFx0ZGF0YVR5cGU6IFwianNvblwiLFxuXHRcdGRhdGE6IHsgaWQ6IDAsIGlkX2VkaXRvcjogMCwgc2xpZGVzOiBqc29uU2xpZGVzIH0sXG5cblx0fSk7XG5cbn07XG5cblxuU3RvcnlNYXBTZXJ2ZXIucHJvdG90eXBlLnVwZGF0ZU1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZE1hcGFFZGl0aW5nLCBpZE1hcGEsIGpzb25TbGlkZXMpIHtcblxuXHRyZXR1cm4gJC5hamF4KHtcblxuXHRcdG1ldGhvZDogXCJQVVRcIixcblx0XHR1cmw6IGAke3RoaXMub3B0aW9ucy51cmxTdG9yeU1hcH1lZGl0LyR7aWRNYXBhRWRpdGluZ31gLFxuXHRcdGRhdGFUeXBlOiBcImpzb25cIixcblx0XHRkYXRhOiB7IGlkOiBpZE1hcGEsIGlkX2VkaXRvcjogaWRNYXBhRWRpdGluZywgc2xpZGVzOiBqc29uU2xpZGVzIH0sXG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5kZWxldGVNYXBTbGlkZXMgPSBmdW5jdGlvbiAoaWRNYXBhRWRpdGluZywgaWRNYXBhKSB7XG5cblx0JC5hamF4KHtcblxuXHRcdG1ldGhvZDogXCJERUxFVEVcIixcblx0XHR1cmw6IGAke3RoaXMub3B0aW9ucy51cmxTdG9yeU1hcH1lZGl0LyR7aWRNYXBhRWRpdGluZ30vJHtpZE1hcGF9YCxcblx0XHRjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG5cblx0fSlcblx0XHQuZG9uZSgoKSA9PiB7XG5cblx0XHR9KTtcblxufTtcbiJdfQ==
