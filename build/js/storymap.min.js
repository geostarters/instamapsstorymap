"use strict";

/* global $, _, Utils*/

/**
*	Constructs a generic dialog object
*	@param {Object} options An object containing the following properties
*	@property {String} templateId The DOM node id of the panel containing the dialog template
*	@property {String} messageTextId The DOM node id of the dialog message text
*	@property {String} showCancelButton A boolean telling if the cancel button must be shown
*	@property {String} cancelButtonClass The DOM node class of the cancel button
*	@property {String} confirmButtonClass The DOM node class of the confirm button
*	@property {String} closeButtonClass The DOM node class of the close button
*/
function Dialog(options) {

	var _defaultOptions = {
		templateId: "#dialog_template",
		messageTextId: "#msg",
		showCancelButton: true,
		cancelButtonClass: ".btn-ko",
		confirmButtonClass: ".btn-ok",
		closeButtonClass: ".close"
	};

	this.options = $.extend(true, {}, _defaultOptions, options);

	this.setupDialog();
	this.addEvents();
}

/**
*	Setups the dialog
*	@access private
*/
Dialog.prototype.setupDialog = function () {

	var id = Utils.getRandomId();
	this.id = "#" + id;

	this.template = _.template($(this.options.templateId).html().trim());
	$("body").append(this.template({ id: id }));

	if (!this.options.showCancelButton) {

		$(this.id + " " + this.options.cancelButtonClass).hide();
	}
};

/**
*	Adds the events the Dialog should respond to
*	@access private
*	@emits "Dialog:accept" when the accept button is pressed
*	@emits "Dialog:cancel" when the cancel or close buttons are pressed
*/
Dialog.prototype.addEvents = function () {

	var self = this;

	$(self.id + " " + self.options.confirmButtonClass).on("click", function () {

		self.hide();
		$(self).trigger("Dialog:accept");
	});

	$(self.id + " " + self.options.closeButtonClass).on("click", function () {

		self.hide();
		$(self).trigger("Dialog:cancel");
	});

	$(self.id + " " + self.options.cancelButtonClass).on("click", function () {

		self.hide();
		$(self).trigger("Dialog:cancel");
	});
};

/**
*	Sets the message shown on the dialog panel
*	@param {String} msg The dialog message
*	@access public
*/
Dialog.prototype.setMessage = function (msg) {

	$(this.id + " " + this.options.messageTextId).html("<span>" + msg + "</span>");
};

/**
*	Shows the dialog panel
*	@access public
*/
Dialog.prototype.show = function () {

	$(this.id).show();
};

/**
*	Hides the diagonal panel
*	@access public
*/
Dialog.prototype.hide = function () {

	$(this.id).hide();
};
"use strict";

/* global Utils, $*/

/**
*	Constructs a InfoPanel object that represents the slide info panel
*	@param {Object} options An object containing the following properties
*	@property {String} panelId The DOM node id of the panel containing the info panel
*	@property {String} urlInputId The DOM node id of the input where the url is written to
*	@property {String} urlLoadButtonId The DOM node id of the load URL button
*	@property {String} urlClearButtonId The DOM node id of the clear URL button
*	@property {String} urlFormGroup The DOM node id of the url form group
*	@property {String} urlFeedback The DOM node id where the url input feedback is shown
*	@property {String} titleInputId The DOM node id of the slide title input
*	@property {String} titleFormGroup The DOM node id of the slide title form group
*	@property {String} titleFeedback The DOM node id where the title input feedback is shown
*	@property {String} resetSlideButtonId The DOM node id of the reset slide button
*	@property {String} textInputId The DOM node id of the description text area
*/
function InfoPanel(index, options) {

	var _defaultOptions = {

		panelId: "#dataSection",
		urlInputId: "#urlMap",
		urlLoadButtonId: "#storymap_load",
		urlClearButtonId: "#storymap_unload",
		urlFormGroup: "#urlFormGroup",
		urlFeedback: "#urlMapFeedback",
		titleInputId: "#title",
		titleFormGroup: "#titleFormGroup",
		titleFeedback: "#titleFeedback",
		resetSlideButtonId: "#storymap_reset_slide",
		textInputId: "#summernote"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);
	this.isDirty = false;
	this.loadedData = {};

	this.addEvents();
	this.setupSummernote();

	this.reset();
}

/**
*	Adds the events the SettingsPanel should respond to
*	@access private
*/
InfoPanel.prototype.addEvents = function () {
	var _this = this;

	var self = this;

	$(self.options.urlLoadButtonId).on("click", function () {

		self.setURL();
	});

	$(self.options.urlClearButtonId).on("click", function () {

		$(self.options.urlInputId).val("");
		self.disableURLButtons(false);
		$(self).trigger("InfoPanel:clearURLPressed");
	});

	$(self.options.resetSlideButtonId).on("click", function () {

		self.reset();
		self.setDirty(true);
	});

	$(self.options.urlInputId).on("input", function () {

		self.checkURL();
	});

	$(self.options.titleInputId).on("input", function () {

		self.checkTitol();
	});

	$(self.options.textInputId).on("summernote.change", function () {

		self.checkText();
	});

	$(self.options.urlInputId).keyup(function (event) {

		var url = $(_this.options.urlInputId).val();

		if (event.keyCode === 13 && Utils.isValidURL(url)) {

			$(self.options.urlLoadButtonId).click();
		}
	});
};

/**
*	Setups the text area WYSIWYG editor
*	@access private
*/
InfoPanel.prototype.setupSummernote = function () {

	$(this.options.textInputId).summernote({
		disableDragAndDrop: true,
		dialogsInBody: true,
		toolbar: [["style", ["color"]], ["style", ["style"]], ["style", ["bold", "underline", "clear"]], ["style", ["fontname"]], ["para", ["ul", "ol", "paragraph"]], ["insert", ["table"]], ["insert", ["link", "picture", "video"]], ["misc", ["fullscreen", "codeview", "help"]]]
	});

	// Hide the "Upload picture" form 
	$(".note-group-select-from-files").hide();
};

/**
*	Checks if the url found in the URL input is a valid URL. If it's, the buttons are
*	enabled and the slide is set as dirty. If not, the buttons are disabled and the
*	slide inputs are disabled
*	@access private
*/
InfoPanel.prototype.checkURL = function () {

	var url = $(this.options.urlInputId).val();

	if (Utils.isValidURL(url)) {

		this.enableURLButtons();
		this.setDirty(true);
	} else {

		this.disableURLButtons();
	}
};

/**
*	Enables the url buttons
*	@access private
*/
InfoPanel.prototype.enableURLButtons = function () {

	$(this.options.urlFormGroup).removeClass("has-error");
	$(this.options.urlFeedback).hide();
	$(this.options.urlLoadButtonId).prop("disabled", false);
	$(this.options.urlClearButtonId).prop("disabled", false);
};

/**
*	Enables the slide inputs
*	@access private
*/
InfoPanel.prototype.enableSlideInputs = function () {

	$(this.options.titleFormGroup).removeClass("has-error");
	$(this.options.titleFeedback).hide();
	$(this.options.textInputId).summernote("enable");
	$(this.options.titleInputId).prop("disabled", false);
	$(this.options.resetSlideButtonId).prop("disabled", false);
};

/**
*	Disables the url buttons
*	@param {boolean} showFeedback A boolean telling if feedback should be shown or not
*	@access private
*/
InfoPanel.prototype.disableURLButtons = function (showFeedback) {

	var shouldShowFeedback = showFeedback || showFeedback === undefined;

	if (shouldShowFeedback) {

		$(this.options.urlFormGroup).addClass("has-error");
		$(this.options.urlFeedback).show();
	}

	$(this.options.urlLoadButtonId).prop("disabled", true);
	$(this.options.urlClearButtonId).prop("disabled", true);
};

/**
*	Disables the slide inputs
*	@param {boolean} showFeedback A boolean telling if feedback should be shown or not
*	@access private
*/
InfoPanel.prototype.disableSlideInputs = function (showFeedback) {

	var shouldShowFeedback = showFeedback || showFeedback === undefined;

	if (shouldShowFeedback) {

		$(this.options.titleFormGroup).addClass("has-error");
		$(this.options.titleFeedback).show();
	}

	$(this.options.textInputId).summernote("disable");
	$(this.options.resetSlideButtonId).prop("disabled", true);
	$(this.options.titleInputId).prop("disabled", true);
};

/**
*	Checks if the title input is good and if it is, sets the slide as dirty
*	@access private
*/
InfoPanel.prototype.checkTitol = function () {

	var text = $(this.options.titleInputId).val();

	if (Utils.isNotEmpty(text)) {

		this.setDirty(true);
	}
};

/**
*	Checks if the title input is good and if it is, sets the slide as dirty
*	@access private
*/
InfoPanel.prototype.checkText = function () {

	var text = $(this.options.textInputId).summernote("code");

	if (Utils.isNotEmpty(text)) {

		this.setDirty(true);
	}
};

/**
*	Sets the slide as dirty
*	@param {boolean} isDirty A boolean telling if the slide info is dirty or not
*	@access private
*/
InfoPanel.prototype.setDirty = function (isDirty) {

	this.isDirty = isDirty;
};

/**
*	Loads the slide url
*	@access private
*	@emits "InfoPanel:loadURL" when the url is loaded
*/
InfoPanel.prototype.setURL = function () {

	var self = this;

	var url = $(self.options.urlInputId).val();
	$(self).trigger("InfoPanel:loadURL", [url]);
};

/**
*	Gets the url input value
*	@access public
*/
InfoPanel.prototype.getURL = function () {

	return $(this.options.urlInputId).val();
};

/**
*	Gets the title input value
*	@access public
*/
InfoPanel.prototype.getTitol = function () {

	return $(this.options.titleInputId).val();
};

/**
*	Gets the description input value
*	@access public
*/
InfoPanel.prototype.getDescripcio = function () {

	return $(this.options.textInputId).summernote("code");
};

/**
*	Resets the info panel to the starting slide data
*	@access public
*	@emits "InfoPanel:loadURL" when the url is loaded
*	@emits "InfoPanel:clearURLPressed" when the clear url button is pressed
*/
InfoPanel.prototype.reset = function () {

	var title = this.loadedData.titol || "";
	var desc = this.loadedData.descripcio || "";
	var url = this.loadedData.url || "";

	$(this.options.titleInputId).val(title);
	$(this.options.textInputId).summernote("code", desc);
	$(this.options.titleFormGroup).removeClass("has-error");
	$(this.options.titleFeedback).hide();
	$(this.options.urlInputId).val(url);

	if (url.trim() !== "") {

		$(this).trigger("InfoPanel:loadURL", [url]);
		this.enableURLButtons();
	} else {

		$(this).trigger("InfoPanel:clearURLPressed");
		this.disableURLButtons();
	}
};

/**
*	Clears the info panel
*	@access public
*/
InfoPanel.prototype.clean = function () {

	var title = "";
	var desc = "";
	var url = "";

	$(this.options.titleInputId).val(title);
	$(this.options.textInputId).summernote("code", desc);
	$(this.options.titleFormGroup).removeClass("has-error");
	$(this.options.titleFeedback).hide();
	$(this.options.urlInputId).val(url);

	this.disableURLButtons();
};

/**
*	Sets the info panel information
*	param {String} url The url string
*	param {title} titol The title string
*	param {title} descripcio The description string
*	@access public
*	@emits "InfoPanel:loadURL" when the URL is loaded
*/
InfoPanel.prototype.setData = function (url, titol, descripcio) {

	this.loadedData = { url: url, titol: titol, descripcio: descripcio };

	if (url && url !== "") {

		this.enableURLButtons();
	} else {

		this.disableURLButtons();
	}

	$(this).trigger("InfoPanel:loadURL", [url]);
	$(this.options.urlInputId).val(url);
	$(this.options.titleInputId).val(titol);
	$(this.options.textInputId).summernote("code", descripcio);
};

/**
*	Shows the info panel
*	@access public
*/
InfoPanel.prototype.show = function () {

	$(this.options.panelId).show();
};

/**
*	Hides the info panel
*	@access public
*/
InfoPanel.prototype.hide = function () {

	$(this.options.panelId).hide();
};
"use strict";

/* global $*/

/**
*	Constructs a Loader object that represents the loader
*	@param {Object} options An object containing the following properties
*	@property {String} DOMId The DOM node id of the panel containing the loader panel
*	@property {String} titleClass The DOM node class of the loader panel
*/
function Loader(options) {

	var _defaultOptions = {
		DOMId: "#modal-loader",
		titleClass: ".loader-title"
	};

	this.options = $.extend(true, {}, _defaultOptions, options);
}

/**
*	Sets the title shown on the loader panel
*	@param {String} text The loader title panel
*	@access public
*/
Loader.prototype.setTitle = function (title) {

	$(this.options.DOMId + " " + this.options.titleClass).html(title);
};

/**
*	Shows the loader panel
*	@access public
*/
Loader.prototype.show = function () {

	$(this.options.DOMId).show();
};

/**
*	Hides the loader panel
*	@access public
*/
Loader.prototype.hide = function () {

	$(this.options.DOMId).hide();
};
"use strict";

/* global $*/

/**
*	Constructs a SettingsPanel object that represents the setting panel
*	@param {Object} options An object containing the following properties
*	@property {String} panelId The DOM node id of the panel containing the settings panel
*	@property {String} overlappedButtonId The DOM node id of the overlapped button
*	@property {String} noOverlappedButtonId The DOM node id of the non overlapped button
*	@property {String} animParametersPanelId The DOM node id of the animation parameters panel
*	@property {String} animCheckbox The DOM node id of the animation checkbox
*	@property {String} carouselTime The DOM node id where the seconds between slides is input
*	@property {String} pauseCheckbox The DOM node id of the pause on hover checkbox
*	@property {String} rideCheckbox The DOM node id of the should start on load checkbox
*	@property {String} afterFirstCheckbox The DOM node id of the should animate after first slide
*	 checkbox
*	@property {String} wrapCheckbox The DOM node id of the should loop checkbox
*/
function SettingsPanel(index, options) {

	var _defaultOptions = {

		panelId: "#settingsSection",
		overlappedButtonId: "#superposat",
		noOverlappedButtonId: "#noSuperposat",
		animParametersPanelId: "#animParams",
		animCheckbox: "#animCheckbox",
		carouselTime: "#carouselTime",
		pauseCheckbox: "#pauseCheckbox",
		rideCheckbox: "#rideCheckbox",
		afterFirstCheckbox: "#afterFirstCheckbox",
		wrapCheckbox: "#wrapCheckbox"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);
	this.isOverlapped = false;
	this.isDirty = false;

	this.addEvents();
	this.reset();
}

/**
*	Adds the events the SettingsPanel should respond to
*	@access private
*/
SettingsPanel.prototype.addEvents = function () {

	var self = this;

	$(self.options.overlappedButtonId).on("click", function () {

		self.enableOverlappedMode(true);
	});

	$(self.options.noOverlappedButtonId).on("click", function () {

		self.enableOverlappedMode(false);
	});

	$(self.options.animCheckbox).on("change", function () {

		if ($(self.options.animCheckbox).is(":checked")) {

			self.enableAnimParameters(true);
		} else {

			self.enableAnimParameters(false);
		}
	});
};

/**
*	Sets the overlapping mode
*	@param {boolean} shouldEnable A boolean telling if the right bar should overlap the slide
*	@access private
*	@emits "Settings:overlappingChanged" when the overlapping mode has changed
*/
SettingsPanel.prototype.enableOverlappedMode = function (shouldEnable) {

	if (shouldEnable) {

		this.isOverlapped = true;
		$(this.options.overlappedButtonId).addClass("active");
		$(this.options.noOverlappedButtonId).removeClass("active");
	} else {

		this.isOverlapped = false;
		$(this.options.overlappedButtonId).removeClass("active");
		$(this.options.noOverlappedButtonId).addClass("active");
	}

	$(this).trigger("Settings:overlappingChanged", [this.isOverlapped]);
	this.isDirty = true;
};

/**
*	Reset the settings panel
*	@access public
*/
SettingsPanel.prototype.reset = function () {

	this.enableOverlappedMode(false);
	this.isDirty = false;
};

/**
*	Shows the settings panel
*	@access public
*/
SettingsPanel.prototype.show = function () {

	$(this.options.panelId).show();
};

/**
*	Hides the settings panel
*	@access public
*/
SettingsPanel.prototype.hide = function () {

	$(this.options.panelId).hide();
};

/**
*	Enables or disables the animation parameters
*	@param {boolean} shouldEnable A boolean telling if the animation parameters panel should
*	be visible or not
*	@access private
*/
SettingsPanel.prototype.enableAnimParameters = function (shouldEnable) {

	if (shouldEnable) {

		$(this.options.animParametersPanelId).addClass("showAnimParams").removeClass("hideAnimParams");
	} else {

		$(this.options.animParametersPanelId).removeClass("showAnimParams").addClass("hideAnimParams");
	}
};

/**
*	Gets the overlapping mode
*	@access public
*	@returns {String} The name of the overlapping mode ("overlapped" or "nonOverlapped")
*/
SettingsPanel.prototype.getOverlappingMode = function () {

	return $(this.options.overlappedButtonId).hasClass("active") ? "overlapped" : "noOverlapped";
};

/**
*	Gets the animated setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap is animated or not
*/
SettingsPanel.prototype.isAnimated = function () {

	return $(this.options.animCheckbox).prop("checked");
};

/**
*	Gets the time between slides setting
*	@access public
*	@returns {Number} The number of seconds that the StoryMap waits before moving to the next slide
*/
SettingsPanel.prototype.getTimeBetweenSlides = function () {

	return $(this.options.carouselTime).val();
};

/**
*	Gets the should pause on hover setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should wait when the mouse is hovered on the
*	slide
*/
SettingsPanel.prototype.shouldPauseOnHover = function () {

	return $(this.options.pauseCheckbox).prop("checked");
};

/**
*	Gets the should start on load setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should start when its just loaded
*/
SettingsPanel.prototype.shouldStartOnLoad = function () {

	return $(this.options.rideCheckbox).prop("checked");
};

/**
*	Gets the should anim on first slide setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should animate after the first slide
*	has been viewed
*/
SettingsPanel.prototype.shouldAnimOnFirstSlide = function () {

	return $(this.options.afterFirstCheckbox).prop("checked");
};

/**
*	Gets the should loop setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should return to the first slide
*	after the last one is viewed
*/
SettingsPanel.prototype.shouldLoop = function () {

	return $(this.options.wrapCheckbox).prop("checked");
};

/**
*	Sets the overlapping mode
*	@access public
*	@param {boolean} shouldOverlap A boolean telling if the right bar should be overlapped
*	or not
*/
SettingsPanel.prototype.setOverlappingMode = function (shouldOverlap) {

	this.enableOverlappedMode(shouldOverlap === "overlapped");
};

/**
*	Sets the animated setting
*	@access public
*	@param {boolean} shouldAnimate A boolean telling if the StoryMap should be animated
*	or not
*/
SettingsPanel.prototype.setIsAnimated = function (shouldAnimate) {

	$(this.options.animCheckbox).prop("checked", shouldAnimate);
	this.enableAnimParameters(shouldAnimate);
};

/**
*	Sets the time between slides setting
*	@access public
*	@param {Number} time The number of seconds the StoryMap waits before moving to the next
*	slide
*/
SettingsPanel.prototype.setTimeBetweenSlides = function (time) {

	$(this.options.carouselTime).val(time);
};

/**
*	Sets the should pause on hover setting
*	@access public
*	@param {boolean} shouldPause A boolean telling if the StoryMap should be paused
*	when the mouse is hovering the slide or not
*/
SettingsPanel.prototype.setPauseOnHover = function (shouldPause) {

	$(this.options.pauseCheckbox).prop("checked", shouldPause);
};

/**
*	Sets the should start on load setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should start the
*	animation on load or not
*/
SettingsPanel.prototype.setStartOnLoad = function (shouldStart) {

	$(this.options.rideCheckbox).prop("checked", shouldStart);
};

/**
*	Sets the animate on first slide setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should start the animation
*	after the first slide is viewed or not
*/
SettingsPanel.prototype.setAnimOnFirstSlide = function (shouldAnimate) {

	$(this.options.afterFirstCheckbox).prop("checked", shouldAnimate);
};

/**
*	Sets the loop setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should loop when the last
*	slide is reached or not
*/
SettingsPanel.prototype.setLoop = function (shouldLoop) {

	$(this.options.wrapCheckbox).prop("checked", shouldLoop);
};
"use strict";

/* global $, SlideIcon*/

/**
*	Constructs a SlideBar object that represents the container where the icons will be placed and
*	where the add slide button and save story map button are located
*	@param {Object} options An object containing the following properties
*	@property {String} slidesContainerId The DOM node id of the container element
*	@property {String} slideListId The DOM node id of the slide list
*	@property {String} addSlideButton The DOM node id of the add slide button
*	@property {String} saveStorymapButton The DOM node id of the save story nao button
*/
function SlideBar(options) {

	var _defaultOptions = {
		slidesContainerId: "#slidesContainer",
		slideListId: "#slideList",
		addSlideButton: "#storymap_add_slide",
		saveStorymapButton: "#storymap_save"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);

	this.sortableStart = 0;
	this.sortableEnd = 0;
	this.addEvents();
}

/**
*	Adds the events the SlideBar should respond to
*	@access private
*	@emits "SlideBar:addSlidePressed" when the add slide button is pressed
*	@emits "SlideBar:saveStorymapPressed" when the save story map button is pressed
*/
SlideBar.prototype.addEvents = function () {

	var self = this;

	$(self.options.addSlideButton).click(function () {

		$(self).trigger("SlideBar:addSlidePressed");
	});

	$(self.options.saveStorymapButton).click(function () {

		$(self).trigger("SlideBar:saveStorymapPressed");
	});

	$(self.options.slideListId).sortable({
		axis: "y",
		cursor: "move",
		items: ".slide",
		start: function start(event, ui) {

			var slideIndex = $(".slide").index(ui.item);
			self.sortableStart = slideIndex;
		},
		stop: function stop(event, ui) {

			self.sortableEnd = $(".slide").index(ui.item);

			if (self.sortableStart !== self.sortableEnd) {

				$(self).trigger("SlideBar:slideMoved", [self.sortableStart, self.sortableEnd]);

				self.updateSlideNums();
			}
		}
	});
};

/**
*	Adds an slide to the SlideBar
*	@param {boolean} click A boolean telling if the slide must be clicked after
*	being added. Useful when you want the just added slide to be selected
*	@access public
*	@emits "SlideBar:slideSelected" when the slide is selected
*	@emits "SlideBar:deleteSlidePressed" when the slide delete button is pressed
*/
SlideBar.prototype.addSlide = function (click) {

	var self = this;
	var shouldClick = click || click === undefined;

	var slide = new SlideIcon();
	slide.appendTo(this.options.slideListId);

	$(slide).on("Slide:deletePressed", function (event, id) {

		$(self).trigger("SlideBar:deleteSlidePressed", [id]);
	});

	$(slide).on("Slide:selected", function (event, id) {

		self.slideSelectedId = id;
		$(self).trigger("SlideBar:slideSelected", [id]);
	});

	$(this.options.slidesContainerId).scrollTop(Math.max(0, $(this.options.slideListId).height() - $(this.options.slideListId).parent().height()));

	if (shouldClick) {

		slide.clicked();
	}

	self.updateSlideNums();
};

/**
*	Adds an array of slides to the SlideBar
*	@param {Array} slides An array of slide objects with a titol property
*	@access public
*/
SlideBar.prototype.addSlides = function (slides) {

	for (var i = 0, len = slides.length; i < len; ++i) {

		this.addSlide(i === len - 1);
		var titol = slides[i].titol.trim() !== "" ? slides[i].titol : "(Sense títol)";
		$(this.options.slideListId + " li:nth-child(" + (i + 1) + ") .slide-title").html(titol);
	}
};

/**
*	Removes a slide from the SlideBar
*	@param {Number} num The position of the slide to be removed in the SlideBar
*	@access public
*/
SlideBar.prototype.removeSlide = function (num) {

	$(this.options.slideListId + " li:nth-child(" + (num + 1) + ")").remove();
	this.updateSlideNums();
};

/**
*	Sets the title of a slide on the SlideBar
*	@param {String} text The slide title
*	@access public
*/
SlideBar.prototype.setSlideTitle = function (text) {

	var title = text.trim() !== "" ? text : "(Sense títol)";
	$(this.options.slideListId + " li.selected .slide-title").html(title);
};

/**
*	Sets the title of a slide on the SlideBar
*	@param {String} text The slide title
*	@access public
*/
SlideBar.prototype.updateSlideNums = function () {

	$(this.options.slideListId + " .slide-num").each(function (index, elem) {

		$(elem).html(index + 1);
	});
};

/**
*	Removes all the SlideIcons from the SideBar
*	@access public
*/
SlideBar.prototype.clear = function () {

	$("" + this.options.slideListId).html("");
};
"use strict";

/* global $, _*/

/**
*	Constructs a SlideIcon object that represents a slide icon on the slide bar
*	@param {Object} options An object containing the following properties
*	@property {String} templateId The DOM node id of the template used when a slide is added
*	@property {String} slideClass The DOM node class of the slide icons
*/
function SlideIcon(options) {

	var _defaultOptions = {

		templateId: "#storymap_slide_template",
		slideClass: ".slide"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);

	this.template = _.template($(this.options.templateId).html().trim());
	this.slideDOMElem = $(this.template(this.options));
	this.deleteDOMElem = $("<a class=\"close\" href=\"javascript:\">&nbsp;</a>");

	this.addEvents();
}

/**
*	Adds the events the SlideIcon should respond to
*	@access private
*/
SlideIcon.prototype.addEvents = function () {

	var self = this;

	self.slideDOMElem.click(function () {

		self.clicked();
	});

	self.deleteDOMElem.click(function () {

		self.deleteButtonPressed();
	});
};

/**
*	Triggers a slide selected event with its id as an event attribute and changes its class
*	to selected
*	@access private
*	@emits "Slide:selected"
*/
SlideIcon.prototype.clicked = function () {

	var self = this;

	var currentSlideIndex = $(self.options.slideClass).index(self.slideDOMElem);
	$(":focus").blur(); // force change event!

	$(self).trigger("Slide:selected", [currentSlideIndex]);

	$(this.options.slideClass + ".selected").removeClass("selected");
	$(self.slideDOMElem).addClass("selected");

	return false;
};

/**
*	Triggers a remove slide event with its id as an event attribute
*	@access private
*	@emits "Slide:deletePressed"
*/
SlideIcon.prototype.deleteButtonPressed = function () {

	var self = this;

	var currentSlideIndex = $(self.options.slideClass).index(self.slideDOMElem);
	$(self).trigger("Slide:deletePressed", [currentSlideIndex]);
};

/**
*	Appends the slide icon to a DOM node
*	@access public
*	@param {string} The DOM node id where the slide will be appended
*/
SlideIcon.prototype.appendTo = function (id) {

	this.slideDOMElem.appendTo(id);
	this.deleteDOMElem.appendTo(this.slideDOMElem);
};
"use strict";

/* global InfoPanel, SettingsPanel, Utils, $*/

/**
*	Constructs a SlideInfo panel object that stores the window where the slide is shown and the
*	right bar where the slide contents and story map settings are shown
*	@param {Object} options An object containing the following properties
*	@property {String} infoButtonId The DOM node id of the button used to show the info panel
*	@property {String} settingsButtonId The DOM node id of the button used to show the settings panel
*	@property {String} closeButtonId The DOM node id of the button used to close the right bar
*	@property {String} iFrameId The DOM node id of the iframe element where the slide is shown
*	@property {String} noURLId The DOM node id of the div shown when the slide doesn't have an URL
*	@property {String} menuContainerId The DOM node id of the div that contains the menu
*	@property {String} mapaFrame The DOM node id of the div that contains both the iframe and the
*	noURL div
*/
function SlideInfo(options) {

	var _defaultOptions = {

		infoButtonId: "#obrir_menu",
		settingsButtonId: "#settings_menu",
		closeButtonId: "#hide_menu",
		iFrameId: "#instamapsMap",
		noURLId: "#noURLLoaded",
		menuContainerId: "#mapviewer-floating-sidemenu",
		mapaFrame: "#mapaFrame"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);
	this.isDirty = false;
	this.infoPanel = new InfoPanel();
	this.settingsPanel = new SettingsPanel();
	this.currentPanel = this.infoPanel;

	this.addEvents();
	this.reset();
}

/**
*	Adds the events the SlideInfo panel should respond to
*	@access private
*/
SlideInfo.prototype.addEvents = function () {
	var _this = this;

	var self = this;

	$(self.options.infoButtonId).on("click", function () {

		if ($(self.options.menuContainerId).hasClass("hideFloatingMenu")) {

			self.open();
		} else if (_this.infoPanel === _this.currentPanel) {

			self.close();
		}

		self.showInfoPanel();
	});

	$(self.options.settingsButtonId).on("click", function () {

		if ($(self.options.menuContainerId).hasClass("hideFloatingMenu")) {

			self.open();
		} else if (_this.settingsPanel === _this.currentPanel) {

			self.close();
		}

		self.showSettingsPanel();
	});

	$(self.options.closeButtonId).on("click", function () {

		self.close();
	});

	$(this.settingsPanel).on("Settings:overlappingChanged", function (event, isOverlapped) {

		if (isOverlapped) {

			$(_this.options.mapaFrame).removeClass("collapsed");
			$(_this.options.mapaFrame).addClass("expanded");
		} else {

			$(_this.options.mapaFrame).removeClass("expanded");
			$(_this.options.mapaFrame).addClass("collapsed");
		}
	});

	$(this.infoPanel).on("InfoPanel:loadURL", function (event, url) {

		if (url.trim() === "") {

			$(_this.options.noURLId).show();
			$(_this.options.iFrameId).hide();
		} else {

			$(self.options.iFrameId).attr("src", Utils.addProtocolIfNeeded(url));
			$(_this.options.noURLId).hide();
			$(_this.options.iFrameId).show();
		}
	});

	$(this.infoPanel).on("InfoPanel:clearURLPressed", function () {

		$(_this.options.noURLId).show();
		$(_this.options.iFrameId).hide();
		$(self.options.iFrameId).attr("src", "");
	});
};

/**
*	Resets the panel undoing the changes made and not saved
*	@access private
*/
SlideInfo.prototype.reset = function () {

	this.infoPanel.reset();
};

/**
*	Cleans the panel
*	@access private
*/
SlideInfo.prototype.clean = function () {

	this.infoPanel.clean();
};

/**
*	Closes the right bar
*	@access private
*/
SlideInfo.prototype.close = function () {

	$(this.options.menuContainerId).removeClass("showFloatingMenu");
	$(this.options.menuContainerId).addClass("hideFloatingMenu");
	$(this.options.closeButtonId).removeClass("reveal");
};

/**
*	Opens the right bar
*	@access private
*/
SlideInfo.prototype.open = function () {

	$(this.options.menuContainerId).removeClass("hideFloatingMenu");
	$(this.options.menuContainerId).addClass("showFloatingMenu");
	$(this.options.closeButtonId).addClass("reveal");
};

/**
*	Shows the info panel hiding the settings one
*	@access private
*/
SlideInfo.prototype.showInfoPanel = function () {

	this.infoPanel.show();
	this.settingsPanel.hide();
	this.currentPanel = this.infoPanel;
};

/**
*	Shows the settings panel hiding the info one
*	@access private
*/
SlideInfo.prototype.showSettingsPanel = function () {

	this.infoPanel.hide();
	this.settingsPanel.show();
	this.currentPanel = this.settingsPanel;
};

/**
*	Sets the slide data into the info panel
*	@param {String} url The slide url
*	@param {String} title The slide title
*	@param {String} description The slide description
*	@access public
*/
SlideInfo.prototype.setData = function (url, title, description) {

	this.infoPanel.setData(url, title, description);
};

/**
*	Gets the slide URL
*	@access public
*	@returns {String} The slide URL
*/
SlideInfo.prototype.getURL = function () {

	return this.infoPanel.getURL();
};

/**
*	Gets the slide title
*	@access public
*	@returns {String} The slide title
*/
SlideInfo.prototype.getTitol = function () {

	return this.infoPanel.getTitol();
};

/**
*	Gets the slide description
*	@access public
*	@returns {String} The slide description
*/
SlideInfo.prototype.getDescripcio = function () {

	return this.infoPanel.getDescripcio();
};

/**
*	Gets the overlapping mode
*	@access public
*	@returns {String} The name of the overlapping mode ("overlapped" or "nonOverlapped")
*/
SlideInfo.prototype.getOverlappingMode = function () {

	return this.settingsPanel.getOverlappingMode();
};

/**
*	Gets the animated setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap is animated or not
*/
SlideInfo.prototype.isAnimated = function () {

	return this.settingsPanel.isAnimated();
};

/**
*	Gets the time between slides setting
*	@access public
*	@returns {Number} The number of seconds that the StoryMap waits before moving to the next slide
*/
SlideInfo.prototype.getTimeBetweenSlides = function () {

	return this.settingsPanel.getTimeBetweenSlides();
};

/**
*	Gets the should pause on hover setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should wait when the mouse is hovered on the
*	slide
*/
SlideInfo.prototype.shouldPauseOnHover = function () {

	return this.settingsPanel.shouldPauseOnHover();
};

/**
*	Gets the should start on load setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should start when its just loaded
*/
SlideInfo.prototype.shouldStartOnLoad = function () {

	return this.settingsPanel.shouldStartOnLoad();
};

/**
*	Gets the should anim on first slide setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should animate after the first slide
*	has been viewed
*/
SlideInfo.prototype.shouldAnimOnFirstSlide = function () {

	return this.settingsPanel.shouldAnimOnFirstSlide();
};

/**
*	Gets the should loop setting
*	@access public
*	@returns {boolean} A boolean telling if the StoryMap should return to the first slide
*	after the last one is viewed
*/
SlideInfo.prototype.shouldLoop = function () {

	return this.settingsPanel.shouldLoop();
};

/**
*	Sets the overlapping mode
*	@access public
*	@param {boolean} shouldOverlap A boolean telling if the right bar should be overlapped
*	or not
*/
SlideInfo.prototype.setOverlappingMode = function (shouldOverlap) {

	return this.settingsPanel.setOverlappingMode(shouldOverlap);
};

/**
*	Sets the animated setting
*	@access public
*	@param {boolean} shouldAnimate A boolean telling if the StoryMap should be animated
*	or not
*/
SlideInfo.prototype.setIsAnimated = function (shouldAnimate) {

	return this.settingsPanel.setIsAnimated(shouldAnimate);
};

/**
*	Sets the time between slides setting
*	@access public
*	@param {Number} time The number of seconds the StoryMap waits before moving to the next
*	slide
*/
SlideInfo.prototype.setTimeBetweenSlides = function (time) {

	return this.settingsPanel.setTimeBetweenSlides(time);
};

/**
*	Sets the should pause on hover setting
*	@access public
*	@param {boolean} shouldPause A boolean telling if the StoryMap should be paused
*	when the mouse is hovering the slide or not
*/
SlideInfo.prototype.setPauseOnHover = function (shouldPause) {

	return this.settingsPanel.setPauseOnHover(shouldPause);
};

/**
*	Sets the should start on load setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should start the
*	animation on load or not
*/
SlideInfo.prototype.setStartOnLoad = function (shouldStart) {

	return this.settingsPanel.setStartOnLoad(shouldStart);
};

/**
*	Sets the animate on first slide setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should start the animation
*	after the first slide is viewed or not
*/
SlideInfo.prototype.setAnimOnFirstSlide = function (shouldAnimate) {

	return this.settingsPanel.setAnimOnFirstSlide(shouldAnimate);
};

/**
*	Sets the loop setting
*	@access public
*	@param {boolean} shouldStart A boolean telling if the StoryMap should loop when the last
*	slide is reached or not
*/
SlideInfo.prototype.setLoop = function (shouldLoop) {

	return this.settingsPanel.setLoop(shouldLoop);
};
"use strict";

/* global _, $, SlideBar, SlideInfo, StoryMapServer, Dialog, Loader, window*/

/**
*	Constructs a StoryMap
*	@param {Object} options An object containing the following properties
*	@property {String} language The language identifier
*	@property {Number} maxSlides The maximum number of slides in the storymap
*	@property {Object} strings An object with the translations
*	@property {String} editorURL A string with the URL where the user should be pointed at to edit
*	the story map when it's published
*	@property {String} viewerURL A string with the URL where the user should be pointed at to view
*	the story map when it's published
*	@property {String} titleId The DOM node identifier where the story map title must be set
*/
function StoryMap(options) {

	var _defaultOptions = {

		language: "en",
		maxSlides: 12,
		strings: {
			en: {
				maxSlides: "Maximum number of slides reached",
				delete: "Delete \"<<name>>\" slide?",
				loading: "Loading StoryMap",
				toSeeAndShareText: "To see and share this storymap use this link:",
				toEditText: "If you want to keep working on it or change it some time use this link:",
				rememberText: "Remember this links as, for now, they can't be retrieved later",
				sendByEmailText: "If you want we can send it by email:",
				emailButtonText: "Send it!"
			},
			ca: {
				maxSlides: "Màxim número de slides assolit",
				delete: "Elimina la diapositiva \"<<name>>\"?",
				loading: "Carregant l'StoryMap",
				toSeeAndShareText: "Per veure i compartir aquest storymap empra l’enllaç:",
				toEditText: "Si vols seguir-hi treballant o fer canvis més endavant empra aquest altre enllaç:",
				rememberText: "Recorda desar aquests enllaços, ja que ara per ara no es podran recuperar quan tanquis aquesta finestra.",
				sendByEmailText: "Si vols els pots enviar per correu:",
				emailButtonText: "Envia'ls"
			},
			es: {
				maxSlides: "Has llegado al número máximo de slides",
				delete: "Elimina la diapositiva \"<<name>>\"?",
				loading: "Cargando el StoryMap",
				toSeeAndShareText: "Para ver y compartir este storymap usa el siguiente enlace:",
				toEditText: "Si quieres seguir trabajando o hacer cambios mas adelante usa ese enlace:",
				rememberText: "Recuerda guardar estos enlaces ya que por ahora no se pueden recuperar.",
				sendByEmailText: "Si quieres los puedes enviar por correo:",
				emailButtonText: "Envialos"
			}
		},
		editorURL: "http://betaserver2.icgc.cat/storymap/html/editor.html",
		viewerURL: "http://betaserver2.icgc.cat/storymap/html/visor.html",
		titleId: "#storyMapTitle",
		publishDialogTemplate: "#publish_map_template",
		sendEmailButtonId: "#sendEmailBtn"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);

	this.isDirty = false;
	this.currentDeletionIndex = -1;
	this.currentSelectedIndex = -1;
	this.slides = [];
	this.idEditor = "";
	this.idStoryMap = "";
	this.slideBar = new SlideBar();
	this.slideInfoPanel = new SlideInfo();
	this.deleteDialog = new Dialog();
	this.maxSlidesDialog = new Dialog({ showCancelButton: false });
	this.maxSlidesDialog.setMessage(this.options.strings[this.options.language].maxSlides);
	this.publishDialog = new Dialog({ showCancelButton: false });
	this.server = new StoryMapServer();
	this.loader = new Loader();
	this.publishTemplate = $(this.options.publishDialogTemplate).html().trim();
	this.sendEmailButton = $(this.options.sendEmailButtonId);

	this.addEvents();
	this._addSlide();
}

/**
*	Adds the events the story map should respond to
*	@access private
*/
StoryMap.prototype.addEvents = function () {
	var _this = this;

	var self = this;

	$(self.slideBar).on("SlideBar:saveStorymapPressed", function () {

		self._updateCurrentSlideData();
		self.loader.setTitle("Guardant l'Storymap");
		self.loader.show();

		self.save().then(function () {

			self.loader.hide();
			self.publish();
		});
	});

	$(self.slideBar).on("SlideBar:slideSelected", function (event, id) {

		// Get the data from the info panel and add it to the current slide
		self._updateCurrentSlideData();
		self._slideSelected(id);
	});

	$(self.slideBar).on("SlideBar:addSlidePressed", function () {

		self._addSlide();
	});

	$(self.slideBar).on("SlideBar:deleteSlidePressed", function (event, id) {

		self.currentDeletionIndex = id;
		self._showDeleteDialog(id);
	});

	$(self.slideBar).on("SlideBar:slideMoved", function (event, startPos, endPos) {

		var tempSlide = _this.slides[startPos];
		_this.slides.splice(startPos, 1);
		_this.slides.splice(endPos, 0, tempSlide);

		if (_this.currentSelectedIndex === startPos) {

			_this.currentSelectedIndex = endPos;
		}
	});

	$(self.deleteDialog).on("Dialog:accept", function () {

		self._deleteSlide();
		self.currentDeletionIndex = -1;
	});

	$(self.deleteDialog).on("Dialog:cancel", function () {

		self.currentDeletionIndex = -1;
	});
};

/**
*	Creates a slide data object
*	@param {Number} id The slide identifier
*	@param {string} url The url the slide should open
*	@param {string} title The slide title
*	@param {string} description The slide description
*	@access private
*/
StoryMap.prototype.createSlideData = function (id, url, title, description) {

	var slideId = id === undefined ? -1 : id;
	var slideURL = url || "";
	var slideTitol = title || "";
	var slideDesc = description || "";

	var data = {
		id: slideId,
		url_mapa: slideURL,
		titol: slideTitol,
		descripcio: slideDesc
	};

	return data;
};

/**
*	Adds a slide to the story map if we haven't reached the maximum number
*	@access private
*/
StoryMap.prototype._addSlide = function () {

	var self = this;

	var n = self.slides.length;
	if (n === self.options.maxSlides) {

		self.maxSlidesDialog.show();
	} else {

		var slide = self.createSlideData(n);
		self.slides.push(slide);
		this.slideBar.addSlide();
		$(self).trigger("StoryMap:changed");
	}
};

/**
*	Selects an slide and loads its data into the info panel
*	@param {number} index The slide index
*	@access private
*/
StoryMap.prototype._slideSelected = function (index) {

	if (this.slides !== null) {

		this.currentSelectedIndex = index;
		var currentSlide = this.slides[index];
		this.slideInfoPanel.setData(currentSlide.url_mapa, currentSlide.titol, currentSlide.descripcio);
		this.slideInfoPanel.open();
	}
};

/**
*	Updates the slide data with the data found in the info panel
*	@access private
*/
StoryMap.prototype._updateCurrentSlideData = function () {

	if (this.slides !== null) {

		if (this.currentSelectedIndex !== -1) {

			var currentSlide = this.slides[this.currentSelectedIndex];

			currentSlide.url_mapa = this.slideInfoPanel.getURL();
			currentSlide.titol = this.slideInfoPanel.getTitol();
			currentSlide.descripcio = this.slideInfoPanel.getDescripcio();
			this.slideBar.setSlideTitle(currentSlide.titol);
			this.isDirty = true;
		}
	}
};

/**
*	Shows a delete confirmation modal with the slide title on it
*	@param {number} index The slide index
*	@access private
*/
StoryMap.prototype._showDeleteDialog = function (index) {

	var data = this.slides[index];
	var slideTitle = data.titol || "(untitled)";

	this.deleteDialog.setMessage(this.options.strings[this.options.language].delete.replace("<<name>>", slideTitle));
	this.deleteDialog.show();
};

/**
*	Pushes the story map to the server
*	@access public
*/
StoryMap.prototype.save = function () {
	var _this2 = this;

	var deferred = $.Deferred();
	var storymapData = {
		title: $(this.options.titleId).val(),
		overlappingMode: this.slideInfoPanel.getOverlappingMode(),
		animationOptions: {
			isAnimated: this.slideInfoPanel.isAnimated(),
			timeBetweenSlides: this.slideInfoPanel.getTimeBetweenSlides(),
			pauseOnHover: this.slideInfoPanel.shouldPauseOnHover(),
			startOnLoad: this.slideInfoPanel.shouldStartOnLoad(),
			animOnFirst: this.slideInfoPanel.shouldAnimOnFirstSlide(),
			loop: this.slideInfoPanel.shouldLoop()
		},
		slides: this.slides
	};

	if (this.idStoryMap !== "") {

		if (this.idEditor === "") {

			// Story map already exist, go into edit mode
			this.server.editMapSlides(this.idStoryMap).then(function (results) {

				this.idEditor = results.id_editor;

				this.server.updateMapSlides(this.idEditor, this.idStoryMap, JSON.stringify(storymapData)).then(function () {

					deferred.resolve();
				}, function () {

					deferred.reject();
				});
			}, function () {

				deferred.reject();
			});
		} else {

			this.server.updateMapSlides(this.idEditor, this.idStoryMap, JSON.stringify(storymapData)).then(function () {

				deferred.resolve();
			}, function () {

				deferred.reject();
			});
		}
	} else {

		// Story map doesn't exist, build a new one with the current information
		this.server.newMapSlides(JSON.stringify(storymapData)).then(function (results) {

			_this2.idStoryMap = results.id;
			_this2.idEditor = results.id_editor;
			deferred.resolve();
		}, function () {

			deferred.reject();
		});
	}

	return deferred.promise();
};

/**
*	Deletes the slide selected to delete removing its icon from the slide bar and its info from
*	the info panel
*	@access private
*/
StoryMap.prototype._deleteSlide = function () {

	var self = this;

	self.isDirty = true;
	self.slides.splice(this.currentDeletionIndex, 1);
	self.slideBar.removeSlide(this.currentDeletionIndex);
	self.slideInfoPanel.clean();
	this.currentSelectedIndex = -1;
};

/**
*	Loads a story map from the server and inits the editor components
*	@param {string} id A story map identifier
*	@access public
*/
StoryMap.prototype.load = function (id) {

	var self = this;

	self.idEditor = id;
	self.loader.setTitle(this.options.strings[this.options.language].loading);
	self.loader.show();

	self.server.editMapSlides(id).then(function (results) {

		self.currentSelectedIndex = -1;
		self.isDirty = false;
		self.idStoryMap = results.id;
		var data = JSON.parse(results.slides);
		self.slides = data.slides;
		self.slideBar.clear();
		self.slideBar.addSlides(self.slides);
		self.slideInfoPanel.setOverlappingMode(data.overlappingMode);
		self.slideInfoPanel.setIsAnimated(data.animationOptions.isAnimated);
		self.slideInfoPanel.setTimeBetweenSlides(data.animationOptions.timeBetweenSlides);
		self.slideInfoPanel.setPauseOnHover(data.animationOptions.pauseOnHover);
		self.slideInfoPanel.setStartOnLoad(data.animationOptions.startOnLoad);
		self.slideInfoPanel.setAnimOnFirstSlide(data.animationOptions.animOnFirst);
		self.slideInfoPanel.setLoop(data.animationOptions.loop);
		$(self.options.titleId).val(data.title);

		self.loader.hide();
	});
};

/**
*	Shows the publish dialog with the URLs to edit and to view the current storymap
*	@access public
*/
StoryMap.prototype.publish = function () {
	var _this3 = this;

	var self = this;

	var urlEditor = self.options.editorURL + "?id=" + self.idEditor;
	var urlVisor = self.options.viewerURL + "?id=" + self.idStoryMap;
	var currentLanguage = self.options.strings[self.options.language];
	var mailBody = currentLanguage.toSeeAndShareText + "%0D%0A\n\t\t" + urlVisor + "%0D%0A\n\t\t%0D%0A\n\t\t" + currentLanguage.toEditText + "%0D%0A\n\t\t%0D%0A\n\t\t" + urlEditor;

	var message = _.template(self.publishTemplate, {
		lang: self.options.strings[self.options.language],
		viewLink: urlVisor,
		editLink: urlEditor
	});

	self.publishDialog.setMessage(message);
	self.publishDialog.show();

	$(self.options.sendEmailButtonId).on("click", function () {

		window.open("mailto:?subject=Enlla\xE7os Storymap " + $(_this3.options.titleId).val() + ".&body=" + mailBody, "_self");
	});
};
"use strict";

/* global $*/

/**
*	Constructs a StoryMap server
*	@param {Object} options An object containing the following properties
*	@property {string} urlStoryMap The URL where the server lives on
*/
function StoryMapServer(options) {

	var _defaultOptions = {

		urlStoryMap: "http://betaserver2.icgc.cat/storymaps/"

	};

	this.options = $.extend(true, {}, _defaultOptions, options);
}

/**
*	Gets the slides from a story map in view mode
*	@param {String} idStoryMap The story map identifier
*	@returns {Promise} A promise resolving the server call
*/
StoryMapServer.prototype.getMapSlides = function (idStoryMap) {

	// Example: http://172.70.1.32/storymaps/768ddc60-66e2-11e7-af5e-09aff007230d
	return $.ajax({

		method: "GET",
		url: this.options.urlStoryMap + idStoryMap

	});
};

/**
*	Gets the slides from a story map in edit mode
*	@param {String} idStoryMap The story map identifier
*	@returns {Promise} A promise resolving the server call
*/
StoryMapServer.prototype.editMapSlides = function (idStoryMap) {

	// Example: http://172.70.1.32/storymaps/edit/76d21f00-48e0-4216-bb52-84a8a41cc6a2
	return $.ajax({

		method: "GET",
		url: this.options.urlStoryMap + "edit/" + idStoryMap

	});
};

/**
*	Pushes slides to the server creating a new story map
*	@param {String} jsonSlides A JSON-encoded string with the story map data
*	@returns {Promise} A promise resolving the server call
*/
StoryMapServer.prototype.newMapSlides = function (jsonSlides) {

	// http://172.70.1.32/storymaps/edit/
	return $.ajax({

		method: "POST",
		url: this.options.urlStoryMap + "edit/",
		dataType: "json",
		data: { id: 0, id_editor: 0, slides: jsonSlides }

	});
};

/**
*	Pushes slides to the server editing a story map
*	@param {String} idEditStoryMap The edit mode story map identifier
*	@param {String} idViewStoryMap The view mode story map identifier
*	@param {String} jsonSlides A JSON-encoded string with the story map data
*	@returns {Promise} A promise resolving the server call
*/
StoryMapServer.prototype.updateMapSlides = function (idEditStoryMap, idViewStoryMap, jsonSlides) {

	return $.ajax({

		method: "PUT",
		url: this.options.urlStoryMap + "edit/" + idEditStoryMap,
		dataType: "json",
		data: { id: idViewStoryMap, id_editor: idEditStoryMap, slides: jsonSlides }

	});
};

/**
*	Deletes a story map
*	@param {String} idEditStoryMap The edit mode story map identifier
*	@param {String} idViewStoryMap The view mode story map identifier
*	@returns {Promise} A promise resolving the server call
*/
StoryMapServer.prototype.deleteMapSlides = function (idEditStoryMap, idViewStoryMap) {

	return $.ajax({

		method: "DELETE",
		url: this.options.urlStoryMap + "edit/" + idEditStoryMap + "/" + idViewStoryMap,
		contentType: "application/json"

	});
};
"use strict";

/** 
*	Class that groups utility functions
*	@exports Utils
*/
var Utils = {

	/**
 *	Checks if the provided url is a correct-encoded URL
 *	@param {string} url The url to check
 *	@returns {boolean} A boolean telling if the url is valid
 *	@instance
 */
	isValidURL: function isValidURL(url) {

		var expression = /(?:https?:\/\/)?(?:[\w]+\.)([a-zA-Z\.]{2,6})([\/\w\.-]*)*\/?/gi;
		var regex = new RegExp(expression);

		return regex.test(url);
	},


	/**
 *	Checks if the provided text is a correct-encoded email
 *	@param {string} text The text to check
 *	@returns {boolean} A boolean telling if the text is a valid email
 *	@instance
 */
	isValidEmail: function isValidEmail(text) {

		var expression = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
		var regex = new RegExp(expression);

		return regex.test(text);
	},


	/**
 *	Checks if the provided text is not empty
 *	@param {string} text The text to check
 *	@returns {boolean} A boolean telling if the text is emtpy
 *	@instance
 */
	isNotEmpty: function isNotEmpty(text) {

		return text.trim() !== "";
	},


	/**
 *	Generates a random letter
 *	@returns {string} A string containing the letter generated
 *	@instance
 */
	getRandomLetter: function getRandomLetter() {

		return String.fromCharCode(65 + Math.floor(Math.random() * 26));
	},


	/**
 *	Generates a random identifier
 *	@returns {string} A string containing the identifier
 *	@instance
 */
	getRandomId: function getRandomId() {

		return Utils.getRandomLetter() + Date.now();
	},


	/**
 *	Adds the protocol to an URL if needed
 *	@returns {string} A string with a url containing a protocol
 *	@instance
 */
	addProtocolIfNeeded: function addProtocolIfNeeded(url) {

		var newURL = url;
		var expression = /(?:https?:\/\/)/gi;
		var regex = new RegExp(expression);

		if (!regex.test(url)) {

			newURL = "http://" + newURL;
		}

		return newURL;
	}
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpYWxvZy5qcyIsImluZm9QYW5lbC5qcyIsImxvYWRlci5qcyIsInNldHRpbmdzUGFuZWwuanMiLCJzbGlkZUJhci5qcyIsInNsaWRlSWNvbi5qcyIsInNsaWRlSW5mby5qcyIsInN0b3J5TWFwLmpzIiwic3RvcnlNYXBTZXJ2ZXIuanMiLCJ1dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDellBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzdG9yeW1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsICQsIF8sIFV0aWxzKi9cblxuLyoqXG4qXHRDb25zdHJ1Y3RzIGEgZ2VuZXJpYyBkaWFsb2cgb2JqZWN0XG4qXHRAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXNcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB0ZW1wbGF0ZUlkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgcGFuZWwgY29udGFpbmluZyB0aGUgZGlhbG9nIHRlbXBsYXRlXG4qXHRAcHJvcGVydHkge1N0cmluZ30gbWVzc2FnZVRleHRJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGRpYWxvZyBtZXNzYWdlIHRleHRcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBzaG93Q2FuY2VsQnV0dG9uIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBjYW5jZWwgYnV0dG9uIG11c3QgYmUgc2hvd25cbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBjYW5jZWxCdXR0b25DbGFzcyBUaGUgRE9NIG5vZGUgY2xhc3Mgb2YgdGhlIGNhbmNlbCBidXR0b25cbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBjb25maXJtQnV0dG9uQ2xhc3MgVGhlIERPTSBub2RlIGNsYXNzIG9mIHRoZSBjb25maXJtIGJ1dHRvblxuKlx0QHByb3BlcnR5IHtTdHJpbmd9IGNsb3NlQnV0dG9uQ2xhc3MgVGhlIERPTSBub2RlIGNsYXNzIG9mIHRoZSBjbG9zZSBidXR0b25cbiovXG5mdW5jdGlvbiBEaWFsb2cob3B0aW9ucykge1xuXG5cdHZhciBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cdFx0dGVtcGxhdGVJZDogXCIjZGlhbG9nX3RlbXBsYXRlXCIsXG5cdFx0bWVzc2FnZVRleHRJZDogXCIjbXNnXCIsXG5cdFx0c2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcblx0XHRjYW5jZWxCdXR0b25DbGFzczogXCIuYnRuLWtvXCIsXG5cdFx0Y29uZmlybUJ1dHRvbkNsYXNzOiBcIi5idG4tb2tcIixcblx0XHRjbG9zZUJ1dHRvbkNsYXNzOiBcIi5jbG9zZVwiXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cblx0dGhpcy5zZXR1cERpYWxvZygpO1xuXHR0aGlzLmFkZEV2ZW50cygpO1xufVxuXG4vKipcbipcdFNldHVwcyB0aGUgZGlhbG9nXG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5EaWFsb2cucHJvdG90eXBlLnNldHVwRGlhbG9nID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBpZCA9IFV0aWxzLmdldFJhbmRvbUlkKCk7XG5cdHRoaXMuaWQgPSBcIiNcIiArIGlkO1xuXG5cdHRoaXMudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQodGhpcy5vcHRpb25zLnRlbXBsYXRlSWQpLmh0bWwoKS50cmltKCkpO1xuXHQkKFwiYm9keVwiKS5hcHBlbmQodGhpcy50ZW1wbGF0ZSh7IGlkOiBpZCB9KSk7XG5cblx0aWYgKCF0aGlzLm9wdGlvbnMuc2hvd0NhbmNlbEJ1dHRvbikge1xuXG5cdFx0JCh0aGlzLmlkICsgXCIgXCIgKyB0aGlzLm9wdGlvbnMuY2FuY2VsQnV0dG9uQ2xhc3MpLmhpZGUoKTtcblx0fVxufTtcblxuLyoqXG4qXHRBZGRzIHRoZSBldmVudHMgdGhlIERpYWxvZyBzaG91bGQgcmVzcG9uZCB0b1xuKlx0QGFjY2VzcyBwcml2YXRlXG4qXHRAZW1pdHMgXCJEaWFsb2c6YWNjZXB0XCIgd2hlbiB0aGUgYWNjZXB0IGJ1dHRvbiBpcyBwcmVzc2VkXG4qXHRAZW1pdHMgXCJEaWFsb2c6Y2FuY2VsXCIgd2hlbiB0aGUgY2FuY2VsIG9yIGNsb3NlIGJ1dHRvbnMgYXJlIHByZXNzZWRcbiovXG5EaWFsb2cucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0JChzZWxmLmlkICsgXCIgXCIgKyBzZWxmLm9wdGlvbnMuY29uZmlybUJ1dHRvbkNsYXNzKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYuaGlkZSgpO1xuXHRcdCQoc2VsZikudHJpZ2dlcihcIkRpYWxvZzphY2NlcHRcIik7XG5cdH0pO1xuXG5cdCQoc2VsZi5pZCArIFwiIFwiICsgc2VsZi5vcHRpb25zLmNsb3NlQnV0dG9uQ2xhc3MpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5oaWRlKCk7XG5cdFx0JChzZWxmKS50cmlnZ2VyKFwiRGlhbG9nOmNhbmNlbFwiKTtcblx0fSk7XG5cblx0JChzZWxmLmlkICsgXCIgXCIgKyBzZWxmLm9wdGlvbnMuY2FuY2VsQnV0dG9uQ2xhc3MpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5oaWRlKCk7XG5cdFx0JChzZWxmKS50cmlnZ2VyKFwiRGlhbG9nOmNhbmNlbFwiKTtcblx0fSk7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIG1lc3NhZ2Ugc2hvd24gb24gdGhlIGRpYWxvZyBwYW5lbFxuKlx0QHBhcmFtIHtTdHJpbmd9IG1zZyBUaGUgZGlhbG9nIG1lc3NhZ2VcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuRGlhbG9nLnByb3RvdHlwZS5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuXG5cdCQodGhpcy5pZCArIFwiIFwiICsgdGhpcy5vcHRpb25zLm1lc3NhZ2VUZXh0SWQpLmh0bWwoXCI8c3Bhbj5cIiArIG1zZyArIFwiPC9zcGFuPlwiKTtcbn07XG5cbi8qKlxuKlx0U2hvd3MgdGhlIGRpYWxvZyBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5EaWFsb2cucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLmlkKS5zaG93KCk7XG59O1xuXG4vKipcbipcdEhpZGVzIHRoZSBkaWFnb25hbCBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5EaWFsb2cucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLmlkKS5oaWRlKCk7XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG4vKiBnbG9iYWwgVXRpbHMsICQqL1xuXG4vKipcbipcdENvbnN0cnVjdHMgYSBJbmZvUGFuZWwgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyB0aGUgc2xpZGUgaW5mbyBwYW5lbFxuKlx0QHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzXG4qXHRAcHJvcGVydHkge1N0cmluZ30gcGFuZWxJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIHBhbmVsIGNvbnRhaW5pbmcgdGhlIGluZm8gcGFuZWxcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB1cmxJbnB1dElkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgaW5wdXQgd2hlcmUgdGhlIHVybCBpcyB3cml0dGVuIHRvXG4qXHRAcHJvcGVydHkge1N0cmluZ30gdXJsTG9hZEJ1dHRvbklkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgbG9hZCBVUkwgYnV0dG9uXG4qXHRAcHJvcGVydHkge1N0cmluZ30gdXJsQ2xlYXJCdXR0b25JZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGNsZWFyIFVSTCBidXR0b25cbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB1cmxGb3JtR3JvdXAgVGhlIERPTSBub2RlIGlkIG9mIHRoZSB1cmwgZm9ybSBncm91cFxuKlx0QHByb3BlcnR5IHtTdHJpbmd9IHVybEZlZWRiYWNrIFRoZSBET00gbm9kZSBpZCB3aGVyZSB0aGUgdXJsIGlucHV0IGZlZWRiYWNrIGlzIHNob3duXG4qXHRAcHJvcGVydHkge1N0cmluZ30gdGl0bGVJbnB1dElkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgc2xpZGUgdGl0bGUgaW5wdXRcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB0aXRsZUZvcm1Hcm91cCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIHNsaWRlIHRpdGxlIGZvcm0gZ3JvdXBcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB0aXRsZUZlZWRiYWNrIFRoZSBET00gbm9kZSBpZCB3aGVyZSB0aGUgdGl0bGUgaW5wdXQgZmVlZGJhY2sgaXMgc2hvd25cbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSByZXNldFNsaWRlQnV0dG9uSWQgVGhlIERPTSBub2RlIGlkIG9mIHRoZSByZXNldCBzbGlkZSBidXR0b25cbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB0ZXh0SW5wdXRJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGRlc2NyaXB0aW9uIHRleHQgYXJlYVxuKi9cbmZ1bmN0aW9uIEluZm9QYW5lbChpbmRleCwgb3B0aW9ucykge1xuXG5cdHZhciBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHRwYW5lbElkOiBcIiNkYXRhU2VjdGlvblwiLFxuXHRcdHVybElucHV0SWQ6IFwiI3VybE1hcFwiLFxuXHRcdHVybExvYWRCdXR0b25JZDogXCIjc3RvcnltYXBfbG9hZFwiLFxuXHRcdHVybENsZWFyQnV0dG9uSWQ6IFwiI3N0b3J5bWFwX3VubG9hZFwiLFxuXHRcdHVybEZvcm1Hcm91cDogXCIjdXJsRm9ybUdyb3VwXCIsXG5cdFx0dXJsRmVlZGJhY2s6IFwiI3VybE1hcEZlZWRiYWNrXCIsXG5cdFx0dGl0bGVJbnB1dElkOiBcIiN0aXRsZVwiLFxuXHRcdHRpdGxlRm9ybUdyb3VwOiBcIiN0aXRsZUZvcm1Hcm91cFwiLFxuXHRcdHRpdGxlRmVlZGJhY2s6IFwiI3RpdGxlRmVlZGJhY2tcIixcblx0XHRyZXNldFNsaWRlQnV0dG9uSWQ6IFwiI3N0b3J5bWFwX3Jlc2V0X3NsaWRlXCIsXG5cdFx0dGV4dElucHV0SWQ6IFwiI3N1bW1lcm5vdGVcIlxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cdHRoaXMuaXNEaXJ0eSA9IGZhbHNlO1xuXHR0aGlzLmxvYWRlZERhdGEgPSB7fTtcblxuXHR0aGlzLmFkZEV2ZW50cygpO1xuXHR0aGlzLnNldHVwU3VtbWVybm90ZSgpO1xuXG5cdHRoaXMucmVzZXQoKTtcbn1cblxuLyoqXG4qXHRBZGRzIHRoZSBldmVudHMgdGhlIFNldHRpbmdzUGFuZWwgc2hvdWxkIHJlc3BvbmQgdG9cbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy51cmxMb2FkQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5zZXRVUkwoKTtcblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMudXJsQ2xlYXJCdXR0b25JZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHQkKHNlbGYub3B0aW9ucy51cmxJbnB1dElkKS52YWwoXCJcIik7XG5cdFx0c2VsZi5kaXNhYmxlVVJMQnV0dG9ucyhmYWxzZSk7XG5cdFx0JChzZWxmKS50cmlnZ2VyKFwiSW5mb1BhbmVsOmNsZWFyVVJMUHJlc3NlZFwiKTtcblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMucmVzZXRTbGlkZUJ1dHRvbklkKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYucmVzZXQoKTtcblx0XHRzZWxmLnNldERpcnR5KHRydWUpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy51cmxJbnB1dElkKS5vbihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYuY2hlY2tVUkwoKTtcblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMudGl0bGVJbnB1dElkKS5vbihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYuY2hlY2tUaXRvbCgpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy50ZXh0SW5wdXRJZCkub24oXCJzdW1tZXJub3RlLmNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHRzZWxmLmNoZWNrVGV4dCgpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy51cmxJbnB1dElkKS5rZXl1cChmdW5jdGlvbiAoZXZlbnQpIHtcblxuXHRcdHZhciB1cmwgPSAkKF90aGlzLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKCk7XG5cblx0XHRpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgVXRpbHMuaXNWYWxpZFVSTCh1cmwpKSB7XG5cblx0XHRcdCQoc2VsZi5vcHRpb25zLnVybExvYWRCdXR0b25JZCkuY2xpY2soKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4qXHRTZXR1cHMgdGhlIHRleHQgYXJlYSBXWVNJV1lHIGVkaXRvclxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuSW5mb1BhbmVsLnByb3RvdHlwZS5zZXR1cFN1bW1lcm5vdGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoe1xuXHRcdGRpc2FibGVEcmFnQW5kRHJvcDogdHJ1ZSxcblx0XHRkaWFsb2dzSW5Cb2R5OiB0cnVlLFxuXHRcdHRvb2xiYXI6IFtbXCJzdHlsZVwiLCBbXCJjb2xvclwiXV0sIFtcInN0eWxlXCIsIFtcInN0eWxlXCJdXSwgW1wic3R5bGVcIiwgW1wiYm9sZFwiLCBcInVuZGVybGluZVwiLCBcImNsZWFyXCJdXSwgW1wic3R5bGVcIiwgW1wiZm9udG5hbWVcIl1dLCBbXCJwYXJhXCIsIFtcInVsXCIsIFwib2xcIiwgXCJwYXJhZ3JhcGhcIl1dLCBbXCJpbnNlcnRcIiwgW1widGFibGVcIl1dLCBbXCJpbnNlcnRcIiwgW1wibGlua1wiLCBcInBpY3R1cmVcIiwgXCJ2aWRlb1wiXV0sIFtcIm1pc2NcIiwgW1wiZnVsbHNjcmVlblwiLCBcImNvZGV2aWV3XCIsIFwiaGVscFwiXV1dXG5cdH0pO1xuXG5cdC8vIEhpZGUgdGhlIFwiVXBsb2FkIHBpY3R1cmVcIiBmb3JtIFxuXHQkKFwiLm5vdGUtZ3JvdXAtc2VsZWN0LWZyb20tZmlsZXNcIikuaGlkZSgpO1xufTtcblxuLyoqXG4qXHRDaGVja3MgaWYgdGhlIHVybCBmb3VuZCBpbiB0aGUgVVJMIGlucHV0IGlzIGEgdmFsaWQgVVJMLiBJZiBpdCdzLCB0aGUgYnV0dG9ucyBhcmVcbipcdGVuYWJsZWQgYW5kIHRoZSBzbGlkZSBpcyBzZXQgYXMgZGlydHkuIElmIG5vdCwgdGhlIGJ1dHRvbnMgYXJlIGRpc2FibGVkIGFuZCB0aGVcbipcdHNsaWRlIGlucHV0cyBhcmUgZGlzYWJsZWRcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuY2hlY2tVUkwgPSBmdW5jdGlvbiAoKSB7XG5cblx0dmFyIHVybCA9ICQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbCgpO1xuXG5cdGlmIChVdGlscy5pc1ZhbGlkVVJMKHVybCkpIHtcblxuXHRcdHRoaXMuZW5hYmxlVVJMQnV0dG9ucygpO1xuXHRcdHRoaXMuc2V0RGlydHkodHJ1ZSk7XG5cdH0gZWxzZSB7XG5cblx0XHR0aGlzLmRpc2FibGVVUkxCdXR0b25zKCk7XG5cdH1cbn07XG5cbi8qKlxuKlx0RW5hYmxlcyB0aGUgdXJsIGJ1dHRvbnNcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuZW5hYmxlVVJMQnV0dG9ucyA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy51cmxGb3JtR3JvdXApLnJlbW92ZUNsYXNzKFwiaGFzLWVycm9yXCIpO1xuXHQkKHRoaXMub3B0aW9ucy51cmxGZWVkYmFjaykuaGlkZSgpO1xuXHQkKHRoaXMub3B0aW9ucy51cmxMb2FkQnV0dG9uSWQpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG5cdCQodGhpcy5vcHRpb25zLnVybENsZWFyQnV0dG9uSWQpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG59O1xuXG4vKipcbipcdEVuYWJsZXMgdGhlIHNsaWRlIGlucHV0c1xuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuSW5mb1BhbmVsLnByb3RvdHlwZS5lbmFibGVTbGlkZUlucHV0cyA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy50aXRsZUZvcm1Hcm91cCkucmVtb3ZlQ2xhc3MoXCJoYXMtZXJyb3JcIik7XG5cdCQodGhpcy5vcHRpb25zLnRpdGxlRmVlZGJhY2spLmhpZGUoKTtcblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJlbmFibGVcIik7XG5cdCQodGhpcy5vcHRpb25zLnRpdGxlSW5wdXRJZCkucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcblx0JCh0aGlzLm9wdGlvbnMucmVzZXRTbGlkZUJ1dHRvbklkKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xufTtcblxuLyoqXG4qXHREaXNhYmxlcyB0aGUgdXJsIGJ1dHRvbnNcbipcdEBwYXJhbSB7Ym9vbGVhbn0gc2hvd0ZlZWRiYWNrIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIGZlZWRiYWNrIHNob3VsZCBiZSBzaG93biBvciBub3RcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuZGlzYWJsZVVSTEJ1dHRvbnMgPSBmdW5jdGlvbiAoc2hvd0ZlZWRiYWNrKSB7XG5cblx0dmFyIHNob3VsZFNob3dGZWVkYmFjayA9IHNob3dGZWVkYmFjayB8fCBzaG93RmVlZGJhY2sgPT09IHVuZGVmaW5lZDtcblxuXHRpZiAoc2hvdWxkU2hvd0ZlZWRiYWNrKSB7XG5cblx0XHQkKHRoaXMub3B0aW9ucy51cmxGb3JtR3JvdXApLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuXHRcdCQodGhpcy5vcHRpb25zLnVybEZlZWRiYWNrKS5zaG93KCk7XG5cdH1cblxuXHQkKHRoaXMub3B0aW9ucy51cmxMb2FkQnV0dG9uSWQpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcblx0JCh0aGlzLm9wdGlvbnMudXJsQ2xlYXJCdXR0b25JZCkucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xufTtcblxuLyoqXG4qXHREaXNhYmxlcyB0aGUgc2xpZGUgaW5wdXRzXG4qXHRAcGFyYW0ge2Jvb2xlYW59IHNob3dGZWVkYmFjayBBIGJvb2xlYW4gdGVsbGluZyBpZiBmZWVkYmFjayBzaG91bGQgYmUgc2hvd24gb3Igbm90XG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5JbmZvUGFuZWwucHJvdG90eXBlLmRpc2FibGVTbGlkZUlucHV0cyA9IGZ1bmN0aW9uIChzaG93RmVlZGJhY2spIHtcblxuXHR2YXIgc2hvdWxkU2hvd0ZlZWRiYWNrID0gc2hvd0ZlZWRiYWNrIHx8IHNob3dGZWVkYmFjayA9PT0gdW5kZWZpbmVkO1xuXG5cdGlmIChzaG91bGRTaG93RmVlZGJhY2spIHtcblxuXHRcdCQodGhpcy5vcHRpb25zLnRpdGxlRm9ybUdyb3VwKS5hZGRDbGFzcyhcImhhcy1lcnJvclwiKTtcblx0XHQkKHRoaXMub3B0aW9ucy50aXRsZUZlZWRiYWNrKS5zaG93KCk7XG5cdH1cblxuXHQkKHRoaXMub3B0aW9ucy50ZXh0SW5wdXRJZCkuc3VtbWVybm90ZShcImRpc2FibGVcIik7XG5cdCQodGhpcy5vcHRpb25zLnJlc2V0U2xpZGVCdXR0b25JZCkucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuXHQkKHRoaXMub3B0aW9ucy50aXRsZUlucHV0SWQpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbn07XG5cbi8qKlxuKlx0Q2hlY2tzIGlmIHRoZSB0aXRsZSBpbnB1dCBpcyBnb29kIGFuZCBpZiBpdCBpcywgc2V0cyB0aGUgc2xpZGUgYXMgZGlydHlcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuY2hlY2tUaXRvbCA9IGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgdGV4dCA9ICQodGhpcy5vcHRpb25zLnRpdGxlSW5wdXRJZCkudmFsKCk7XG5cblx0aWYgKFV0aWxzLmlzTm90RW1wdHkodGV4dCkpIHtcblxuXHRcdHRoaXMuc2V0RGlydHkodHJ1ZSk7XG5cdH1cbn07XG5cbi8qKlxuKlx0Q2hlY2tzIGlmIHRoZSB0aXRsZSBpbnB1dCBpcyBnb29kIGFuZCBpZiBpdCBpcywgc2V0cyB0aGUgc2xpZGUgYXMgZGlydHlcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuY2hlY2tUZXh0ID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciB0ZXh0ID0gJCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJjb2RlXCIpO1xuXG5cdGlmIChVdGlscy5pc05vdEVtcHR5KHRleHQpKSB7XG5cblx0XHR0aGlzLnNldERpcnR5KHRydWUpO1xuXHR9XG59O1xuXG4vKipcbipcdFNldHMgdGhlIHNsaWRlIGFzIGRpcnR5XG4qXHRAcGFyYW0ge2Jvb2xlYW59IGlzRGlydHkgQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIHNsaWRlIGluZm8gaXMgZGlydHkgb3Igbm90XG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5JbmZvUGFuZWwucHJvdG90eXBlLnNldERpcnR5ID0gZnVuY3Rpb24gKGlzRGlydHkpIHtcblxuXHR0aGlzLmlzRGlydHkgPSBpc0RpcnR5O1xufTtcblxuLyoqXG4qXHRMb2FkcyB0aGUgc2xpZGUgdXJsXG4qXHRAYWNjZXNzIHByaXZhdGVcbipcdEBlbWl0cyBcIkluZm9QYW5lbDpsb2FkVVJMXCIgd2hlbiB0aGUgdXJsIGlzIGxvYWRlZFxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuc2V0VVJMID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHR2YXIgdXJsID0gJChzZWxmLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKCk7XG5cdCQoc2VsZikudHJpZ2dlcihcIkluZm9QYW5lbDpsb2FkVVJMXCIsIFt1cmxdKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgdXJsIGlucHV0IHZhbHVlXG4qXHRAYWNjZXNzIHB1YmxpY1xuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUuZ2V0VVJMID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy51cmxJbnB1dElkKS52YWwoKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgdGl0bGUgaW5wdXQgdmFsdWVcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuSW5mb1BhbmVsLnByb3RvdHlwZS5nZXRUaXRvbCA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gJCh0aGlzLm9wdGlvbnMudGl0bGVJbnB1dElkKS52YWwoKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgZGVzY3JpcHRpb24gaW5wdXQgdmFsdWVcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuSW5mb1BhbmVsLnByb3RvdHlwZS5nZXREZXNjcmlwY2lvID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy50ZXh0SW5wdXRJZCkuc3VtbWVybm90ZShcImNvZGVcIik7XG59O1xuXG4vKipcbipcdFJlc2V0cyB0aGUgaW5mbyBwYW5lbCB0byB0aGUgc3RhcnRpbmcgc2xpZGUgZGF0YVxuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEBlbWl0cyBcIkluZm9QYW5lbDpsb2FkVVJMXCIgd2hlbiB0aGUgdXJsIGlzIGxvYWRlZFxuKlx0QGVtaXRzIFwiSW5mb1BhbmVsOmNsZWFyVVJMUHJlc3NlZFwiIHdoZW4gdGhlIGNsZWFyIHVybCBidXR0b24gaXMgcHJlc3NlZFxuKi9cbkluZm9QYW5lbC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0dmFyIHRpdGxlID0gdGhpcy5sb2FkZWREYXRhLnRpdG9sIHx8IFwiXCI7XG5cdHZhciBkZXNjID0gdGhpcy5sb2FkZWREYXRhLmRlc2NyaXBjaW8gfHwgXCJcIjtcblx0dmFyIHVybCA9IHRoaXMubG9hZGVkRGF0YS51cmwgfHwgXCJcIjtcblxuXHQkKHRoaXMub3B0aW9ucy50aXRsZUlucHV0SWQpLnZhbCh0aXRsZSk7XG5cdCQodGhpcy5vcHRpb25zLnRleHRJbnB1dElkKS5zdW1tZXJub3RlKFwiY29kZVwiLCBkZXNjKTtcblx0JCh0aGlzLm9wdGlvbnMudGl0bGVGb3JtR3JvdXApLnJlbW92ZUNsYXNzKFwiaGFzLWVycm9yXCIpO1xuXHQkKHRoaXMub3B0aW9ucy50aXRsZUZlZWRiYWNrKS5oaWRlKCk7XG5cdCQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbCh1cmwpO1xuXG5cdGlmICh1cmwudHJpbSgpICE9PSBcIlwiKSB7XG5cblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJJbmZvUGFuZWw6bG9hZFVSTFwiLCBbdXJsXSk7XG5cdFx0dGhpcy5lbmFibGVVUkxCdXR0b25zKCk7XG5cdH0gZWxzZSB7XG5cblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJJbmZvUGFuZWw6Y2xlYXJVUkxQcmVzc2VkXCIpO1xuXHRcdHRoaXMuZGlzYWJsZVVSTEJ1dHRvbnMoKTtcblx0fVxufTtcblxuLyoqXG4qXHRDbGVhcnMgdGhlIGluZm8gcGFuZWxcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuSW5mb1BhbmVsLnByb3RvdHlwZS5jbGVhbiA9IGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgdGl0bGUgPSBcIlwiO1xuXHR2YXIgZGVzYyA9IFwiXCI7XG5cdHZhciB1cmwgPSBcIlwiO1xuXG5cdCQodGhpcy5vcHRpb25zLnRpdGxlSW5wdXRJZCkudmFsKHRpdGxlKTtcblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJjb2RlXCIsIGRlc2MpO1xuXHQkKHRoaXMub3B0aW9ucy50aXRsZUZvcm1Hcm91cCkucmVtb3ZlQ2xhc3MoXCJoYXMtZXJyb3JcIik7XG5cdCQodGhpcy5vcHRpb25zLnRpdGxlRmVlZGJhY2spLmhpZGUoKTtcblx0JCh0aGlzLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKHVybCk7XG5cblx0dGhpcy5kaXNhYmxlVVJMQnV0dG9ucygpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBpbmZvIHBhbmVsIGluZm9ybWF0aW9uXG4qXHRwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIHVybCBzdHJpbmdcbipcdHBhcmFtIHt0aXRsZX0gdGl0b2wgVGhlIHRpdGxlIHN0cmluZ1xuKlx0cGFyYW0ge3RpdGxlfSBkZXNjcmlwY2lvIFRoZSBkZXNjcmlwdGlvbiBzdHJpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAZW1pdHMgXCJJbmZvUGFuZWw6bG9hZFVSTFwiIHdoZW4gdGhlIFVSTCBpcyBsb2FkZWRcbiovXG5JbmZvUGFuZWwucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAodXJsLCB0aXRvbCwgZGVzY3JpcGNpbykge1xuXG5cdHRoaXMubG9hZGVkRGF0YSA9IHsgdXJsOiB1cmwsIHRpdG9sOiB0aXRvbCwgZGVzY3JpcGNpbzogZGVzY3JpcGNpbyB9O1xuXG5cdGlmICh1cmwgJiYgdXJsICE9PSBcIlwiKSB7XG5cblx0XHR0aGlzLmVuYWJsZVVSTEJ1dHRvbnMoKTtcblx0fSBlbHNlIHtcblxuXHRcdHRoaXMuZGlzYWJsZVVSTEJ1dHRvbnMoKTtcblx0fVxuXG5cdCQodGhpcykudHJpZ2dlcihcIkluZm9QYW5lbDpsb2FkVVJMXCIsIFt1cmxdKTtcblx0JCh0aGlzLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKHVybCk7XG5cdCQodGhpcy5vcHRpb25zLnRpdGxlSW5wdXRJZCkudmFsKHRpdG9sKTtcblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJjb2RlXCIsIGRlc2NyaXBjaW8pO1xufTtcblxuLyoqXG4qXHRTaG93cyB0aGUgaW5mbyBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5JbmZvUGFuZWwucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMucGFuZWxJZCkuc2hvdygpO1xufTtcblxuLyoqXG4qXHRIaWRlcyB0aGUgaW5mbyBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5JbmZvUGFuZWwucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMucGFuZWxJZCkuaGlkZSgpO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsICQqL1xuXG4vKipcbipcdENvbnN0cnVjdHMgYSBMb2FkZXIgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyB0aGUgbG9hZGVyXG4qXHRAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXNcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBET01JZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIHBhbmVsIGNvbnRhaW5pbmcgdGhlIGxvYWRlciBwYW5lbFxuKlx0QHByb3BlcnR5IHtTdHJpbmd9IHRpdGxlQ2xhc3MgVGhlIERPTSBub2RlIGNsYXNzIG9mIHRoZSBsb2FkZXIgcGFuZWxcbiovXG5mdW5jdGlvbiBMb2FkZXIob3B0aW9ucykge1xuXG5cdHZhciBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cdFx0RE9NSWQ6IFwiI21vZGFsLWxvYWRlclwiLFxuXHRcdHRpdGxlQ2xhc3M6IFwiLmxvYWRlci10aXRsZVwiXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG59XG5cbi8qKlxuKlx0U2V0cyB0aGUgdGl0bGUgc2hvd24gb24gdGhlIGxvYWRlciBwYW5lbFxuKlx0QHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIGxvYWRlciB0aXRsZSBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5Mb2FkZXIucHJvdG90eXBlLnNldFRpdGxlID0gZnVuY3Rpb24gKHRpdGxlKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuRE9NSWQgKyBcIiBcIiArIHRoaXMub3B0aW9ucy50aXRsZUNsYXNzKS5odG1sKHRpdGxlKTtcbn07XG5cbi8qKlxuKlx0U2hvd3MgdGhlIGxvYWRlciBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5Mb2FkZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuRE9NSWQpLnNob3coKTtcbn07XG5cbi8qKlxuKlx0SGlkZXMgdGhlIGxvYWRlciBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5Mb2FkZXIucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuRE9NSWQpLmhpZGUoKTtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGdsb2JhbCAkKi9cblxuLyoqXG4qXHRDb25zdHJ1Y3RzIGEgU2V0dGluZ3NQYW5lbCBvYmplY3QgdGhhdCByZXByZXNlbnRzIHRoZSBzZXR0aW5nIHBhbmVsXG4qXHRAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXNcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBwYW5lbElkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgcGFuZWwgY29udGFpbmluZyB0aGUgc2V0dGluZ3MgcGFuZWxcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBvdmVybGFwcGVkQnV0dG9uSWQgVGhlIERPTSBub2RlIGlkIG9mIHRoZSBvdmVybGFwcGVkIGJ1dHRvblxuKlx0QHByb3BlcnR5IHtTdHJpbmd9IG5vT3ZlcmxhcHBlZEJ1dHRvbklkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgbm9uIG92ZXJsYXBwZWQgYnV0dG9uXG4qXHRAcHJvcGVydHkge1N0cmluZ30gYW5pbVBhcmFtZXRlcnNQYW5lbElkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgYW5pbWF0aW9uIHBhcmFtZXRlcnMgcGFuZWxcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBhbmltQ2hlY2tib3ggVGhlIERPTSBub2RlIGlkIG9mIHRoZSBhbmltYXRpb24gY2hlY2tib3hcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBjYXJvdXNlbFRpbWUgVGhlIERPTSBub2RlIGlkIHdoZXJlIHRoZSBzZWNvbmRzIGJldHdlZW4gc2xpZGVzIGlzIGlucHV0XG4qXHRAcHJvcGVydHkge1N0cmluZ30gcGF1c2VDaGVja2JveCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIHBhdXNlIG9uIGhvdmVyIGNoZWNrYm94XG4qXHRAcHJvcGVydHkge1N0cmluZ30gcmlkZUNoZWNrYm94IFRoZSBET00gbm9kZSBpZCBvZiB0aGUgc2hvdWxkIHN0YXJ0IG9uIGxvYWQgY2hlY2tib3hcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBhZnRlckZpcnN0Q2hlY2tib3ggVGhlIERPTSBub2RlIGlkIG9mIHRoZSBzaG91bGQgYW5pbWF0ZSBhZnRlciBmaXJzdCBzbGlkZVxuKlx0IGNoZWNrYm94XG4qXHRAcHJvcGVydHkge1N0cmluZ30gd3JhcENoZWNrYm94IFRoZSBET00gbm9kZSBpZCBvZiB0aGUgc2hvdWxkIGxvb3AgY2hlY2tib3hcbiovXG5mdW5jdGlvbiBTZXR0aW5nc1BhbmVsKGluZGV4LCBvcHRpb25zKSB7XG5cblx0dmFyIF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdHBhbmVsSWQ6IFwiI3NldHRpbmdzU2VjdGlvblwiLFxuXHRcdG92ZXJsYXBwZWRCdXR0b25JZDogXCIjc3VwZXJwb3NhdFwiLFxuXHRcdG5vT3ZlcmxhcHBlZEJ1dHRvbklkOiBcIiNub1N1cGVycG9zYXRcIixcblx0XHRhbmltUGFyYW1ldGVyc1BhbmVsSWQ6IFwiI2FuaW1QYXJhbXNcIixcblx0XHRhbmltQ2hlY2tib3g6IFwiI2FuaW1DaGVja2JveFwiLFxuXHRcdGNhcm91c2VsVGltZTogXCIjY2Fyb3VzZWxUaW1lXCIsXG5cdFx0cGF1c2VDaGVja2JveDogXCIjcGF1c2VDaGVja2JveFwiLFxuXHRcdHJpZGVDaGVja2JveDogXCIjcmlkZUNoZWNrYm94XCIsXG5cdFx0YWZ0ZXJGaXJzdENoZWNrYm94OiBcIiNhZnRlckZpcnN0Q2hlY2tib3hcIixcblx0XHR3cmFwQ2hlY2tib3g6IFwiI3dyYXBDaGVja2JveFwiXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblx0dGhpcy5pc092ZXJsYXBwZWQgPSBmYWxzZTtcblx0dGhpcy5pc0RpcnR5ID0gZmFsc2U7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblx0dGhpcy5yZXNldCgpO1xufVxuXG4vKipcbipcdEFkZHMgdGhlIGV2ZW50cyB0aGUgU2V0dGluZ3NQYW5lbCBzaG91bGQgcmVzcG9uZCB0b1xuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy5vdmVybGFwcGVkQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5lbmFibGVPdmVybGFwcGVkTW9kZSh0cnVlKTtcblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMubm9PdmVybGFwcGVkQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5lbmFibGVPdmVybGFwcGVkTW9kZShmYWxzZSk7XG5cdH0pO1xuXG5cdCQoc2VsZi5vcHRpb25zLmFuaW1DaGVja2JveCkub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKCQoc2VsZi5vcHRpb25zLmFuaW1DaGVja2JveCkuaXMoXCI6Y2hlY2tlZFwiKSkge1xuXG5cdFx0XHRzZWxmLmVuYWJsZUFuaW1QYXJhbWV0ZXJzKHRydWUpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHNlbGYuZW5hYmxlQW5pbVBhcmFtZXRlcnMoZmFsc2UpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIG92ZXJsYXBwaW5nIG1vZGVcbipcdEBwYXJhbSB7Ym9vbGVhbn0gc2hvdWxkRW5hYmxlIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSByaWdodCBiYXIgc2hvdWxkIG92ZXJsYXAgdGhlIHNsaWRlXG4qXHRAYWNjZXNzIHByaXZhdGVcbipcdEBlbWl0cyBcIlNldHRpbmdzOm92ZXJsYXBwaW5nQ2hhbmdlZFwiIHdoZW4gdGhlIG92ZXJsYXBwaW5nIG1vZGUgaGFzIGNoYW5nZWRcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5lbmFibGVPdmVybGFwcGVkTW9kZSA9IGZ1bmN0aW9uIChzaG91bGRFbmFibGUpIHtcblxuXHRpZiAoc2hvdWxkRW5hYmxlKSB7XG5cblx0XHR0aGlzLmlzT3ZlcmxhcHBlZCA9IHRydWU7XG5cdFx0JCh0aGlzLm9wdGlvbnMub3ZlcmxhcHBlZEJ1dHRvbklkKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcblx0XHQkKHRoaXMub3B0aW9ucy5ub092ZXJsYXBwZWRCdXR0b25JZCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cdH0gZWxzZSB7XG5cblx0XHR0aGlzLmlzT3ZlcmxhcHBlZCA9IGZhbHNlO1xuXHRcdCQodGhpcy5vcHRpb25zLm92ZXJsYXBwZWRCdXR0b25JZCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cdFx0JCh0aGlzLm9wdGlvbnMubm9PdmVybGFwcGVkQnV0dG9uSWQpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuXHR9XG5cblx0JCh0aGlzKS50cmlnZ2VyKFwiU2V0dGluZ3M6b3ZlcmxhcHBpbmdDaGFuZ2VkXCIsIFt0aGlzLmlzT3ZlcmxhcHBlZF0pO1xuXHR0aGlzLmlzRGlydHkgPSB0cnVlO1xufTtcblxuLyoqXG4qXHRSZXNldCB0aGUgc2V0dGluZ3MgcGFuZWxcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0dGhpcy5lbmFibGVPdmVybGFwcGVkTW9kZShmYWxzZSk7XG5cdHRoaXMuaXNEaXJ0eSA9IGZhbHNlO1xufTtcblxuLyoqXG4qXHRTaG93cyB0aGUgc2V0dGluZ3MgcGFuZWxcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5wYW5lbElkKS5zaG93KCk7XG59O1xuXG4vKipcbipcdEhpZGVzIHRoZSBzZXR0aW5ncyBwYW5lbFxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdCQodGhpcy5vcHRpb25zLnBhbmVsSWQpLmhpZGUoKTtcbn07XG5cbi8qKlxuKlx0RW5hYmxlcyBvciBkaXNhYmxlcyB0aGUgYW5pbWF0aW9uIHBhcmFtZXRlcnNcbipcdEBwYXJhbSB7Ym9vbGVhbn0gc2hvdWxkRW5hYmxlIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBhbmltYXRpb24gcGFyYW1ldGVycyBwYW5lbCBzaG91bGRcbipcdGJlIHZpc2libGUgb3Igbm90XG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5lbmFibGVBbmltUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChzaG91bGRFbmFibGUpIHtcblxuXHRpZiAoc2hvdWxkRW5hYmxlKSB7XG5cblx0XHQkKHRoaXMub3B0aW9ucy5hbmltUGFyYW1ldGVyc1BhbmVsSWQpLmFkZENsYXNzKFwic2hvd0FuaW1QYXJhbXNcIikucmVtb3ZlQ2xhc3MoXCJoaWRlQW5pbVBhcmFtc1wiKTtcblx0fSBlbHNlIHtcblxuXHRcdCQodGhpcy5vcHRpb25zLmFuaW1QYXJhbWV0ZXJzUGFuZWxJZCkucmVtb3ZlQ2xhc3MoXCJzaG93QW5pbVBhcmFtc1wiKS5hZGRDbGFzcyhcImhpZGVBbmltUGFyYW1zXCIpO1xuXHR9XG59O1xuXG4vKipcbipcdEdldHMgdGhlIG92ZXJsYXBwaW5nIG1vZGVcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcmV0dXJucyB7U3RyaW5nfSBUaGUgbmFtZSBvZiB0aGUgb3ZlcmxhcHBpbmcgbW9kZSAoXCJvdmVybGFwcGVkXCIgb3IgXCJub25PdmVybGFwcGVkXCIpXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuZ2V0T3ZlcmxhcHBpbmdNb2RlID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy5vdmVybGFwcGVkQnV0dG9uSWQpLmhhc0NsYXNzKFwiYWN0aXZlXCIpID8gXCJvdmVybGFwcGVkXCIgOiBcIm5vT3ZlcmxhcHBlZFwiO1xufTtcblxuLyoqXG4qXHRHZXRzIHRoZSBhbmltYXRlZCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHJldHVybnMge2Jvb2xlYW59IEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBpcyBhbmltYXRlZCBvciBub3RcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5pc0FuaW1hdGVkID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy5hbmltQ2hlY2tib3gpLnByb3AoXCJjaGVja2VkXCIpO1xufTtcblxuLyoqXG4qXHRHZXRzIHRoZSB0aW1lIGJldHdlZW4gc2xpZGVzIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcmV0dXJucyB7TnVtYmVyfSBUaGUgbnVtYmVyIG9mIHNlY29uZHMgdGhhdCB0aGUgU3RvcnlNYXAgd2FpdHMgYmVmb3JlIG1vdmluZyB0byB0aGUgbmV4dCBzbGlkZVxuKi9cblNldHRpbmdzUGFuZWwucHJvdG90eXBlLmdldFRpbWVCZXR3ZWVuU2xpZGVzID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy5jYXJvdXNlbFRpbWUpLnZhbCgpO1xufTtcblxuLyoqXG4qXHRHZXRzIHRoZSBzaG91bGQgcGF1c2Ugb24gaG92ZXIgc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtib29sZWFufSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHdhaXQgd2hlbiB0aGUgbW91c2UgaXMgaG92ZXJlZCBvbiB0aGVcbipcdHNsaWRlXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2hvdWxkUGF1c2VPbkhvdmVyID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy5wYXVzZUNoZWNrYm94KS5wcm9wKFwiY2hlY2tlZFwiKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgc2hvdWxkIHN0YXJ0IG9uIGxvYWQgc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtib29sZWFufSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHN0YXJ0IHdoZW4gaXRzIGp1c3QgbG9hZGVkXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2hvdWxkU3RhcnRPbkxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnJpZGVDaGVja2JveCkucHJvcChcImNoZWNrZWRcIik7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNob3VsZCBhbmltIG9uIGZpcnN0IHNsaWRlIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcmV0dXJucyB7Ym9vbGVhbn0gQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIFN0b3J5TWFwIHNob3VsZCBhbmltYXRlIGFmdGVyIHRoZSBmaXJzdCBzbGlkZVxuKlx0aGFzIGJlZW4gdmlld2VkXG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2hvdWxkQW5pbU9uRmlyc3RTbGlkZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gJCh0aGlzLm9wdGlvbnMuYWZ0ZXJGaXJzdENoZWNrYm94KS5wcm9wKFwiY2hlY2tlZFwiKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgc2hvdWxkIGxvb3Agc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtib29sZWFufSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHJldHVybiB0byB0aGUgZmlyc3Qgc2xpZGVcbipcdGFmdGVyIHRoZSBsYXN0IG9uZSBpcyB2aWV3ZWRcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5zaG91bGRMb29wID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy53cmFwQ2hlY2tib3gpLnByb3AoXCJjaGVja2VkXCIpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBvdmVybGFwcGluZyBtb2RlXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRPdmVybGFwIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSByaWdodCBiYXIgc2hvdWxkIGJlIG92ZXJsYXBwZWRcbipcdG9yIG5vdFxuKi9cblNldHRpbmdzUGFuZWwucHJvdG90eXBlLnNldE92ZXJsYXBwaW5nTW9kZSA9IGZ1bmN0aW9uIChzaG91bGRPdmVybGFwKSB7XG5cblx0dGhpcy5lbmFibGVPdmVybGFwcGVkTW9kZShzaG91bGRPdmVybGFwID09PSBcIm92ZXJsYXBwZWRcIik7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIGFuaW1hdGVkIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcGFyYW0ge2Jvb2xlYW59IHNob3VsZEFuaW1hdGUgQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIFN0b3J5TWFwIHNob3VsZCBiZSBhbmltYXRlZFxuKlx0b3Igbm90XG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2V0SXNBbmltYXRlZCA9IGZ1bmN0aW9uIChzaG91bGRBbmltYXRlKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuYW5pbUNoZWNrYm94KS5wcm9wKFwiY2hlY2tlZFwiLCBzaG91bGRBbmltYXRlKTtcblx0dGhpcy5lbmFibGVBbmltUGFyYW1ldGVycyhzaG91bGRBbmltYXRlKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgdGltZSBiZXR3ZWVuIHNsaWRlcyBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtOdW1iZXJ9IHRpbWUgVGhlIG51bWJlciBvZiBzZWNvbmRzIHRoZSBTdG9yeU1hcCB3YWl0cyBiZWZvcmUgbW92aW5nIHRvIHRoZSBuZXh0XG4qXHRzbGlkZVxuKi9cblNldHRpbmdzUGFuZWwucHJvdG90eXBlLnNldFRpbWVCZXR3ZWVuU2xpZGVzID0gZnVuY3Rpb24gKHRpbWUpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5jYXJvdXNlbFRpbWUpLnZhbCh0aW1lKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgc2hvdWxkIHBhdXNlIG9uIGhvdmVyIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcGFyYW0ge2Jvb2xlYW59IHNob3VsZFBhdXNlIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBzaG91bGQgYmUgcGF1c2VkXG4qXHR3aGVuIHRoZSBtb3VzZSBpcyBob3ZlcmluZyB0aGUgc2xpZGUgb3Igbm90XG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2V0UGF1c2VPbkhvdmVyID0gZnVuY3Rpb24gKHNob3VsZFBhdXNlKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMucGF1c2VDaGVja2JveCkucHJvcChcImNoZWNrZWRcIiwgc2hvdWxkUGF1c2UpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBzaG91bGQgc3RhcnQgb24gbG9hZCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRTdGFydCBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHN0YXJ0IHRoZVxuKlx0YW5pbWF0aW9uIG9uIGxvYWQgb3Igbm90XG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2V0U3RhcnRPbkxvYWQgPSBmdW5jdGlvbiAoc2hvdWxkU3RhcnQpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5yaWRlQ2hlY2tib3gpLnByb3AoXCJjaGVja2VkXCIsIHNob3VsZFN0YXJ0KTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgYW5pbWF0ZSBvbiBmaXJzdCBzbGlkZSBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRTdGFydCBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHN0YXJ0IHRoZSBhbmltYXRpb25cbipcdGFmdGVyIHRoZSBmaXJzdCBzbGlkZSBpcyB2aWV3ZWQgb3Igbm90XG4qL1xuU2V0dGluZ3NQYW5lbC5wcm90b3R5cGUuc2V0QW5pbU9uRmlyc3RTbGlkZSA9IGZ1bmN0aW9uIChzaG91bGRBbmltYXRlKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuYWZ0ZXJGaXJzdENoZWNrYm94KS5wcm9wKFwiY2hlY2tlZFwiLCBzaG91bGRBbmltYXRlKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgbG9vcCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRTdGFydCBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIGxvb3Agd2hlbiB0aGUgbGFzdFxuKlx0c2xpZGUgaXMgcmVhY2hlZCBvciBub3RcbiovXG5TZXR0aW5nc1BhbmVsLnByb3RvdHlwZS5zZXRMb29wID0gZnVuY3Rpb24gKHNob3VsZExvb3ApIHtcblxuXHQkKHRoaXMub3B0aW9ucy53cmFwQ2hlY2tib3gpLnByb3AoXCJjaGVja2VkXCIsIHNob3VsZExvb3ApO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsICQsIFNsaWRlSWNvbiovXG5cbi8qKlxuKlx0Q29uc3RydWN0cyBhIFNsaWRlQmFyIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgdGhlIGNvbnRhaW5lciB3aGVyZSB0aGUgaWNvbnMgd2lsbCBiZSBwbGFjZWQgYW5kXG4qXHR3aGVyZSB0aGUgYWRkIHNsaWRlIGJ1dHRvbiBhbmQgc2F2ZSBzdG9yeSBtYXAgYnV0dG9uIGFyZSBsb2NhdGVkXG4qXHRAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXNcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBzbGlkZXNDb250YWluZXJJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGNvbnRhaW5lciBlbGVtZW50XG4qXHRAcHJvcGVydHkge1N0cmluZ30gc2xpZGVMaXN0SWQgVGhlIERPTSBub2RlIGlkIG9mIHRoZSBzbGlkZSBsaXN0XG4qXHRAcHJvcGVydHkge1N0cmluZ30gYWRkU2xpZGVCdXR0b24gVGhlIERPTSBub2RlIGlkIG9mIHRoZSBhZGQgc2xpZGUgYnV0dG9uXG4qXHRAcHJvcGVydHkge1N0cmluZ30gc2F2ZVN0b3J5bWFwQnV0dG9uIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgc2F2ZSBzdG9yeSBuYW8gYnV0dG9uXG4qL1xuZnVuY3Rpb24gU2xpZGVCYXIob3B0aW9ucykge1xuXG5cdHZhciBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cdFx0c2xpZGVzQ29udGFpbmVySWQ6IFwiI3NsaWRlc0NvbnRhaW5lclwiLFxuXHRcdHNsaWRlTGlzdElkOiBcIiNzbGlkZUxpc3RcIixcblx0XHRhZGRTbGlkZUJ1dHRvbjogXCIjc3RvcnltYXBfYWRkX3NsaWRlXCIsXG5cdFx0c2F2ZVN0b3J5bWFwQnV0dG9uOiBcIiNzdG9yeW1hcF9zYXZlXCJcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMuc29ydGFibGVTdGFydCA9IDA7XG5cdHRoaXMuc29ydGFibGVFbmQgPSAwO1xuXHR0aGlzLmFkZEV2ZW50cygpO1xufVxuXG4vKipcbipcdEFkZHMgdGhlIGV2ZW50cyB0aGUgU2xpZGVCYXIgc2hvdWxkIHJlc3BvbmQgdG9cbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKlx0QGVtaXRzIFwiU2xpZGVCYXI6YWRkU2xpZGVQcmVzc2VkXCIgd2hlbiB0aGUgYWRkIHNsaWRlIGJ1dHRvbiBpcyBwcmVzc2VkXG4qXHRAZW1pdHMgXCJTbGlkZUJhcjpzYXZlU3RvcnltYXBQcmVzc2VkXCIgd2hlbiB0aGUgc2F2ZSBzdG9yeSBtYXAgYnV0dG9uIGlzIHByZXNzZWRcbiovXG5TbGlkZUJhci5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy5hZGRTbGlkZUJ1dHRvbikuY2xpY2soZnVuY3Rpb24gKCkge1xuXG5cdFx0JChzZWxmKS50cmlnZ2VyKFwiU2xpZGVCYXI6YWRkU2xpZGVQcmVzc2VkXCIpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5zYXZlU3RvcnltYXBCdXR0b24pLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuXHRcdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlQmFyOnNhdmVTdG9yeW1hcFByZXNzZWRcIik7XG5cdH0pO1xuXG5cdCQoc2VsZi5vcHRpb25zLnNsaWRlTGlzdElkKS5zb3J0YWJsZSh7XG5cdFx0YXhpczogXCJ5XCIsXG5cdFx0Y3Vyc29yOiBcIm1vdmVcIixcblx0XHRpdGVtczogXCIuc2xpZGVcIixcblx0XHRzdGFydDogZnVuY3Rpb24gc3RhcnQoZXZlbnQsIHVpKSB7XG5cblx0XHRcdHZhciBzbGlkZUluZGV4ID0gJChcIi5zbGlkZVwiKS5pbmRleCh1aS5pdGVtKTtcblx0XHRcdHNlbGYuc29ydGFibGVTdGFydCA9IHNsaWRlSW5kZXg7XG5cdFx0fSxcblx0XHRzdG9wOiBmdW5jdGlvbiBzdG9wKGV2ZW50LCB1aSkge1xuXG5cdFx0XHRzZWxmLnNvcnRhYmxlRW5kID0gJChcIi5zbGlkZVwiKS5pbmRleCh1aS5pdGVtKTtcblxuXHRcdFx0aWYgKHNlbGYuc29ydGFibGVTdGFydCAhPT0gc2VsZi5zb3J0YWJsZUVuZCkge1xuXG5cdFx0XHRcdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlQmFyOnNsaWRlTW92ZWRcIiwgW3NlbGYuc29ydGFibGVTdGFydCwgc2VsZi5zb3J0YWJsZUVuZF0pO1xuXG5cdFx0XHRcdHNlbGYudXBkYXRlU2xpZGVOdW1zKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuKlx0QWRkcyBhbiBzbGlkZSB0byB0aGUgU2xpZGVCYXJcbipcdEBwYXJhbSB7Ym9vbGVhbn0gY2xpY2sgQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIHNsaWRlIG11c3QgYmUgY2xpY2tlZCBhZnRlclxuKlx0YmVpbmcgYWRkZWQuIFVzZWZ1bCB3aGVuIHlvdSB3YW50IHRoZSBqdXN0IGFkZGVkIHNsaWRlIHRvIGJlIHNlbGVjdGVkXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QGVtaXRzIFwiU2xpZGVCYXI6c2xpZGVTZWxlY3RlZFwiIHdoZW4gdGhlIHNsaWRlIGlzIHNlbGVjdGVkXG4qXHRAZW1pdHMgXCJTbGlkZUJhcjpkZWxldGVTbGlkZVByZXNzZWRcIiB3aGVuIHRoZSBzbGlkZSBkZWxldGUgYnV0dG9uIGlzIHByZXNzZWRcbiovXG5TbGlkZUJhci5wcm90b3R5cGUuYWRkU2xpZGUgPSBmdW5jdGlvbiAoY2xpY2spIHtcblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdHZhciBzaG91bGRDbGljayA9IGNsaWNrIHx8IGNsaWNrID09PSB1bmRlZmluZWQ7XG5cblx0dmFyIHNsaWRlID0gbmV3IFNsaWRlSWNvbigpO1xuXHRzbGlkZS5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpO1xuXG5cdCQoc2xpZGUpLm9uKFwiU2xpZGU6ZGVsZXRlUHJlc3NlZFwiLCBmdW5jdGlvbiAoZXZlbnQsIGlkKSB7XG5cblx0XHQkKHNlbGYpLnRyaWdnZXIoXCJTbGlkZUJhcjpkZWxldGVTbGlkZVByZXNzZWRcIiwgW2lkXSk7XG5cdH0pO1xuXG5cdCQoc2xpZGUpLm9uKFwiU2xpZGU6c2VsZWN0ZWRcIiwgZnVuY3Rpb24gKGV2ZW50LCBpZCkge1xuXG5cdFx0c2VsZi5zbGlkZVNlbGVjdGVkSWQgPSBpZDtcblx0XHQkKHNlbGYpLnRyaWdnZXIoXCJTbGlkZUJhcjpzbGlkZVNlbGVjdGVkXCIsIFtpZF0pO1xuXHR9KTtcblxuXHQkKHRoaXMub3B0aW9ucy5zbGlkZXNDb250YWluZXJJZCkuc2Nyb2xsVG9wKE1hdGgubWF4KDAsICQodGhpcy5vcHRpb25zLnNsaWRlTGlzdElkKS5oZWlnaHQoKSAtICQodGhpcy5vcHRpb25zLnNsaWRlTGlzdElkKS5wYXJlbnQoKS5oZWlnaHQoKSkpO1xuXG5cdGlmIChzaG91bGRDbGljaykge1xuXG5cdFx0c2xpZGUuY2xpY2tlZCgpO1xuXHR9XG5cblx0c2VsZi51cGRhdGVTbGlkZU51bXMoKTtcbn07XG5cbi8qKlxuKlx0QWRkcyBhbiBhcnJheSBvZiBzbGlkZXMgdG8gdGhlIFNsaWRlQmFyXG4qXHRAcGFyYW0ge0FycmF5fSBzbGlkZXMgQW4gYXJyYXkgb2Ygc2xpZGUgb2JqZWN0cyB3aXRoIGEgdGl0b2wgcHJvcGVydHlcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2xpZGVCYXIucHJvdG90eXBlLmFkZFNsaWRlcyA9IGZ1bmN0aW9uIChzbGlkZXMpIHtcblxuXHRmb3IgKHZhciBpID0gMCwgbGVuID0gc2xpZGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG5cblx0XHR0aGlzLmFkZFNsaWRlKGkgPT09IGxlbiAtIDEpO1xuXHRcdHZhciB0aXRvbCA9IHNsaWRlc1tpXS50aXRvbC50cmltKCkgIT09IFwiXCIgPyBzbGlkZXNbaV0udGl0b2wgOiBcIihTZW5zZSB0w610b2wpXCI7XG5cdFx0JCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQgKyBcIiBsaTpudGgtY2hpbGQoXCIgKyAoaSArIDEpICsgXCIpIC5zbGlkZS10aXRsZVwiKS5odG1sKHRpdG9sKTtcblx0fVxufTtcblxuLyoqXG4qXHRSZW1vdmVzIGEgc2xpZGUgZnJvbSB0aGUgU2xpZGVCYXJcbipcdEBwYXJhbSB7TnVtYmVyfSBudW0gVGhlIHBvc2l0aW9uIG9mIHRoZSBzbGlkZSB0byBiZSByZW1vdmVkIGluIHRoZSBTbGlkZUJhclxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5TbGlkZUJhci5wcm90b3R5cGUucmVtb3ZlU2xpZGUgPSBmdW5jdGlvbiAobnVtKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQgKyBcIiBsaTpudGgtY2hpbGQoXCIgKyAobnVtICsgMSkgKyBcIilcIikucmVtb3ZlKCk7XG5cdHRoaXMudXBkYXRlU2xpZGVOdW1zKCk7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIHRpdGxlIG9mIGEgc2xpZGUgb24gdGhlIFNsaWRlQmFyXG4qXHRAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgc2xpZGUgdGl0bGVcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2xpZGVCYXIucHJvdG90eXBlLnNldFNsaWRlVGl0bGUgPSBmdW5jdGlvbiAodGV4dCkge1xuXG5cdHZhciB0aXRsZSA9IHRleHQudHJpbSgpICE9PSBcIlwiID8gdGV4dCA6IFwiKFNlbnNlIHTDrXRvbClcIjtcblx0JCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQgKyBcIiBsaS5zZWxlY3RlZCAuc2xpZGUtdGl0bGVcIikuaHRtbCh0aXRsZSk7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIHRpdGxlIG9mIGEgc2xpZGUgb24gdGhlIFNsaWRlQmFyXG4qXHRAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgc2xpZGUgdGl0bGVcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2xpZGVCYXIucHJvdG90eXBlLnVwZGF0ZVNsaWRlTnVtcyA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5zbGlkZUxpc3RJZCArIFwiIC5zbGlkZS1udW1cIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW0pIHtcblxuXHRcdCQoZWxlbSkuaHRtbChpbmRleCArIDEpO1xuXHR9KTtcbn07XG5cbi8qKlxuKlx0UmVtb3ZlcyBhbGwgdGhlIFNsaWRlSWNvbnMgZnJvbSB0aGUgU2lkZUJhclxuKlx0QGFjY2VzcyBwdWJsaWNcbiovXG5TbGlkZUJhci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG5cblx0JChcIlwiICsgdGhpcy5vcHRpb25zLnNsaWRlTGlzdElkKS5odG1sKFwiXCIpO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsICQsIF8qL1xuXG4vKipcbipcdENvbnN0cnVjdHMgYSBTbGlkZUljb24gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhIHNsaWRlIGljb24gb24gdGhlIHNsaWRlIGJhclxuKlx0QHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzXG4qXHRAcHJvcGVydHkge1N0cmluZ30gdGVtcGxhdGVJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIHRlbXBsYXRlIHVzZWQgd2hlbiBhIHNsaWRlIGlzIGFkZGVkXG4qXHRAcHJvcGVydHkge1N0cmluZ30gc2xpZGVDbGFzcyBUaGUgRE9NIG5vZGUgY2xhc3Mgb2YgdGhlIHNsaWRlIGljb25zXG4qL1xuZnVuY3Rpb24gU2xpZGVJY29uKG9wdGlvbnMpIHtcblxuXHR2YXIgX2RlZmF1bHRPcHRpb25zID0ge1xuXG5cdFx0dGVtcGxhdGVJZDogXCIjc3RvcnltYXBfc2xpZGVfdGVtcGxhdGVcIixcblx0XHRzbGlkZUNsYXNzOiBcIi5zbGlkZVwiXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuXHR0aGlzLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZUlkKS5odG1sKCkudHJpbSgpKTtcblx0dGhpcy5zbGlkZURPTUVsZW0gPSAkKHRoaXMudGVtcGxhdGUodGhpcy5vcHRpb25zKSk7XG5cdHRoaXMuZGVsZXRlRE9NRWxlbSA9ICQoXCI8YSBjbGFzcz1cXFwiY2xvc2VcXFwiIGhyZWY9XFxcImphdmFzY3JpcHQ6XFxcIj4mbmJzcDs8L2E+XCIpO1xuXG5cdHRoaXMuYWRkRXZlbnRzKCk7XG59XG5cbi8qKlxuKlx0QWRkcyB0aGUgZXZlbnRzIHRoZSBTbGlkZUljb24gc2hvdWxkIHJlc3BvbmQgdG9cbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblNsaWRlSWNvbi5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRzZWxmLnNsaWRlRE9NRWxlbS5jbGljayhmdW5jdGlvbiAoKSB7XG5cblx0XHRzZWxmLmNsaWNrZWQoKTtcblx0fSk7XG5cblx0c2VsZi5kZWxldGVET01FbGVtLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYuZGVsZXRlQnV0dG9uUHJlc3NlZCgpO1xuXHR9KTtcbn07XG5cbi8qKlxuKlx0VHJpZ2dlcnMgYSBzbGlkZSBzZWxlY3RlZCBldmVudCB3aXRoIGl0cyBpZCBhcyBhbiBldmVudCBhdHRyaWJ1dGUgYW5kIGNoYW5nZXMgaXRzIGNsYXNzXG4qXHR0byBzZWxlY3RlZFxuKlx0QGFjY2VzcyBwcml2YXRlXG4qXHRAZW1pdHMgXCJTbGlkZTpzZWxlY3RlZFwiXG4qL1xuU2xpZGVJY29uLnByb3RvdHlwZS5jbGlja2VkID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHR2YXIgY3VycmVudFNsaWRlSW5kZXggPSAkKHNlbGYub3B0aW9ucy5zbGlkZUNsYXNzKS5pbmRleChzZWxmLnNsaWRlRE9NRWxlbSk7XG5cdCQoXCI6Zm9jdXNcIikuYmx1cigpOyAvLyBmb3JjZSBjaGFuZ2UgZXZlbnQhXG5cblx0JChzZWxmKS50cmlnZ2VyKFwiU2xpZGU6c2VsZWN0ZWRcIiwgW2N1cnJlbnRTbGlkZUluZGV4XSk7XG5cblx0JCh0aGlzLm9wdGlvbnMuc2xpZGVDbGFzcyArIFwiLnNlbGVjdGVkXCIpLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG5cdCQoc2VsZi5zbGlkZURPTUVsZW0pLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG5cblx0cmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4qXHRUcmlnZ2VycyBhIHJlbW92ZSBzbGlkZSBldmVudCB3aXRoIGl0cyBpZCBhcyBhbiBldmVudCBhdHRyaWJ1dGVcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKlx0QGVtaXRzIFwiU2xpZGU6ZGVsZXRlUHJlc3NlZFwiXG4qL1xuU2xpZGVJY29uLnByb3RvdHlwZS5kZWxldGVCdXR0b25QcmVzc2VkID0gZnVuY3Rpb24gKCkge1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHR2YXIgY3VycmVudFNsaWRlSW5kZXggPSAkKHNlbGYub3B0aW9ucy5zbGlkZUNsYXNzKS5pbmRleChzZWxmLnNsaWRlRE9NRWxlbSk7XG5cdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlOmRlbGV0ZVByZXNzZWRcIiwgW2N1cnJlbnRTbGlkZUluZGV4XSk7XG59O1xuXG4vKipcbipcdEFwcGVuZHMgdGhlIHNsaWRlIGljb24gdG8gYSBET00gbm9kZVxuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEBwYXJhbSB7c3RyaW5nfSBUaGUgRE9NIG5vZGUgaWQgd2hlcmUgdGhlIHNsaWRlIHdpbGwgYmUgYXBwZW5kZWRcbiovXG5TbGlkZUljb24ucHJvdG90eXBlLmFwcGVuZFRvID0gZnVuY3Rpb24gKGlkKSB7XG5cblx0dGhpcy5zbGlkZURPTUVsZW0uYXBwZW5kVG8oaWQpO1xuXHR0aGlzLmRlbGV0ZURPTUVsZW0uYXBwZW5kVG8odGhpcy5zbGlkZURPTUVsZW0pO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsIEluZm9QYW5lbCwgU2V0dGluZ3NQYW5lbCwgVXRpbHMsICQqL1xuXG4vKipcbipcdENvbnN0cnVjdHMgYSBTbGlkZUluZm8gcGFuZWwgb2JqZWN0IHRoYXQgc3RvcmVzIHRoZSB3aW5kb3cgd2hlcmUgdGhlIHNsaWRlIGlzIHNob3duIGFuZCB0aGVcbipcdHJpZ2h0IGJhciB3aGVyZSB0aGUgc2xpZGUgY29udGVudHMgYW5kIHN0b3J5IG1hcCBzZXR0aW5ncyBhcmUgc2hvd25cbipcdEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllc1xuKlx0QHByb3BlcnR5IHtTdHJpbmd9IGluZm9CdXR0b25JZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGJ1dHRvbiB1c2VkIHRvIHNob3cgdGhlIGluZm8gcGFuZWxcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBzZXR0aW5nc0J1dHRvbklkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgYnV0dG9uIHVzZWQgdG8gc2hvdyB0aGUgc2V0dGluZ3MgcGFuZWxcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBjbG9zZUJ1dHRvbklkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgYnV0dG9uIHVzZWQgdG8gY2xvc2UgdGhlIHJpZ2h0IGJhclxuKlx0QHByb3BlcnR5IHtTdHJpbmd9IGlGcmFtZUlkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgaWZyYW1lIGVsZW1lbnQgd2hlcmUgdGhlIHNsaWRlIGlzIHNob3duXG4qXHRAcHJvcGVydHkge1N0cmluZ30gbm9VUkxJZCBUaGUgRE9NIG5vZGUgaWQgb2YgdGhlIGRpdiBzaG93biB3aGVuIHRoZSBzbGlkZSBkb2Vzbid0IGhhdmUgYW4gVVJMXG4qXHRAcHJvcGVydHkge1N0cmluZ30gbWVudUNvbnRhaW5lcklkIFRoZSBET00gbm9kZSBpZCBvZiB0aGUgZGl2IHRoYXQgY29udGFpbnMgdGhlIG1lbnVcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBtYXBhRnJhbWUgVGhlIERPTSBub2RlIGlkIG9mIHRoZSBkaXYgdGhhdCBjb250YWlucyBib3RoIHRoZSBpZnJhbWUgYW5kIHRoZVxuKlx0bm9VUkwgZGl2XG4qL1xuZnVuY3Rpb24gU2xpZGVJbmZvKG9wdGlvbnMpIHtcblxuXHR2YXIgX2RlZmF1bHRPcHRpb25zID0ge1xuXG5cdFx0aW5mb0J1dHRvbklkOiBcIiNvYnJpcl9tZW51XCIsXG5cdFx0c2V0dGluZ3NCdXR0b25JZDogXCIjc2V0dGluZ3NfbWVudVwiLFxuXHRcdGNsb3NlQnV0dG9uSWQ6IFwiI2hpZGVfbWVudVwiLFxuXHRcdGlGcmFtZUlkOiBcIiNpbnN0YW1hcHNNYXBcIixcblx0XHRub1VSTElkOiBcIiNub1VSTExvYWRlZFwiLFxuXHRcdG1lbnVDb250YWluZXJJZDogXCIjbWFwdmlld2VyLWZsb2F0aW5nLXNpZGVtZW51XCIsXG5cdFx0bWFwYUZyYW1lOiBcIiNtYXBhRnJhbWVcIlxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cdHRoaXMuaXNEaXJ0eSA9IGZhbHNlO1xuXHR0aGlzLmluZm9QYW5lbCA9IG5ldyBJbmZvUGFuZWwoKTtcblx0dGhpcy5zZXR0aW5nc1BhbmVsID0gbmV3IFNldHRpbmdzUGFuZWwoKTtcblx0dGhpcy5jdXJyZW50UGFuZWwgPSB0aGlzLmluZm9QYW5lbDtcblxuXHR0aGlzLmFkZEV2ZW50cygpO1xuXHR0aGlzLnJlc2V0KCk7XG59XG5cbi8qKlxuKlx0QWRkcyB0aGUgZXZlbnRzIHRoZSBTbGlkZUluZm8gcGFuZWwgc2hvdWxkIHJlc3BvbmQgdG9cbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy5pbmZvQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0aWYgKCQoc2VsZi5vcHRpb25zLm1lbnVDb250YWluZXJJZCkuaGFzQ2xhc3MoXCJoaWRlRmxvYXRpbmdNZW51XCIpKSB7XG5cblx0XHRcdHNlbGYub3BlbigpO1xuXHRcdH0gZWxzZSBpZiAoX3RoaXMuaW5mb1BhbmVsID09PSBfdGhpcy5jdXJyZW50UGFuZWwpIHtcblxuXHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdH1cblxuXHRcdHNlbGYuc2hvd0luZm9QYW5lbCgpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5zZXR0aW5nc0J1dHRvbklkKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdGlmICgkKHNlbGYub3B0aW9ucy5tZW51Q29udGFpbmVySWQpLmhhc0NsYXNzKFwiaGlkZUZsb2F0aW5nTWVudVwiKSkge1xuXG5cdFx0XHRzZWxmLm9wZW4oKTtcblx0XHR9IGVsc2UgaWYgKF90aGlzLnNldHRpbmdzUGFuZWwgPT09IF90aGlzLmN1cnJlbnRQYW5lbCkge1xuXG5cdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0fVxuXG5cdFx0c2VsZi5zaG93U2V0dGluZ3NQYW5lbCgpO1xuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5jbG9zZUJ1dHRvbklkKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcblxuXHRcdHNlbGYuY2xvc2UoKTtcblx0fSk7XG5cblx0JCh0aGlzLnNldHRpbmdzUGFuZWwpLm9uKFwiU2V0dGluZ3M6b3ZlcmxhcHBpbmdDaGFuZ2VkXCIsIGZ1bmN0aW9uIChldmVudCwgaXNPdmVybGFwcGVkKSB7XG5cblx0XHRpZiAoaXNPdmVybGFwcGVkKSB7XG5cblx0XHRcdCQoX3RoaXMub3B0aW9ucy5tYXBhRnJhbWUpLnJlbW92ZUNsYXNzKFwiY29sbGFwc2VkXCIpO1xuXHRcdFx0JChfdGhpcy5vcHRpb25zLm1hcGFGcmFtZSkuYWRkQ2xhc3MoXCJleHBhbmRlZFwiKTtcblx0XHR9IGVsc2Uge1xuXG5cdFx0XHQkKF90aGlzLm9wdGlvbnMubWFwYUZyYW1lKS5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpO1xuXHRcdFx0JChfdGhpcy5vcHRpb25zLm1hcGFGcmFtZSkuYWRkQ2xhc3MoXCJjb2xsYXBzZWRcIik7XG5cdFx0fVxuXHR9KTtcblxuXHQkKHRoaXMuaW5mb1BhbmVsKS5vbihcIkluZm9QYW5lbDpsb2FkVVJMXCIsIGZ1bmN0aW9uIChldmVudCwgdXJsKSB7XG5cblx0XHRpZiAodXJsLnRyaW0oKSA9PT0gXCJcIikge1xuXG5cdFx0XHQkKF90aGlzLm9wdGlvbnMubm9VUkxJZCkuc2hvdygpO1xuXHRcdFx0JChfdGhpcy5vcHRpb25zLmlGcmFtZUlkKS5oaWRlKCk7XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0JChzZWxmLm9wdGlvbnMuaUZyYW1lSWQpLmF0dHIoXCJzcmNcIiwgVXRpbHMuYWRkUHJvdG9jb2xJZk5lZWRlZCh1cmwpKTtcblx0XHRcdCQoX3RoaXMub3B0aW9ucy5ub1VSTElkKS5oaWRlKCk7XG5cdFx0XHQkKF90aGlzLm9wdGlvbnMuaUZyYW1lSWQpLnNob3coKTtcblx0XHR9XG5cdH0pO1xuXG5cdCQodGhpcy5pbmZvUGFuZWwpLm9uKFwiSW5mb1BhbmVsOmNsZWFyVVJMUHJlc3NlZFwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHQkKF90aGlzLm9wdGlvbnMubm9VUkxJZCkuc2hvdygpO1xuXHRcdCQoX3RoaXMub3B0aW9ucy5pRnJhbWVJZCkuaGlkZSgpO1xuXHRcdCQoc2VsZi5vcHRpb25zLmlGcmFtZUlkKS5hdHRyKFwic3JjXCIsIFwiXCIpO1xuXHR9KTtcbn07XG5cbi8qKlxuKlx0UmVzZXRzIHRoZSBwYW5lbCB1bmRvaW5nIHRoZSBjaGFuZ2VzIG1hZGUgYW5kIG5vdCBzYXZlZFxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcblxuXHR0aGlzLmluZm9QYW5lbC5yZXNldCgpO1xufTtcblxuLyoqXG4qXHRDbGVhbnMgdGhlIHBhbmVsXG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmNsZWFuID0gZnVuY3Rpb24gKCkge1xuXG5cdHRoaXMuaW5mb1BhbmVsLmNsZWFuKCk7XG59O1xuXG4vKipcbipcdENsb3NlcyB0aGUgcmlnaHQgYmFyXG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuXG5cdCQodGhpcy5vcHRpb25zLm1lbnVDb250YWluZXJJZCkucmVtb3ZlQ2xhc3MoXCJzaG93RmxvYXRpbmdNZW51XCIpO1xuXHQkKHRoaXMub3B0aW9ucy5tZW51Q29udGFpbmVySWQpLmFkZENsYXNzKFwiaGlkZUZsb2F0aW5nTWVudVwiKTtcblx0JCh0aGlzLm9wdGlvbnMuY2xvc2VCdXR0b25JZCkucmVtb3ZlQ2xhc3MoXCJyZXZlYWxcIik7XG59O1xuXG4vKipcbipcdE9wZW5zIHRoZSByaWdodCBiYXJcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5tZW51Q29udGFpbmVySWQpLnJlbW92ZUNsYXNzKFwiaGlkZUZsb2F0aW5nTWVudVwiKTtcblx0JCh0aGlzLm9wdGlvbnMubWVudUNvbnRhaW5lcklkKS5hZGRDbGFzcyhcInNob3dGbG9hdGluZ01lbnVcIik7XG5cdCQodGhpcy5vcHRpb25zLmNsb3NlQnV0dG9uSWQpLmFkZENsYXNzKFwicmV2ZWFsXCIpO1xufTtcblxuLyoqXG4qXHRTaG93cyB0aGUgaW5mbyBwYW5lbCBoaWRpbmcgdGhlIHNldHRpbmdzIG9uZVxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5zaG93SW5mb1BhbmVsID0gZnVuY3Rpb24gKCkge1xuXG5cdHRoaXMuaW5mb1BhbmVsLnNob3coKTtcblx0dGhpcy5zZXR0aW5nc1BhbmVsLmhpZGUoKTtcblx0dGhpcy5jdXJyZW50UGFuZWwgPSB0aGlzLmluZm9QYW5lbDtcbn07XG5cbi8qKlxuKlx0U2hvd3MgdGhlIHNldHRpbmdzIHBhbmVsIGhpZGluZyB0aGUgaW5mbyBvbmVcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUuc2hvd1NldHRpbmdzUGFuZWwgPSBmdW5jdGlvbiAoKSB7XG5cblx0dGhpcy5pbmZvUGFuZWwuaGlkZSgpO1xuXHR0aGlzLnNldHRpbmdzUGFuZWwuc2hvdygpO1xuXHR0aGlzLmN1cnJlbnRQYW5lbCA9IHRoaXMuc2V0dGluZ3NQYW5lbDtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgc2xpZGUgZGF0YSBpbnRvIHRoZSBpbmZvIHBhbmVsXG4qXHRAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSBzbGlkZSB1cmxcbipcdEBwYXJhbSB7U3RyaW5nfSB0aXRsZSBUaGUgc2xpZGUgdGl0bGVcbipcdEBwYXJhbSB7U3RyaW5nfSBkZXNjcmlwdGlvbiBUaGUgc2xpZGUgZGVzY3JpcHRpb25cbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKHVybCwgdGl0bGUsIGRlc2NyaXB0aW9uKSB7XG5cblx0dGhpcy5pbmZvUGFuZWwuc2V0RGF0YSh1cmwsIHRpdGxlLCBkZXNjcmlwdGlvbik7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNsaWRlIFVSTFxuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtTdHJpbmd9IFRoZSBzbGlkZSBVUkxcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldFVSTCA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gdGhpcy5pbmZvUGFuZWwuZ2V0VVJMKCk7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNsaWRlIHRpdGxlXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHJldHVybnMge1N0cmluZ30gVGhlIHNsaWRlIHRpdGxlXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5nZXRUaXRvbCA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gdGhpcy5pbmZvUGFuZWwuZ2V0VGl0b2woKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgc2xpZGUgZGVzY3JpcHRpb25cbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcmV0dXJucyB7U3RyaW5nfSBUaGUgc2xpZGUgZGVzY3JpcHRpb25cbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldERlc2NyaXBjaW8gPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuIHRoaXMuaW5mb1BhbmVsLmdldERlc2NyaXBjaW8oKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgb3ZlcmxhcHBpbmcgbW9kZVxuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtTdHJpbmd9IFRoZSBuYW1lIG9mIHRoZSBvdmVybGFwcGluZyBtb2RlIChcIm92ZXJsYXBwZWRcIiBvciBcIm5vbk92ZXJsYXBwZWRcIilcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldE92ZXJsYXBwaW5nTW9kZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gdGhpcy5zZXR0aW5nc1BhbmVsLmdldE92ZXJsYXBwaW5nTW9kZSgpO1xufTtcblxuLyoqXG4qXHRHZXRzIHRoZSBhbmltYXRlZCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHJldHVybnMge2Jvb2xlYW59IEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBpcyBhbmltYXRlZCBvciBub3RcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLmlzQW5pbWF0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuIHRoaXMuc2V0dGluZ3NQYW5lbC5pc0FuaW1hdGVkKCk7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHRpbWUgYmV0d2VlbiBzbGlkZXMgc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBudW1iZXIgb2Ygc2Vjb25kcyB0aGF0IHRoZSBTdG9yeU1hcCB3YWl0cyBiZWZvcmUgbW92aW5nIHRvIHRoZSBuZXh0IHNsaWRlXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5nZXRUaW1lQmV0d2VlblNsaWRlcyA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gdGhpcy5zZXR0aW5nc1BhbmVsLmdldFRpbWVCZXR3ZWVuU2xpZGVzKCk7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNob3VsZCBwYXVzZSBvbiBob3ZlciBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHJldHVybnMge2Jvb2xlYW59IEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBzaG91bGQgd2FpdCB3aGVuIHRoZSBtb3VzZSBpcyBob3ZlcmVkIG9uIHRoZVxuKlx0c2xpZGVcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNob3VsZFBhdXNlT25Ib3ZlciA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gdGhpcy5zZXR0aW5nc1BhbmVsLnNob3VsZFBhdXNlT25Ib3ZlcigpO1xufTtcblxuLyoqXG4qXHRHZXRzIHRoZSBzaG91bGQgc3RhcnQgb24gbG9hZCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHJldHVybnMge2Jvb2xlYW59IEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBzaG91bGQgc3RhcnQgd2hlbiBpdHMganVzdCBsb2FkZWRcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNob3VsZFN0YXJ0T25Mb2FkID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2hvdWxkU3RhcnRPbkxvYWQoKTtcbn07XG5cbi8qKlxuKlx0R2V0cyB0aGUgc2hvdWxkIGFuaW0gb24gZmlyc3Qgc2xpZGUgc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEByZXR1cm5zIHtib29sZWFufSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIGFuaW1hdGUgYWZ0ZXIgdGhlIGZpcnN0IHNsaWRlXG4qXHRoYXMgYmVlbiB2aWV3ZWRcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNob3VsZEFuaW1PbkZpcnN0U2xpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuIHRoaXMuc2V0dGluZ3NQYW5lbC5zaG91bGRBbmltT25GaXJzdFNsaWRlKCk7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNob3VsZCBsb29wIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcmV0dXJucyB7Ym9vbGVhbn0gQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIFN0b3J5TWFwIHNob3VsZCByZXR1cm4gdG8gdGhlIGZpcnN0IHNsaWRlXG4qXHRhZnRlciB0aGUgbGFzdCBvbmUgaXMgdmlld2VkXG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5zaG91bGRMb29wID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2hvdWxkTG9vcCgpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBvdmVybGFwcGluZyBtb2RlXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRPdmVybGFwIEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSByaWdodCBiYXIgc2hvdWxkIGJlIG92ZXJsYXBwZWRcbipcdG9yIG5vdFxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUuc2V0T3ZlcmxhcHBpbmdNb2RlID0gZnVuY3Rpb24gKHNob3VsZE92ZXJsYXApIHtcblxuXHRyZXR1cm4gdGhpcy5zZXR0aW5nc1BhbmVsLnNldE92ZXJsYXBwaW5nTW9kZShzaG91bGRPdmVybGFwKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgYW5pbWF0ZWQgc2V0dGluZ1xuKlx0QGFjY2VzcyBwdWJsaWNcbipcdEBwYXJhbSB7Ym9vbGVhbn0gc2hvdWxkQW5pbWF0ZSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIGJlIGFuaW1hdGVkXG4qXHRvciBub3RcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNldElzQW5pbWF0ZWQgPSBmdW5jdGlvbiAoc2hvdWxkQW5pbWF0ZSkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2V0SXNBbmltYXRlZChzaG91bGRBbmltYXRlKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgdGltZSBiZXR3ZWVuIHNsaWRlcyBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtOdW1iZXJ9IHRpbWUgVGhlIG51bWJlciBvZiBzZWNvbmRzIHRoZSBTdG9yeU1hcCB3YWl0cyBiZWZvcmUgbW92aW5nIHRvIHRoZSBuZXh0XG4qXHRzbGlkZVxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUuc2V0VGltZUJldHdlZW5TbGlkZXMgPSBmdW5jdGlvbiAodGltZSkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2V0VGltZUJldHdlZW5TbGlkZXModGltZSk7XG59O1xuXG4vKipcbipcdFNldHMgdGhlIHNob3VsZCBwYXVzZSBvbiBob3ZlciBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRQYXVzZSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIGJlIHBhdXNlZFxuKlx0d2hlbiB0aGUgbW91c2UgaXMgaG92ZXJpbmcgdGhlIHNsaWRlIG9yIG5vdFxuKi9cblNsaWRlSW5mby5wcm90b3R5cGUuc2V0UGF1c2VPbkhvdmVyID0gZnVuY3Rpb24gKHNob3VsZFBhdXNlKSB7XG5cblx0cmV0dXJuIHRoaXMuc2V0dGluZ3NQYW5lbC5zZXRQYXVzZU9uSG92ZXIoc2hvdWxkUGF1c2UpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBzaG91bGQgc3RhcnQgb24gbG9hZCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRTdGFydCBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIHN0YXJ0IHRoZVxuKlx0YW5pbWF0aW9uIG9uIGxvYWQgb3Igbm90XG4qL1xuU2xpZGVJbmZvLnByb3RvdHlwZS5zZXRTdGFydE9uTG9hZCA9IGZ1bmN0aW9uIChzaG91bGRTdGFydCkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2V0U3RhcnRPbkxvYWQoc2hvdWxkU3RhcnQpO1xufTtcblxuLyoqXG4qXHRTZXRzIHRoZSBhbmltYXRlIG9uIGZpcnN0IHNsaWRlIHNldHRpbmdcbipcdEBhY2Nlc3MgcHVibGljXG4qXHRAcGFyYW0ge2Jvb2xlYW59IHNob3VsZFN0YXJ0IEEgYm9vbGVhbiB0ZWxsaW5nIGlmIHRoZSBTdG9yeU1hcCBzaG91bGQgc3RhcnQgdGhlIGFuaW1hdGlvblxuKlx0YWZ0ZXIgdGhlIGZpcnN0IHNsaWRlIGlzIHZpZXdlZCBvciBub3RcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNldEFuaW1PbkZpcnN0U2xpZGUgPSBmdW5jdGlvbiAoc2hvdWxkQW5pbWF0ZSkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2V0QW5pbU9uRmlyc3RTbGlkZShzaG91bGRBbmltYXRlKTtcbn07XG5cbi8qKlxuKlx0U2V0cyB0aGUgbG9vcCBzZXR0aW5nXG4qXHRAYWNjZXNzIHB1YmxpY1xuKlx0QHBhcmFtIHtib29sZWFufSBzaG91bGRTdGFydCBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgU3RvcnlNYXAgc2hvdWxkIGxvb3Agd2hlbiB0aGUgbGFzdFxuKlx0c2xpZGUgaXMgcmVhY2hlZCBvciBub3RcbiovXG5TbGlkZUluZm8ucHJvdG90eXBlLnNldExvb3AgPSBmdW5jdGlvbiAoc2hvdWxkTG9vcCkge1xuXG5cdHJldHVybiB0aGlzLnNldHRpbmdzUGFuZWwuc2V0TG9vcChzaG91bGRMb29wKTtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGdsb2JhbCBfLCAkLCBTbGlkZUJhciwgU2xpZGVJbmZvLCBTdG9yeU1hcFNlcnZlciwgRGlhbG9nLCBMb2FkZXIsIHdpbmRvdyovXG5cbi8qKlxuKlx0Q29uc3RydWN0cyBhIFN0b3J5TWFwXG4qXHRAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXNcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSBsYW5ndWFnZSBUaGUgbGFuZ3VhZ2UgaWRlbnRpZmllclxuKlx0QHByb3BlcnR5IHtOdW1iZXJ9IG1heFNsaWRlcyBUaGUgbWF4aW11bSBudW1iZXIgb2Ygc2xpZGVzIGluIHRoZSBzdG9yeW1hcFxuKlx0QHByb3BlcnR5IHtPYmplY3R9IHN0cmluZ3MgQW4gb2JqZWN0IHdpdGggdGhlIHRyYW5zbGF0aW9uc1xuKlx0QHByb3BlcnR5IHtTdHJpbmd9IGVkaXRvclVSTCBBIHN0cmluZyB3aXRoIHRoZSBVUkwgd2hlcmUgdGhlIHVzZXIgc2hvdWxkIGJlIHBvaW50ZWQgYXQgdG8gZWRpdFxuKlx0dGhlIHN0b3J5IG1hcCB3aGVuIGl0J3MgcHVibGlzaGVkXG4qXHRAcHJvcGVydHkge1N0cmluZ30gdmlld2VyVVJMIEEgc3RyaW5nIHdpdGggdGhlIFVSTCB3aGVyZSB0aGUgdXNlciBzaG91bGQgYmUgcG9pbnRlZCBhdCB0byB2aWV3XG4qXHR0aGUgc3RvcnkgbWFwIHdoZW4gaXQncyBwdWJsaXNoZWRcbipcdEBwcm9wZXJ0eSB7U3RyaW5nfSB0aXRsZUlkIFRoZSBET00gbm9kZSBpZGVudGlmaWVyIHdoZXJlIHRoZSBzdG9yeSBtYXAgdGl0bGUgbXVzdCBiZSBzZXRcbiovXG5mdW5jdGlvbiBTdG9yeU1hcChvcHRpb25zKSB7XG5cblx0dmFyIF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdGxhbmd1YWdlOiBcImVuXCIsXG5cdFx0bWF4U2xpZGVzOiAxMixcblx0XHRzdHJpbmdzOiB7XG5cdFx0XHRlbjoge1xuXHRcdFx0XHRtYXhTbGlkZXM6IFwiTWF4aW11bSBudW1iZXIgb2Ygc2xpZGVzIHJlYWNoZWRcIixcblx0XHRcdFx0ZGVsZXRlOiBcIkRlbGV0ZSBcXFwiPDxuYW1lPj5cXFwiIHNsaWRlP1wiLFxuXHRcdFx0XHRsb2FkaW5nOiBcIkxvYWRpbmcgU3RvcnlNYXBcIixcblx0XHRcdFx0dG9TZWVBbmRTaGFyZVRleHQ6IFwiVG8gc2VlIGFuZCBzaGFyZSB0aGlzIHN0b3J5bWFwIHVzZSB0aGlzIGxpbms6XCIsXG5cdFx0XHRcdHRvRWRpdFRleHQ6IFwiSWYgeW91IHdhbnQgdG8ga2VlcCB3b3JraW5nIG9uIGl0IG9yIGNoYW5nZSBpdCBzb21lIHRpbWUgdXNlIHRoaXMgbGluazpcIixcblx0XHRcdFx0cmVtZW1iZXJUZXh0OiBcIlJlbWVtYmVyIHRoaXMgbGlua3MgYXMsIGZvciBub3csIHRoZXkgY2FuJ3QgYmUgcmV0cmlldmVkIGxhdGVyXCIsXG5cdFx0XHRcdHNlbmRCeUVtYWlsVGV4dDogXCJJZiB5b3Ugd2FudCB3ZSBjYW4gc2VuZCBpdCBieSBlbWFpbDpcIixcblx0XHRcdFx0ZW1haWxCdXR0b25UZXh0OiBcIlNlbmQgaXQhXCJcblx0XHRcdH0sXG5cdFx0XHRjYToge1xuXHRcdFx0XHRtYXhTbGlkZXM6IFwiTcOgeGltIG7Dum1lcm8gZGUgc2xpZGVzIGFzc29saXRcIixcblx0XHRcdFx0ZGVsZXRlOiBcIkVsaW1pbmEgbGEgZGlhcG9zaXRpdmEgXFxcIjw8bmFtZT4+XFxcIj9cIixcblx0XHRcdFx0bG9hZGluZzogXCJDYXJyZWdhbnQgbCdTdG9yeU1hcFwiLFxuXHRcdFx0XHR0b1NlZUFuZFNoYXJlVGV4dDogXCJQZXIgdmV1cmUgaSBjb21wYXJ0aXIgYXF1ZXN0IHN0b3J5bWFwIGVtcHJhIGzigJllbmxsYcOnOlwiLFxuXHRcdFx0XHR0b0VkaXRUZXh0OiBcIlNpIHZvbHMgc2VndWlyLWhpIHRyZWJhbGxhbnQgbyBmZXIgY2FudmlzIG3DqXMgZW5kYXZhbnQgZW1wcmEgYXF1ZXN0IGFsdHJlIGVubGxhw6c6XCIsXG5cdFx0XHRcdHJlbWVtYmVyVGV4dDogXCJSZWNvcmRhIGRlc2FyIGFxdWVzdHMgZW5sbGHDp29zLCBqYSBxdWUgYXJhIHBlciBhcmEgbm8gZXMgcG9kcmFuIHJlY3VwZXJhciBxdWFuIHRhbnF1aXMgYXF1ZXN0YSBmaW5lc3RyYS5cIixcblx0XHRcdFx0c2VuZEJ5RW1haWxUZXh0OiBcIlNpIHZvbHMgZWxzIHBvdHMgZW52aWFyIHBlciBjb3JyZXU6XCIsXG5cdFx0XHRcdGVtYWlsQnV0dG9uVGV4dDogXCJFbnZpYSdsc1wiXG5cdFx0XHR9LFxuXHRcdFx0ZXM6IHtcblx0XHRcdFx0bWF4U2xpZGVzOiBcIkhhcyBsbGVnYWRvIGFsIG7Dum1lcm8gbcOheGltbyBkZSBzbGlkZXNcIixcblx0XHRcdFx0ZGVsZXRlOiBcIkVsaW1pbmEgbGEgZGlhcG9zaXRpdmEgXFxcIjw8bmFtZT4+XFxcIj9cIixcblx0XHRcdFx0bG9hZGluZzogXCJDYXJnYW5kbyBlbCBTdG9yeU1hcFwiLFxuXHRcdFx0XHR0b1NlZUFuZFNoYXJlVGV4dDogXCJQYXJhIHZlciB5IGNvbXBhcnRpciBlc3RlIHN0b3J5bWFwIHVzYSBlbCBzaWd1aWVudGUgZW5sYWNlOlwiLFxuXHRcdFx0XHR0b0VkaXRUZXh0OiBcIlNpIHF1aWVyZXMgc2VndWlyIHRyYWJhamFuZG8gbyBoYWNlciBjYW1iaW9zIG1hcyBhZGVsYW50ZSB1c2EgZXNlIGVubGFjZTpcIixcblx0XHRcdFx0cmVtZW1iZXJUZXh0OiBcIlJlY3VlcmRhIGd1YXJkYXIgZXN0b3MgZW5sYWNlcyB5YSBxdWUgcG9yIGFob3JhIG5vIHNlIHB1ZWRlbiByZWN1cGVyYXIuXCIsXG5cdFx0XHRcdHNlbmRCeUVtYWlsVGV4dDogXCJTaSBxdWllcmVzIGxvcyBwdWVkZXMgZW52aWFyIHBvciBjb3JyZW86XCIsXG5cdFx0XHRcdGVtYWlsQnV0dG9uVGV4dDogXCJFbnZpYWxvc1wiXG5cdFx0XHR9XG5cdFx0fSxcblx0XHRlZGl0b3JVUkw6IFwiaHR0cDovL2JldGFzZXJ2ZXIyLmljZ2MuY2F0L3N0b3J5bWFwL2h0bWwvZWRpdG9yLmh0bWxcIixcblx0XHR2aWV3ZXJVUkw6IFwiaHR0cDovL2JldGFzZXJ2ZXIyLmljZ2MuY2F0L3N0b3J5bWFwL2h0bWwvdmlzb3IuaHRtbFwiLFxuXHRcdHRpdGxlSWQ6IFwiI3N0b3J5TWFwVGl0bGVcIixcblx0XHRwdWJsaXNoRGlhbG9nVGVtcGxhdGU6IFwiI3B1Ymxpc2hfbWFwX3RlbXBsYXRlXCIsXG5cdFx0c2VuZEVtYWlsQnV0dG9uSWQ6IFwiI3NlbmRFbWFpbEJ0blwiXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuXHR0aGlzLmlzRGlydHkgPSBmYWxzZTtcblx0dGhpcy5jdXJyZW50RGVsZXRpb25JbmRleCA9IC0xO1xuXHR0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4ID0gLTE7XG5cdHRoaXMuc2xpZGVzID0gW107XG5cdHRoaXMuaWRFZGl0b3IgPSBcIlwiO1xuXHR0aGlzLmlkU3RvcnlNYXAgPSBcIlwiO1xuXHR0aGlzLnNsaWRlQmFyID0gbmV3IFNsaWRlQmFyKCk7XG5cdHRoaXMuc2xpZGVJbmZvUGFuZWwgPSBuZXcgU2xpZGVJbmZvKCk7XG5cdHRoaXMuZGVsZXRlRGlhbG9nID0gbmV3IERpYWxvZygpO1xuXHR0aGlzLm1heFNsaWRlc0RpYWxvZyA9IG5ldyBEaWFsb2coeyBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSB9KTtcblx0dGhpcy5tYXhTbGlkZXNEaWFsb2cuc2V0TWVzc2FnZSh0aGlzLm9wdGlvbnMuc3RyaW5nc1t0aGlzLm9wdGlvbnMubGFuZ3VhZ2VdLm1heFNsaWRlcyk7XG5cdHRoaXMucHVibGlzaERpYWxvZyA9IG5ldyBEaWFsb2coeyBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSB9KTtcblx0dGhpcy5zZXJ2ZXIgPSBuZXcgU3RvcnlNYXBTZXJ2ZXIoKTtcblx0dGhpcy5sb2FkZXIgPSBuZXcgTG9hZGVyKCk7XG5cdHRoaXMucHVibGlzaFRlbXBsYXRlID0gJCh0aGlzLm9wdGlvbnMucHVibGlzaERpYWxvZ1RlbXBsYXRlKS5odG1sKCkudHJpbSgpO1xuXHR0aGlzLnNlbmRFbWFpbEJ1dHRvbiA9ICQodGhpcy5vcHRpb25zLnNlbmRFbWFpbEJ1dHRvbklkKTtcblxuXHR0aGlzLmFkZEV2ZW50cygpO1xuXHR0aGlzLl9hZGRTbGlkZSgpO1xufVxuXG4vKipcbipcdEFkZHMgdGhlIGV2ZW50cyB0aGUgc3RvcnkgbWFwIHNob3VsZCByZXNwb25kIHRvXG4qXHRAYWNjZXNzIHByaXZhdGVcbiovXG5TdG9yeU1hcC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdHZhciBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYuc2xpZGVCYXIpLm9uKFwiU2xpZGVCYXI6c2F2ZVN0b3J5bWFwUHJlc3NlZFwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHRzZWxmLl91cGRhdGVDdXJyZW50U2xpZGVEYXRhKCk7XG5cdFx0c2VsZi5sb2FkZXIuc2V0VGl0bGUoXCJHdWFyZGFudCBsJ1N0b3J5bWFwXCIpO1xuXHRcdHNlbGYubG9hZGVyLnNob3coKTtcblxuXHRcdHNlbGYuc2F2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRzZWxmLmxvYWRlci5oaWRlKCk7XG5cdFx0XHRzZWxmLnB1Ymxpc2goKTtcblx0XHR9KTtcblx0fSk7XG5cblx0JChzZWxmLnNsaWRlQmFyKS5vbihcIlNsaWRlQmFyOnNsaWRlU2VsZWN0ZWRcIiwgZnVuY3Rpb24gKGV2ZW50LCBpZCkge1xuXG5cdFx0Ly8gR2V0IHRoZSBkYXRhIGZyb20gdGhlIGluZm8gcGFuZWwgYW5kIGFkZCBpdCB0byB0aGUgY3VycmVudCBzbGlkZVxuXHRcdHNlbGYuX3VwZGF0ZUN1cnJlbnRTbGlkZURhdGEoKTtcblx0XHRzZWxmLl9zbGlkZVNlbGVjdGVkKGlkKTtcblx0fSk7XG5cblx0JChzZWxmLnNsaWRlQmFyKS5vbihcIlNsaWRlQmFyOmFkZFNsaWRlUHJlc3NlZFwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHRzZWxmLl9hZGRTbGlkZSgpO1xuXHR9KTtcblxuXHQkKHNlbGYuc2xpZGVCYXIpLm9uKFwiU2xpZGVCYXI6ZGVsZXRlU2xpZGVQcmVzc2VkXCIsIGZ1bmN0aW9uIChldmVudCwgaWQpIHtcblxuXHRcdHNlbGYuY3VycmVudERlbGV0aW9uSW5kZXggPSBpZDtcblx0XHRzZWxmLl9zaG93RGVsZXRlRGlhbG9nKGlkKTtcblx0fSk7XG5cblx0JChzZWxmLnNsaWRlQmFyKS5vbihcIlNsaWRlQmFyOnNsaWRlTW92ZWRcIiwgZnVuY3Rpb24gKGV2ZW50LCBzdGFydFBvcywgZW5kUG9zKSB7XG5cblx0XHR2YXIgdGVtcFNsaWRlID0gX3RoaXMuc2xpZGVzW3N0YXJ0UG9zXTtcblx0XHRfdGhpcy5zbGlkZXMuc3BsaWNlKHN0YXJ0UG9zLCAxKTtcblx0XHRfdGhpcy5zbGlkZXMuc3BsaWNlKGVuZFBvcywgMCwgdGVtcFNsaWRlKTtcblxuXHRcdGlmIChfdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCA9PT0gc3RhcnRQb3MpIHtcblxuXHRcdFx0X3RoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggPSBlbmRQb3M7XG5cdFx0fVxuXHR9KTtcblxuXHQkKHNlbGYuZGVsZXRlRGlhbG9nKS5vbihcIkRpYWxvZzphY2NlcHRcIiwgZnVuY3Rpb24gKCkge1xuXG5cdFx0c2VsZi5fZGVsZXRlU2xpZGUoKTtcblx0XHRzZWxmLmN1cnJlbnREZWxldGlvbkluZGV4ID0gLTE7XG5cdH0pO1xuXG5cdCQoc2VsZi5kZWxldGVEaWFsb2cpLm9uKFwiRGlhbG9nOmNhbmNlbFwiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHRzZWxmLmN1cnJlbnREZWxldGlvbkluZGV4ID0gLTE7XG5cdH0pO1xufTtcblxuLyoqXG4qXHRDcmVhdGVzIGEgc2xpZGUgZGF0YSBvYmplY3RcbipcdEBwYXJhbSB7TnVtYmVyfSBpZCBUaGUgc2xpZGUgaWRlbnRpZmllclxuKlx0QHBhcmFtIHtzdHJpbmd9IHVybCBUaGUgdXJsIHRoZSBzbGlkZSBzaG91bGQgb3BlblxuKlx0QHBhcmFtIHtzdHJpbmd9IHRpdGxlIFRoZSBzbGlkZSB0aXRsZVxuKlx0QHBhcmFtIHtzdHJpbmd9IGRlc2NyaXB0aW9uIFRoZSBzbGlkZSBkZXNjcmlwdGlvblxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU3RvcnlNYXAucHJvdG90eXBlLmNyZWF0ZVNsaWRlRGF0YSA9IGZ1bmN0aW9uIChpZCwgdXJsLCB0aXRsZSwgZGVzY3JpcHRpb24pIHtcblxuXHR2YXIgc2xpZGVJZCA9IGlkID09PSB1bmRlZmluZWQgPyAtMSA6IGlkO1xuXHR2YXIgc2xpZGVVUkwgPSB1cmwgfHwgXCJcIjtcblx0dmFyIHNsaWRlVGl0b2wgPSB0aXRsZSB8fCBcIlwiO1xuXHR2YXIgc2xpZGVEZXNjID0gZGVzY3JpcHRpb24gfHwgXCJcIjtcblxuXHR2YXIgZGF0YSA9IHtcblx0XHRpZDogc2xpZGVJZCxcblx0XHR1cmxfbWFwYTogc2xpZGVVUkwsXG5cdFx0dGl0b2w6IHNsaWRlVGl0b2wsXG5cdFx0ZGVzY3JpcGNpbzogc2xpZGVEZXNjXG5cdH07XG5cblx0cmV0dXJuIGRhdGE7XG59O1xuXG4vKipcbipcdEFkZHMgYSBzbGlkZSB0byB0aGUgc3RvcnkgbWFwIGlmIHdlIGhhdmVuJ3QgcmVhY2hlZCB0aGUgbWF4aW11bSBudW1iZXJcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblN0b3J5TWFwLnByb3RvdHlwZS5fYWRkU2xpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdHZhciBuID0gc2VsZi5zbGlkZXMubGVuZ3RoO1xuXHRpZiAobiA9PT0gc2VsZi5vcHRpb25zLm1heFNsaWRlcykge1xuXG5cdFx0c2VsZi5tYXhTbGlkZXNEaWFsb2cuc2hvdygpO1xuXHR9IGVsc2Uge1xuXG5cdFx0dmFyIHNsaWRlID0gc2VsZi5jcmVhdGVTbGlkZURhdGEobik7XG5cdFx0c2VsZi5zbGlkZXMucHVzaChzbGlkZSk7XG5cdFx0dGhpcy5zbGlkZUJhci5hZGRTbGlkZSgpO1xuXHRcdCQoc2VsZikudHJpZ2dlcihcIlN0b3J5TWFwOmNoYW5nZWRcIik7XG5cdH1cbn07XG5cbi8qKlxuKlx0U2VsZWN0cyBhbiBzbGlkZSBhbmQgbG9hZHMgaXRzIGRhdGEgaW50byB0aGUgaW5mbyBwYW5lbFxuKlx0QHBhcmFtIHtudW1iZXJ9IGluZGV4IFRoZSBzbGlkZSBpbmRleFxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU3RvcnlNYXAucHJvdG90eXBlLl9zbGlkZVNlbGVjdGVkID0gZnVuY3Rpb24gKGluZGV4KSB7XG5cblx0aWYgKHRoaXMuc2xpZGVzICE9PSBudWxsKSB7XG5cblx0XHR0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4ID0gaW5kZXg7XG5cdFx0dmFyIGN1cnJlbnRTbGlkZSA9IHRoaXMuc2xpZGVzW2luZGV4XTtcblx0XHR0aGlzLnNsaWRlSW5mb1BhbmVsLnNldERhdGEoY3VycmVudFNsaWRlLnVybF9tYXBhLCBjdXJyZW50U2xpZGUudGl0b2wsIGN1cnJlbnRTbGlkZS5kZXNjcmlwY2lvKTtcblx0XHR0aGlzLnNsaWRlSW5mb1BhbmVsLm9wZW4oKTtcblx0fVxufTtcblxuLyoqXG4qXHRVcGRhdGVzIHRoZSBzbGlkZSBkYXRhIHdpdGggdGhlIGRhdGEgZm91bmQgaW4gdGhlIGluZm8gcGFuZWxcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblN0b3J5TWFwLnByb3RvdHlwZS5fdXBkYXRlQ3VycmVudFNsaWRlRGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuXHRpZiAodGhpcy5zbGlkZXMgIT09IG51bGwpIHtcblxuXHRcdGlmICh0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4ICE9PSAtMSkge1xuXG5cdFx0XHR2YXIgY3VycmVudFNsaWRlID0gdGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleF07XG5cblx0XHRcdGN1cnJlbnRTbGlkZS51cmxfbWFwYSA9IHRoaXMuc2xpZGVJbmZvUGFuZWwuZ2V0VVJMKCk7XG5cdFx0XHRjdXJyZW50U2xpZGUudGl0b2wgPSB0aGlzLnNsaWRlSW5mb1BhbmVsLmdldFRpdG9sKCk7XG5cdFx0XHRjdXJyZW50U2xpZGUuZGVzY3JpcGNpbyA9IHRoaXMuc2xpZGVJbmZvUGFuZWwuZ2V0RGVzY3JpcGNpbygpO1xuXHRcdFx0dGhpcy5zbGlkZUJhci5zZXRTbGlkZVRpdGxlKGN1cnJlbnRTbGlkZS50aXRvbCk7XG5cdFx0XHR0aGlzLmlzRGlydHkgPSB0cnVlO1xuXHRcdH1cblx0fVxufTtcblxuLyoqXG4qXHRTaG93cyBhIGRlbGV0ZSBjb25maXJtYXRpb24gbW9kYWwgd2l0aCB0aGUgc2xpZGUgdGl0bGUgb24gaXRcbipcdEBwYXJhbSB7bnVtYmVyfSBpbmRleCBUaGUgc2xpZGUgaW5kZXhcbipcdEBhY2Nlc3MgcHJpdmF0ZVxuKi9cblN0b3J5TWFwLnByb3RvdHlwZS5fc2hvd0RlbGV0ZURpYWxvZyA9IGZ1bmN0aW9uIChpbmRleCkge1xuXG5cdHZhciBkYXRhID0gdGhpcy5zbGlkZXNbaW5kZXhdO1xuXHR2YXIgc2xpZGVUaXRsZSA9IGRhdGEudGl0b2wgfHwgXCIodW50aXRsZWQpXCI7XG5cblx0dGhpcy5kZWxldGVEaWFsb2cuc2V0TWVzc2FnZSh0aGlzLm9wdGlvbnMuc3RyaW5nc1t0aGlzLm9wdGlvbnMubGFuZ3VhZ2VdLmRlbGV0ZS5yZXBsYWNlKFwiPDxuYW1lPj5cIiwgc2xpZGVUaXRsZSkpO1xuXHR0aGlzLmRlbGV0ZURpYWxvZy5zaG93KCk7XG59O1xuXG4vKipcbipcdFB1c2hlcyB0aGUgc3RvcnkgbWFwIHRvIHRoZSBzZXJ2ZXJcbipcdEBhY2Nlc3MgcHVibGljXG4qL1xuU3RvcnlNYXAucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG5cdHZhciBfdGhpczIgPSB0aGlzO1xuXG5cdHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcblx0dmFyIHN0b3J5bWFwRGF0YSA9IHtcblx0XHR0aXRsZTogJCh0aGlzLm9wdGlvbnMudGl0bGVJZCkudmFsKCksXG5cdFx0b3ZlcmxhcHBpbmdNb2RlOiB0aGlzLnNsaWRlSW5mb1BhbmVsLmdldE92ZXJsYXBwaW5nTW9kZSgpLFxuXHRcdGFuaW1hdGlvbk9wdGlvbnM6IHtcblx0XHRcdGlzQW5pbWF0ZWQ6IHRoaXMuc2xpZGVJbmZvUGFuZWwuaXNBbmltYXRlZCgpLFxuXHRcdFx0dGltZUJldHdlZW5TbGlkZXM6IHRoaXMuc2xpZGVJbmZvUGFuZWwuZ2V0VGltZUJldHdlZW5TbGlkZXMoKSxcblx0XHRcdHBhdXNlT25Ib3ZlcjogdGhpcy5zbGlkZUluZm9QYW5lbC5zaG91bGRQYXVzZU9uSG92ZXIoKSxcblx0XHRcdHN0YXJ0T25Mb2FkOiB0aGlzLnNsaWRlSW5mb1BhbmVsLnNob3VsZFN0YXJ0T25Mb2FkKCksXG5cdFx0XHRhbmltT25GaXJzdDogdGhpcy5zbGlkZUluZm9QYW5lbC5zaG91bGRBbmltT25GaXJzdFNsaWRlKCksXG5cdFx0XHRsb29wOiB0aGlzLnNsaWRlSW5mb1BhbmVsLnNob3VsZExvb3AoKVxuXHRcdH0sXG5cdFx0c2xpZGVzOiB0aGlzLnNsaWRlc1xuXHR9O1xuXG5cdGlmICh0aGlzLmlkU3RvcnlNYXAgIT09IFwiXCIpIHtcblxuXHRcdGlmICh0aGlzLmlkRWRpdG9yID09PSBcIlwiKSB7XG5cblx0XHRcdC8vIFN0b3J5IG1hcCBhbHJlYWR5IGV4aXN0LCBnbyBpbnRvIGVkaXQgbW9kZVxuXHRcdFx0dGhpcy5zZXJ2ZXIuZWRpdE1hcFNsaWRlcyh0aGlzLmlkU3RvcnlNYXApLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcblxuXHRcdFx0XHR0aGlzLmlkRWRpdG9yID0gcmVzdWx0cy5pZF9lZGl0b3I7XG5cblx0XHRcdFx0dGhpcy5zZXJ2ZXIudXBkYXRlTWFwU2xpZGVzKHRoaXMuaWRFZGl0b3IsIHRoaXMuaWRTdG9yeU1hcCwgSlNPTi5zdHJpbmdpZnkoc3RvcnltYXBEYXRhKSkudGhlbihmdW5jdGlvbiAoKSB7XG5cblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKCk7XG5cdFx0XHRcdH0sIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdCgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdHRoaXMuc2VydmVyLnVwZGF0ZU1hcFNsaWRlcyh0aGlzLmlkRWRpdG9yLCB0aGlzLmlkU3RvcnlNYXAsIEpTT04uc3RyaW5naWZ5KHN0b3J5bWFwRGF0YSkpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblx0XHRcdH0sIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSBlbHNlIHtcblxuXHRcdC8vIFN0b3J5IG1hcCBkb2Vzbid0IGV4aXN0LCBidWlsZCBhIG5ldyBvbmUgd2l0aCB0aGUgY3VycmVudCBpbmZvcm1hdGlvblxuXHRcdHRoaXMuc2VydmVyLm5ld01hcFNsaWRlcyhKU09OLnN0cmluZ2lmeShzdG9yeW1hcERhdGEpKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG5cblx0XHRcdF90aGlzMi5pZFN0b3J5TWFwID0gcmVzdWx0cy5pZDtcblx0XHRcdF90aGlzMi5pZEVkaXRvciA9IHJlc3VsdHMuaWRfZWRpdG9yO1xuXHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSgpO1xuXHRcdH0sIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XG5cdFx0fSk7XG5cdH1cblxuXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xufTtcblxuLyoqXG4qXHREZWxldGVzIHRoZSBzbGlkZSBzZWxlY3RlZCB0byBkZWxldGUgcmVtb3ZpbmcgaXRzIGljb24gZnJvbSB0aGUgc2xpZGUgYmFyIGFuZCBpdHMgaW5mbyBmcm9tXG4qXHR0aGUgaW5mbyBwYW5lbFxuKlx0QGFjY2VzcyBwcml2YXRlXG4qL1xuU3RvcnlNYXAucHJvdG90eXBlLl9kZWxldGVTbGlkZSA9IGZ1bmN0aW9uICgpIHtcblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0c2VsZi5pc0RpcnR5ID0gdHJ1ZTtcblx0c2VsZi5zbGlkZXMuc3BsaWNlKHRoaXMuY3VycmVudERlbGV0aW9uSW5kZXgsIDEpO1xuXHRzZWxmLnNsaWRlQmFyLnJlbW92ZVNsaWRlKHRoaXMuY3VycmVudERlbGV0aW9uSW5kZXgpO1xuXHRzZWxmLnNsaWRlSW5mb1BhbmVsLmNsZWFuKCk7XG5cdHRoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggPSAtMTtcbn07XG5cbi8qKlxuKlx0TG9hZHMgYSBzdG9yeSBtYXAgZnJvbSB0aGUgc2VydmVyIGFuZCBpbml0cyB0aGUgZWRpdG9yIGNvbXBvbmVudHNcbipcdEBwYXJhbSB7c3RyaW5nfSBpZCBBIHN0b3J5IG1hcCBpZGVudGlmaWVyXG4qXHRAYWNjZXNzIHB1YmxpY1xuKi9cblN0b3J5TWFwLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGlkKSB7XG5cblx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdHNlbGYuaWRFZGl0b3IgPSBpZDtcblx0c2VsZi5sb2FkZXIuc2V0VGl0bGUodGhpcy5vcHRpb25zLnN0cmluZ3NbdGhpcy5vcHRpb25zLmxhbmd1YWdlXS5sb2FkaW5nKTtcblx0c2VsZi5sb2FkZXIuc2hvdygpO1xuXG5cdHNlbGYuc2VydmVyLmVkaXRNYXBTbGlkZXMoaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcblxuXHRcdHNlbGYuY3VycmVudFNlbGVjdGVkSW5kZXggPSAtMTtcblx0XHRzZWxmLmlzRGlydHkgPSBmYWxzZTtcblx0XHRzZWxmLmlkU3RvcnlNYXAgPSByZXN1bHRzLmlkO1xuXHRcdHZhciBkYXRhID0gSlNPTi5wYXJzZShyZXN1bHRzLnNsaWRlcyk7XG5cdFx0c2VsZi5zbGlkZXMgPSBkYXRhLnNsaWRlcztcblx0XHRzZWxmLnNsaWRlQmFyLmNsZWFyKCk7XG5cdFx0c2VsZi5zbGlkZUJhci5hZGRTbGlkZXMoc2VsZi5zbGlkZXMpO1xuXHRcdHNlbGYuc2xpZGVJbmZvUGFuZWwuc2V0T3ZlcmxhcHBpbmdNb2RlKGRhdGEub3ZlcmxhcHBpbmdNb2RlKTtcblx0XHRzZWxmLnNsaWRlSW5mb1BhbmVsLnNldElzQW5pbWF0ZWQoZGF0YS5hbmltYXRpb25PcHRpb25zLmlzQW5pbWF0ZWQpO1xuXHRcdHNlbGYuc2xpZGVJbmZvUGFuZWwuc2V0VGltZUJldHdlZW5TbGlkZXMoZGF0YS5hbmltYXRpb25PcHRpb25zLnRpbWVCZXR3ZWVuU2xpZGVzKTtcblx0XHRzZWxmLnNsaWRlSW5mb1BhbmVsLnNldFBhdXNlT25Ib3ZlcihkYXRhLmFuaW1hdGlvbk9wdGlvbnMucGF1c2VPbkhvdmVyKTtcblx0XHRzZWxmLnNsaWRlSW5mb1BhbmVsLnNldFN0YXJ0T25Mb2FkKGRhdGEuYW5pbWF0aW9uT3B0aW9ucy5zdGFydE9uTG9hZCk7XG5cdFx0c2VsZi5zbGlkZUluZm9QYW5lbC5zZXRBbmltT25GaXJzdFNsaWRlKGRhdGEuYW5pbWF0aW9uT3B0aW9ucy5hbmltT25GaXJzdCk7XG5cdFx0c2VsZi5zbGlkZUluZm9QYW5lbC5zZXRMb29wKGRhdGEuYW5pbWF0aW9uT3B0aW9ucy5sb29wKTtcblx0XHQkKHNlbGYub3B0aW9ucy50aXRsZUlkKS52YWwoZGF0YS50aXRsZSk7XG5cblx0XHRzZWxmLmxvYWRlci5oaWRlKCk7XG5cdH0pO1xufTtcblxuLyoqXG4qXHRTaG93cyB0aGUgcHVibGlzaCBkaWFsb2cgd2l0aCB0aGUgVVJMcyB0byBlZGl0IGFuZCB0byB2aWV3IHRoZSBjdXJyZW50IHN0b3J5bWFwXG4qXHRAYWNjZXNzIHB1YmxpY1xuKi9cblN0b3J5TWFwLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gKCkge1xuXHR2YXIgX3RoaXMzID0gdGhpcztcblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0dmFyIHVybEVkaXRvciA9IHNlbGYub3B0aW9ucy5lZGl0b3JVUkwgKyBcIj9pZD1cIiArIHNlbGYuaWRFZGl0b3I7XG5cdHZhciB1cmxWaXNvciA9IHNlbGYub3B0aW9ucy52aWV3ZXJVUkwgKyBcIj9pZD1cIiArIHNlbGYuaWRTdG9yeU1hcDtcblx0dmFyIGN1cnJlbnRMYW5ndWFnZSA9IHNlbGYub3B0aW9ucy5zdHJpbmdzW3NlbGYub3B0aW9ucy5sYW5ndWFnZV07XG5cdHZhciBtYWlsQm9keSA9IGN1cnJlbnRMYW5ndWFnZS50b1NlZUFuZFNoYXJlVGV4dCArIFwiJTBEJTBBXFxuXFx0XFx0XCIgKyB1cmxWaXNvciArIFwiJTBEJTBBXFxuXFx0XFx0JTBEJTBBXFxuXFx0XFx0XCIgKyBjdXJyZW50TGFuZ3VhZ2UudG9FZGl0VGV4dCArIFwiJTBEJTBBXFxuXFx0XFx0JTBEJTBBXFxuXFx0XFx0XCIgKyB1cmxFZGl0b3I7XG5cblx0dmFyIG1lc3NhZ2UgPSBfLnRlbXBsYXRlKHNlbGYucHVibGlzaFRlbXBsYXRlLCB7XG5cdFx0bGFuZzogc2VsZi5vcHRpb25zLnN0cmluZ3Nbc2VsZi5vcHRpb25zLmxhbmd1YWdlXSxcblx0XHR2aWV3TGluazogdXJsVmlzb3IsXG5cdFx0ZWRpdExpbms6IHVybEVkaXRvclxuXHR9KTtcblxuXHRzZWxmLnB1Ymxpc2hEaWFsb2cuc2V0TWVzc2FnZShtZXNzYWdlKTtcblx0c2VsZi5wdWJsaXNoRGlhbG9nLnNob3coKTtcblxuXHQkKHNlbGYub3B0aW9ucy5zZW5kRW1haWxCdXR0b25JZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cblx0XHR3aW5kb3cub3BlbihcIm1haWx0bzo/c3ViamVjdD1FbmxsYVxceEU3b3MgU3RvcnltYXAgXCIgKyAkKF90aGlzMy5vcHRpb25zLnRpdGxlSWQpLnZhbCgpICsgXCIuJmJvZHk9XCIgKyBtYWlsQm9keSwgXCJfc2VsZlwiKTtcblx0fSk7XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG4vKiBnbG9iYWwgJCovXG5cbi8qKlxuKlx0Q29uc3RydWN0cyBhIFN0b3J5TWFwIHNlcnZlclxuKlx0QHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzXG4qXHRAcHJvcGVydHkge3N0cmluZ30gdXJsU3RvcnlNYXAgVGhlIFVSTCB3aGVyZSB0aGUgc2VydmVyIGxpdmVzIG9uXG4qL1xuZnVuY3Rpb24gU3RvcnlNYXBTZXJ2ZXIob3B0aW9ucykge1xuXG5cdHZhciBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR1cmxTdG9yeU1hcDogXCJodHRwOi8vYmV0YXNlcnZlcjIuaWNnYy5jYXQvc3RvcnltYXBzL1wiXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbn1cblxuLyoqXG4qXHRHZXRzIHRoZSBzbGlkZXMgZnJvbSBhIHN0b3J5IG1hcCBpbiB2aWV3IG1vZGVcbipcdEBwYXJhbSB7U3RyaW5nfSBpZFN0b3J5TWFwIFRoZSBzdG9yeSBtYXAgaWRlbnRpZmllclxuKlx0QHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHNlcnZlciBjYWxsXG4qL1xuU3RvcnlNYXBTZXJ2ZXIucHJvdG90eXBlLmdldE1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZFN0b3J5TWFwKSB7XG5cblx0Ly8gRXhhbXBsZTogaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy83NjhkZGM2MC02NmUyLTExZTctYWY1ZS0wOWFmZjAwNzIzMGRcblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiR0VUXCIsXG5cdFx0dXJsOiB0aGlzLm9wdGlvbnMudXJsU3RvcnlNYXAgKyBpZFN0b3J5TWFwXG5cblx0fSk7XG59O1xuXG4vKipcbipcdEdldHMgdGhlIHNsaWRlcyBmcm9tIGEgc3RvcnkgbWFwIGluIGVkaXQgbW9kZVxuKlx0QHBhcmFtIHtTdHJpbmd9IGlkU3RvcnlNYXAgVGhlIHN0b3J5IG1hcCBpZGVudGlmaWVyXG4qXHRAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgc2VydmVyIGNhbGxcbiovXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUuZWRpdE1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZFN0b3J5TWFwKSB7XG5cblx0Ly8gRXhhbXBsZTogaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy9lZGl0Lzc2ZDIxZjAwLTQ4ZTAtNDIxNi1iYjUyLTg0YThhNDFjYzZhMlxuXHRyZXR1cm4gJC5hamF4KHtcblxuXHRcdG1ldGhvZDogXCJHRVRcIixcblx0XHR1cmw6IHRoaXMub3B0aW9ucy51cmxTdG9yeU1hcCArIFwiZWRpdC9cIiArIGlkU3RvcnlNYXBcblxuXHR9KTtcbn07XG5cbi8qKlxuKlx0UHVzaGVzIHNsaWRlcyB0byB0aGUgc2VydmVyIGNyZWF0aW5nIGEgbmV3IHN0b3J5IG1hcFxuKlx0QHBhcmFtIHtTdHJpbmd9IGpzb25TbGlkZXMgQSBKU09OLWVuY29kZWQgc3RyaW5nIHdpdGggdGhlIHN0b3J5IG1hcCBkYXRhXG4qXHRAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgc2VydmVyIGNhbGxcbiovXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUubmV3TWFwU2xpZGVzID0gZnVuY3Rpb24gKGpzb25TbGlkZXMpIHtcblxuXHQvLyBodHRwOi8vMTcyLjcwLjEuMzIvc3RvcnltYXBzL2VkaXQvXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIlBPU1RcIixcblx0XHR1cmw6IHRoaXMub3B0aW9ucy51cmxTdG9yeU1hcCArIFwiZWRpdC9cIixcblx0XHRkYXRhVHlwZTogXCJqc29uXCIsXG5cdFx0ZGF0YTogeyBpZDogMCwgaWRfZWRpdG9yOiAwLCBzbGlkZXM6IGpzb25TbGlkZXMgfVxuXG5cdH0pO1xufTtcblxuLyoqXG4qXHRQdXNoZXMgc2xpZGVzIHRvIHRoZSBzZXJ2ZXIgZWRpdGluZyBhIHN0b3J5IG1hcFxuKlx0QHBhcmFtIHtTdHJpbmd9IGlkRWRpdFN0b3J5TWFwIFRoZSBlZGl0IG1vZGUgc3RvcnkgbWFwIGlkZW50aWZpZXJcbipcdEBwYXJhbSB7U3RyaW5nfSBpZFZpZXdTdG9yeU1hcCBUaGUgdmlldyBtb2RlIHN0b3J5IG1hcCBpZGVudGlmaWVyXG4qXHRAcGFyYW0ge1N0cmluZ30ganNvblNsaWRlcyBBIEpTT04tZW5jb2RlZCBzdHJpbmcgd2l0aCB0aGUgc3RvcnkgbWFwIGRhdGFcbipcdEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSBzZXJ2ZXIgY2FsbFxuKi9cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS51cGRhdGVNYXBTbGlkZXMgPSBmdW5jdGlvbiAoaWRFZGl0U3RvcnlNYXAsIGlkVmlld1N0b3J5TWFwLCBqc29uU2xpZGVzKSB7XG5cblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiUFVUXCIsXG5cdFx0dXJsOiB0aGlzLm9wdGlvbnMudXJsU3RvcnlNYXAgKyBcImVkaXQvXCIgKyBpZEVkaXRTdG9yeU1hcCxcblx0XHRkYXRhVHlwZTogXCJqc29uXCIsXG5cdFx0ZGF0YTogeyBpZDogaWRWaWV3U3RvcnlNYXAsIGlkX2VkaXRvcjogaWRFZGl0U3RvcnlNYXAsIHNsaWRlczoganNvblNsaWRlcyB9XG5cblx0fSk7XG59O1xuXG4vKipcbipcdERlbGV0ZXMgYSBzdG9yeSBtYXBcbipcdEBwYXJhbSB7U3RyaW5nfSBpZEVkaXRTdG9yeU1hcCBUaGUgZWRpdCBtb2RlIHN0b3J5IG1hcCBpZGVudGlmaWVyXG4qXHRAcGFyYW0ge1N0cmluZ30gaWRWaWV3U3RvcnlNYXAgVGhlIHZpZXcgbW9kZSBzdG9yeSBtYXAgaWRlbnRpZmllclxuKlx0QHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHNlcnZlciBjYWxsXG4qL1xuU3RvcnlNYXBTZXJ2ZXIucHJvdG90eXBlLmRlbGV0ZU1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZEVkaXRTdG9yeU1hcCwgaWRWaWV3U3RvcnlNYXApIHtcblxuXHRyZXR1cm4gJC5hamF4KHtcblxuXHRcdG1ldGhvZDogXCJERUxFVEVcIixcblx0XHR1cmw6IHRoaXMub3B0aW9ucy51cmxTdG9yeU1hcCArIFwiZWRpdC9cIiArIGlkRWRpdFN0b3J5TWFwICsgXCIvXCIgKyBpZFZpZXdTdG9yeU1hcCxcblx0XHRjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCJcblxuXHR9KTtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKiBcbipcdENsYXNzIHRoYXQgZ3JvdXBzIHV0aWxpdHkgZnVuY3Rpb25zXG4qXHRAZXhwb3J0cyBVdGlsc1xuKi9cbnZhciBVdGlscyA9IHtcblxuXHQvKipcbiAqXHRDaGVja3MgaWYgdGhlIHByb3ZpZGVkIHVybCBpcyBhIGNvcnJlY3QtZW5jb2RlZCBVUkxcbiAqXHRAcGFyYW0ge3N0cmluZ30gdXJsIFRoZSB1cmwgdG8gY2hlY2tcbiAqXHRAcmV0dXJucyB7Ym9vbGVhbn0gQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIHVybCBpcyB2YWxpZFxuICpcdEBpbnN0YW5jZVxuICovXG5cdGlzVmFsaWRVUkw6IGZ1bmN0aW9uIGlzVmFsaWRVUkwodXJsKSB7XG5cblx0XHR2YXIgZXhwcmVzc2lvbiA9IC8oPzpodHRwcz86XFwvXFwvKT8oPzpbXFx3XStcXC4pKFthLXpBLVpcXC5dezIsNn0pKFtcXC9cXHdcXC4tXSopKlxcLz8vZ2k7XG5cdFx0dmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChleHByZXNzaW9uKTtcblxuXHRcdHJldHVybiByZWdleC50ZXN0KHVybCk7XG5cdH0sXG5cblxuXHQvKipcbiAqXHRDaGVja3MgaWYgdGhlIHByb3ZpZGVkIHRleHQgaXMgYSBjb3JyZWN0LWVuY29kZWQgZW1haWxcbiAqXHRAcGFyYW0ge3N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byBjaGVja1xuICpcdEByZXR1cm5zIHtib29sZWFufSBBIGJvb2xlYW4gdGVsbGluZyBpZiB0aGUgdGV4dCBpcyBhIHZhbGlkIGVtYWlsXG4gKlx0QGluc3RhbmNlXG4gKi9cblx0aXNWYWxpZEVtYWlsOiBmdW5jdGlvbiBpc1ZhbGlkRW1haWwodGV4dCkge1xuXG5cdFx0dmFyIGV4cHJlc3Npb24gPSAvXigoW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKSopfChcIi4rXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31dKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkLztcblx0XHR2YXIgcmVnZXggPSBuZXcgUmVnRXhwKGV4cHJlc3Npb24pO1xuXG5cdFx0cmV0dXJuIHJlZ2V4LnRlc3QodGV4dCk7XG5cdH0sXG5cblxuXHQvKipcbiAqXHRDaGVja3MgaWYgdGhlIHByb3ZpZGVkIHRleHQgaXMgbm90IGVtcHR5XG4gKlx0QHBhcmFtIHtzdHJpbmd9IHRleHQgVGhlIHRleHQgdG8gY2hlY2tcbiAqXHRAcmV0dXJucyB7Ym9vbGVhbn0gQSBib29sZWFuIHRlbGxpbmcgaWYgdGhlIHRleHQgaXMgZW10cHlcbiAqXHRAaW5zdGFuY2VcbiAqL1xuXHRpc05vdEVtcHR5OiBmdW5jdGlvbiBpc05vdEVtcHR5KHRleHQpIHtcblxuXHRcdHJldHVybiB0ZXh0LnRyaW0oKSAhPT0gXCJcIjtcblx0fSxcblxuXG5cdC8qKlxuICpcdEdlbmVyYXRlcyBhIHJhbmRvbSBsZXR0ZXJcbiAqXHRAcmV0dXJucyB7c3RyaW5nfSBBIHN0cmluZyBjb250YWluaW5nIHRoZSBsZXR0ZXIgZ2VuZXJhdGVkXG4gKlx0QGluc3RhbmNlXG4gKi9cblx0Z2V0UmFuZG9tTGV0dGVyOiBmdW5jdGlvbiBnZXRSYW5kb21MZXR0ZXIoKSB7XG5cblx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSg2NSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI2KSk7XG5cdH0sXG5cblxuXHQvKipcbiAqXHRHZW5lcmF0ZXMgYSByYW5kb20gaWRlbnRpZmllclxuICpcdEByZXR1cm5zIHtzdHJpbmd9IEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGlkZW50aWZpZXJcbiAqXHRAaW5zdGFuY2VcbiAqL1xuXHRnZXRSYW5kb21JZDogZnVuY3Rpb24gZ2V0UmFuZG9tSWQoKSB7XG5cblx0XHRyZXR1cm4gVXRpbHMuZ2V0UmFuZG9tTGV0dGVyKCkgKyBEYXRlLm5vdygpO1xuXHR9LFxuXG5cblx0LyoqXG4gKlx0QWRkcyB0aGUgcHJvdG9jb2wgdG8gYW4gVVJMIGlmIG5lZWRlZFxuICpcdEByZXR1cm5zIHtzdHJpbmd9IEEgc3RyaW5nIHdpdGggYSB1cmwgY29udGFpbmluZyBhIHByb3RvY29sXG4gKlx0QGluc3RhbmNlXG4gKi9cblx0YWRkUHJvdG9jb2xJZk5lZWRlZDogZnVuY3Rpb24gYWRkUHJvdG9jb2xJZk5lZWRlZCh1cmwpIHtcblxuXHRcdHZhciBuZXdVUkwgPSB1cmw7XG5cdFx0dmFyIGV4cHJlc3Npb24gPSAvKD86aHR0cHM/OlxcL1xcLykvZ2k7XG5cdFx0dmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChleHByZXNzaW9uKTtcblxuXHRcdGlmICghcmVnZXgudGVzdCh1cmwpKSB7XG5cblx0XHRcdG5ld1VSTCA9IFwiaHR0cDovL1wiICsgbmV3VVJMO1xuXHRcdH1cblxuXHRcdHJldHVybiBuZXdVUkw7XG5cdH1cbn07Il19
