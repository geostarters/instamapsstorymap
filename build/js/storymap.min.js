function SlideBar(i){const d={maxSlides:10,slideIconRegex:/^slide-icon-\w+$/,slidesContainerId:"#slidesContainer",slideListId:"#slideList",addSlideButton:"#storymap_add_slide"};this.options=$.extend(!0,{},d,i),this.addEvents(),this.addSlide()}SlideBar.prototype.addEvents=function(){const i=this;$(i.options.addSlideButton).click(()=>{i.addSlide()})},SlideBar.prototype.addSlide=function(){const i=this,d=new SlideIcon;d.appendTo(this.options.slideListId),$(d).on("Slide:deleted",(d,e)=>{i.removeSlide(e)}),$(this.options.slidesContainerId).scrollTop(Math.max(0,$(this.options.slideListId).height()-$(this.options.slideListId).parent().height())),d.clicked()},SlideBar.prototype.removeSlide=function(i){$(`${this.options.slideListId} li:nth-child(${i+1})`).remove()};
function SlideIcon(e){const t={text:"",templateId:"#storymap_slide_template",slideClass:".slide"};this.options=$.extend(!0,{},t,e),this.template=_.template($(this.options.templateId).html().trim()),this.slideDOMElem=$(this.template(this.options)),this.deleteDOMElem=$('<a class="close" href="javascript:">&nbsp;</a>'),this.addEvents()}SlideIcon.prototype.addEvents=function(){const e=this;e.slideDOMElem.click(()=>{e.clicked()}),e.deleteDOMElem.click(()=>{e.deleteButtonPressed()})},SlideIcon.prototype.clicked=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);return $(":focus").blur(),$(`${this.options.slideClass}.selected`).removeClass("selected"),$(e.slideDOMElem).addClass("selected"),$(e).trigger("Slide:selected",[t]),!1},SlideIcon.prototype.deleteButtonPressed=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);$(e).trigger("Slide:deleted",[t])},SlideIcon.prototype.appendTo=function(e){this.slideDOMElem.appendTo(e),this.deleteDOMElem.appendTo(this.slideDOMElem)};
function SlideInfo(t,o){const n={urlLoadButtonId:"#storymap_load",urlClearButtonId:"#storymap_unload",infoButtonId:"#obrir_menu",saveSlideButtonId:"#storymap_save_slide",urlInputId:"#urlMap",titolInputId:"#urlMap",textInputId:"#summernote",iFrameId:"#instamapsMap",iFrameContainerId:"#mapaFrame",dataContainerId:"#dataSection",defaultUrl:"https://www.instamaps.cat/geocatweb/visor.html"};this.options=$.extend(!0,{},n,o),this.addEvents(),$(this.options.textInputId).summernote()}SlideInfo.prototype.addEvents=function(){const t=this;$(t.options.urlLoadButtonId).on("click",()=>{const o=$(t.options.urlInputId).val();$(t.options.iFrameId).attr("src",o)}),$(t.options.urlClearButtonId).on("click",()=>{$(t.options.urlInputId).val(""),$(t.options.iFrameId).attr("src",t.options.defaultUrl)}),$(t.options.infoButtonId).on("click",()=>{$(t.options.iFrameContainerId).hasClass("expanded")?($(t.options.iFrameContainerId).removeClass("expanded"),$(t.options.dataContainerId).hide()):($(t.options.iFrameContainerId).addClass("expanded"),$(t.options.dataContainerId).show())}),$(t.options.saveSlideButtonId).on("click",()=>{$(this).trigger("SlideInfo:saveSlidePressed")})},SlideInfo.prototype.getURL=function(){return $(this.options.urlInputId).val()},SlideInfo.prototype.getTitol=function(){return $(this.options.titolInputId).val()},SlideInfo.prototype.getDescripcio=function(){return $(this.options.textInputId).summernote("click")},SlideInfo.prototype.reset=function(){$(this.options.iFrameId).src="http://www.instamaps.cat/geocatweb/visor.html",$(this.options.urlInputId).val(""),$(this.options.titolInputId).val(""),$(this.options.textInputId).summernote("click","")};
function StoryMap(e){const i={language:"en",slideIconRegex:/^slide-icon-\w+$/,slideTemplate:"#storymap_slide_template",maxSlides:10,strings:{en:{maxSlides:"Maximum number of slides reached"},ca:{maxSlides:"Màxim número de slides assolit"},es:{maxSlides:"Has llegado al número máximo de slides"}}};this.options=$.extend(!0,{},i,e),this._currentSlideIndex=-1,this._storyMapData=null,this.slides=null,this.idEditor="",this.idStoryMap="",this.slideBar=new SlideBar,this.slideInfoPanel=new SlideInfo,this.server=new StoryMapServer,this.addEvents()}StoryMap.prototype.addEvents=function(){const e=this;$(e.slideInfoPanel).on("SlideInfo:saveSlidePressed",()=>{e.saveSlide()})},StoryMap.prototype.saveSlide=function(){const e={id:this.slides.length,url_mapa:this.slideInfoPanel.getURL(),titol:this.slideInfoPanel.getTitol(),descripcio:this.slideInfoPanel.getDescricio()};this.slides.push(e),this.save().then(()=>{this.slideInfoPanel.reset()})},StoryMap.prototype.addSlide=function(){const e=$.extend(!0,{},this.options.slideData);if(this._slides.length===this.options.maxSlides)alert(this.options.strings[this.options.language].maxSlides);else{this._slides.push(e),$(this).trigger("StoryMap:changed");const i=this.slideBar.addSlide(e);i.on("SlideBar:slideSelected",this._slideSelected),i.on("SlideBar:deleteSlidePressed",this._slideDeletePressed)}},StoryMap.prototype._slideSelected=function(e,i){if(null!=this.slides){const e=this.slides[i];alert(e)}},StoryMap.prototype._slideDeletePressed=function(e,i){const t=this._slides[i],s=t.text?t.text.headline||"(untitled)":"(untitled)";this.showConfirm(`Delete "${s}" slide?`,this.options.slideElem,i)},StoryMap.prototype.save=function(){const e=$.Deferred();return""!==this.idStoryMap?""===this.idEditor?this.server.editMapSlides(this.idStoryMap).then(function(i){this.idEditor=i.id_editor,this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()})},()=>{e.reject()}):this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()}):this.server.newMapSlides(JSON.stringify(this.slides)).then(i=>{this.idStoryMap=i.id,this.idEditor=i.id_editor,e.resolve()},()=>{e.reject()}),e.promise()},StoryMap.prototype.load=function(e){this.idEditor=e,this.server.editMapSlides(e).then(e=>{this.slides=JSON.parse(e.slides)})},StoryMap.prototype.show_confirm=function(){};
function StoryMapServer(t){const e={urlStoryMap:"http://172.70.1.32/storymaps/"};this.options=$.extend(!0,{},e,t)}StoryMapServer.prototype.getMapSlides=function(t){return $.ajax({method:"GET",url:this.options.urlStoryMap+t})},StoryMapServer.prototype.editMapSlides=function(t){return $.ajax({method:"GET",url:`${this.options.urlStoryMap}edit/${t}`,async:!1}).responseText},StoryMapServer.prototype.newMapSlides=function(t){return $.ajax({method:"POST",url:`${this.options.urlStoryMap}edit/`,dataType:"json",data:{id:0,id_editor:0,slides:t}})},StoryMapServer.prototype.updateMapSlides=function(t,e,o){return $.ajax({method:"PUT",url:`${this.options.urlStoryMap}edit/${t}`,dataType:"json",data:{id:e,id_editor:t,slides:o}})},StoryMapServer.prototype.deleteMapSlides=function(t,e){$.ajax({method:"DELETE",url:`${this.options.urlStoryMap}edit/${t}/${e}`,contentType:"application/json"}).done(()=>{})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNsaWRlQmFyLmpzIiwic2xpZGVJY29uLmpzIiwic2xpZGVJbmZvLmpzIiwic3RvcnlNYXAuanMiLCJzdG9yeU1hcFNlcnZlci5qcyJdLCJuYW1lcyI6WyJTbGlkZUJhciIsIm9wdGlvbnMiLCJfZGVmYXVsdE9wdGlvbnMiLCJtYXhTbGlkZXMiLCJzbGlkZUljb25SZWdleCIsInNsaWRlc0NvbnRhaW5lcklkIiwic2xpZGVMaXN0SWQiLCJhZGRTbGlkZUJ1dHRvbiIsInRoaXMiLCIkIiwiZXh0ZW5kIiwiYWRkRXZlbnRzIiwiYWRkU2xpZGUiLCJwcm90b3R5cGUiLCJzZWxmIiwiY2xpY2siLCJzbGlkZSIsIlNsaWRlSWNvbiIsImFwcGVuZFRvIiwib24iLCJldmVudCIsImlkIiwicmVtb3ZlU2xpZGUiLCJzY3JvbGxUb3AiLCJNYXRoIiwibWF4IiwiaGVpZ2h0IiwicGFyZW50IiwiY2xpY2tlZCIsInJlbW92ZSIsInRleHQiLCJ0ZW1wbGF0ZUlkIiwic2xpZGVDbGFzcyIsInRlbXBsYXRlIiwiXyIsImh0bWwiLCJ0cmltIiwic2xpZGVET01FbGVtIiwiZGVsZXRlRE9NRWxlbSIsImRlbGV0ZUJ1dHRvblByZXNzZWQiLCJjdXJyZW50U2xpZGVJbmRleCIsImluZGV4IiwiYmx1ciIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJ0cmlnZ2VyIiwiU2xpZGVJbmZvIiwidXJsTG9hZEJ1dHRvbklkIiwidXJsQ2xlYXJCdXR0b25JZCIsImluZm9CdXR0b25JZCIsInNhdmVTbGlkZUJ1dHRvbklkIiwidXJsSW5wdXRJZCIsInRpdG9sSW5wdXRJZCIsInRleHRJbnB1dElkIiwiaUZyYW1lSWQiLCJpRnJhbWVDb250YWluZXJJZCIsImRhdGFDb250YWluZXJJZCIsImRlZmF1bHRVcmwiLCJzdW1tZXJub3RlIiwidXJsIiwidmFsIiwiYXR0ciIsImhhc0NsYXNzIiwiaGlkZSIsInNob3ciLCJnZXRVUkwiLCJnZXRUaXRvbCIsImdldERlc2NyaXBjaW8iLCJyZXNldCIsInNyYyIsIlN0b3J5TWFwIiwibGFuZ3VhZ2UiLCJzbGlkZVRlbXBsYXRlIiwic3RyaW5ncyIsImVuIiwiY2EiLCJlcyIsIl9jdXJyZW50U2xpZGVJbmRleCIsIl9zdG9yeU1hcERhdGEiLCJzbGlkZXMiLCJpZEVkaXRvciIsImlkU3RvcnlNYXAiLCJzbGlkZUJhciIsInNsaWRlSW5mb1BhbmVsIiwic2VydmVyIiwiU3RvcnlNYXBTZXJ2ZXIiLCJzYXZlU2xpZGUiLCJsZW5ndGgiLCJ1cmxfbWFwYSIsInRpdG9sIiwiZGVzY3JpcGNpbyIsImdldERlc2NyaWNpbyIsInB1c2giLCJzYXZlIiwidGhlbiIsImRlZmF1bHREYXRhIiwic2xpZGVEYXRhIiwiX3NsaWRlcyIsImFsZXJ0IiwiX3NsaWRlU2VsZWN0ZWQiLCJfc2xpZGVEZWxldGVQcmVzc2VkIiwiY3VycmVudFNsaWRlIiwiZGF0YSIsInNsaWRlVGl0bGUiLCJoZWFkbGluZSIsInNob3dDb25maXJtIiwic2xpZGVFbGVtIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImVkaXRNYXBTbGlkZXMiLCJyZXN1bHRzIiwiaWRfZWRpdG9yIiwidXBkYXRlTWFwU2xpZGVzIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc29sdmUiLCJyZWplY3QiLCJuZXdNYXBTbGlkZXMiLCJwcm9taXNlIiwibG9hZCIsInBhcnNlIiwic2hvd19jb25maXJtIiwidXJsU3RvcnlNYXAiLCJnZXRNYXBTbGlkZXMiLCJpZE1hcGEiLCJhamF4IiwibWV0aG9kIiwiaWRNYXBhRWRpdGluZyIsImFzeW5jIiwicmVzcG9uc2VUZXh0IiwianNvblNsaWRlcyIsImRhdGFUeXBlIiwiZGVsZXRlTWFwU2xpZGVzIiwiY29udGVudFR5cGUiLCJkb25lIl0sIm1hcHBpbmdzIjoiQUFFQSxTQUFTQSxTQUFTQyxHQUVqQixNQUFNQyxHQUNMQyxVQUFXLEdBQ1hDLGVBQWdCLG1CQUNoQkMsa0JBQW1CLG1CQUNuQkMsWUFBYSxhQUNiQyxlQUFnQix1QkFJakJDLEtBQUtQLFFBQVVRLEVBQUVDLFFBQU8s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T0FBUSxTQUNSbkUsT0FBUW5ELEtBQUtQLFFBQVF5SCxtQkFBbUJLLEtBQWlCSCxJQUN6RFMsWUFBYSxxQkFHWkMsS0FBSyIsImZpbGUiOiJzdG9yeW1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgJCwgU2xpZGVJY29uKi9cblxuZnVuY3Rpb24gU2xpZGVCYXIob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblx0XHRtYXhTbGlkZXM6IDEwLFxuXHRcdHNsaWRlSWNvblJlZ2V4OiAvXnNsaWRlLWljb24tXFx3KyQvLFxuXHRcdHNsaWRlc0NvbnRhaW5lcklkOiBcIiNzbGlkZXNDb250YWluZXJcIixcblx0XHRzbGlkZUxpc3RJZDogXCIjc2xpZGVMaXN0XCIsXG5cdFx0YWRkU2xpZGVCdXR0b246IFwiI3N0b3J5bWFwX2FkZF9zbGlkZVwiLFxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblx0dGhpcy5hZGRTbGlkZSgpO1xuXG59XG5cblNsaWRlQmFyLnByb3RvdHlwZS5hZGRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0JChzZWxmLm9wdGlvbnMuYWRkU2xpZGVCdXR0b24pLmNsaWNrKCgpID0+IHtcblxuXHRcdHNlbGYuYWRkU2xpZGUoKTtcblxuXHR9KTtcblxufTtcblxuU2xpZGVCYXIucHJvdG90eXBlLmFkZFNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdGNvbnN0IHNsaWRlID0gbmV3IFNsaWRlSWNvbigpO1xuXHRzbGlkZS5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpO1xuXHQkKHNsaWRlKS5vbihcIlNsaWRlOmRlbGV0ZWRcIiwgKGV2ZW50LCBpZCkgPT4ge1xuXG5cdFx0c2VsZi5yZW1vdmVTbGlkZShpZCk7XG5cblx0fSk7XG5cdCQodGhpcy5vcHRpb25zLnNsaWRlc0NvbnRhaW5lcklkKS5zY3JvbGxUb3AoTWF0aC5tYXgoMCwgJCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpLmhlaWdodCgpIC1cblx0XHQkKHRoaXMub3B0aW9ucy5zbGlkZUxpc3RJZCkucGFyZW50KCkuaGVpZ2h0KCkpKTtcblx0c2xpZGUuY2xpY2tlZCgpO1xuXG59O1xuXG5TbGlkZUJhci5wcm90b3R5cGUucmVtb3ZlU2xpZGUgPSBmdW5jdGlvbiAoaWQpIHtcblxuXHQkKGAke3RoaXMub3B0aW9ucy5zbGlkZUxpc3RJZH0gbGk6bnRoLWNoaWxkKCR7aWQgKyAxfSlgKS5yZW1vdmUoKTtcblxufTtcbiIsIi8qIGdsb2JhbCAkLCBfKi9cblxuZnVuY3Rpb24gU2xpZGVJY29uKG9wdGlvbnMpIHtcblxuXHRjb25zdCBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR0ZXh0OiBcIlwiLFxuXHRcdHRlbXBsYXRlSWQ6IFwiI3N0b3J5bWFwX3NsaWRlX3RlbXBsYXRlXCIsXG5cdFx0c2xpZGVDbGFzczogXCIuc2xpZGVcIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQodGhpcy5vcHRpb25zLnRlbXBsYXRlSWQpLmh0bWwoKS50cmltKCkpO1xuXHR0aGlzLnNsaWRlRE9NRWxlbSA9ICQodGhpcy50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMpKTtcblx0dGhpcy5kZWxldGVET01FbGVtID0gJChcIjxhIGNsYXNzPVxcXCJjbG9zZVxcXCIgaHJlZj1cXFwiamF2YXNjcmlwdDpcXFwiPiZuYnNwOzwvYT5cIik7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxufVxuXG5TbGlkZUljb24ucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRzZWxmLnNsaWRlRE9NRWxlbS5jbGljaygoKSA9PiB7XG5cblx0XHRzZWxmLmNsaWNrZWQoKTtcblxuXHR9KTtcblxuXHRzZWxmLmRlbGV0ZURPTUVsZW0uY2xpY2soKCkgPT4ge1xuXG5cdFx0c2VsZi5kZWxldGVCdXR0b25QcmVzc2VkKCk7XG5cblx0fSk7XG5cbn07XG5cblNsaWRlSWNvbi5wcm90b3R5cGUuY2xpY2tlZCA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRjb25zdCBjdXJyZW50U2xpZGVJbmRleCA9ICQoc2VsZi5vcHRpb25zLnNsaWRlQ2xhc3MpLmluZGV4KHNlbGYuc2xpZGVET01FbGVtKTtcblx0JChcIjpmb2N1c1wiKS5ibHVyKCk7IC8vIGZvcmNlIGNoYW5nZSBldmVudCFcblxuXHQkKGAke3RoaXMub3B0aW9ucy5zbGlkZUNsYXNzfS5zZWxlY3RlZGApLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG5cdCQoc2VsZi5zbGlkZURPTUVsZW0pLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG5cblx0JChzZWxmKS50cmlnZ2VyKFwiU2xpZGU6c2VsZWN0ZWRcIiwgW2N1cnJlbnRTbGlkZUluZGV4XSk7XG5cblx0cmV0dXJuIGZhbHNlO1xuXG59O1xuXG5TbGlkZUljb24ucHJvdG90eXBlLmRlbGV0ZUJ1dHRvblByZXNzZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0Y29uc3QgY3VycmVudFNsaWRlSW5kZXggPSAkKHNlbGYub3B0aW9ucy5zbGlkZUNsYXNzKS5pbmRleChzZWxmLnNsaWRlRE9NRWxlbSk7XG5cdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlOmRlbGV0ZWRcIiwgW2N1cnJlbnRTbGlkZUluZGV4XSk7XG5cbn07XG5cblNsaWRlSWNvbi5wcm90b3R5cGUuYXBwZW5kVG8gPSBmdW5jdGlvbiAoaWQpIHtcblxuXHR0aGlzLnNsaWRlRE9NRWxlbS5hcHBlbmRUbyhpZCk7XG5cdHRoaXMuZGVsZXRlRE9NRWxlbS5hcHBlbmRUbyh0aGlzLnNsaWRlRE9NRWxlbSk7XG5cbn07XG4iLCIvKiBnbG9iYWwgJCovXG5cbmZ1bmN0aW9uIFNsaWRlSW5mbyhpbmRleCwgb3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdHVybExvYWRCdXR0b25JZDogXCIjc3RvcnltYXBfbG9hZFwiLFxuXHRcdHVybENsZWFyQnV0dG9uSWQ6IFwiI3N0b3J5bWFwX3VubG9hZFwiLFxuXHRcdGluZm9CdXR0b25JZDogXCIjb2JyaXJfbWVudVwiLFxuXHRcdHNhdmVTbGlkZUJ1dHRvbklkOiBcIiNzdG9yeW1hcF9zYXZlX3NsaWRlXCIsXG5cdFx0dXJsSW5wdXRJZDogXCIjdXJsTWFwXCIsXG5cdFx0dGl0b2xJbnB1dElkOiBcIiN1cmxNYXBcIixcblx0XHR0ZXh0SW5wdXRJZDogXCIjc3VtbWVybm90ZVwiLFxuXHRcdGlGcmFtZUlkOiBcIiNpbnN0YW1hcHNNYXBcIixcblx0XHRpRnJhbWVDb250YWluZXJJZDogXCIjbWFwYUZyYW1lXCIsXG5cdFx0ZGF0YUNvbnRhaW5lcklkOiBcIiNkYXRhU2VjdGlvblwiLFxuXHRcdGRlZmF1bHRVcmw6IFwiaHR0cHM6Ly93d3cuaW5zdGFtYXBzLmNhdC9nZW9jYXR3ZWIvdmlzb3IuaHRtbFwiLFxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxuXHQkKHRoaXMub3B0aW9ucy50ZXh0SW5wdXRJZCkuc3VtbWVybm90ZSgpO1xuXG59XG5cblNsaWRlSW5mby5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdCQoc2VsZi5vcHRpb25zLnVybExvYWRCdXR0b25JZCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHRjb25zdCB1cmwgPSAkKHNlbGYub3B0aW9ucy51cmxJbnB1dElkKS52YWwoKTtcblx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVJZCkuYXR0cihcInNyY1wiLCB1cmwpO1xuXG5cdH0pO1xuXG5cdCQoc2VsZi5vcHRpb25zLnVybENsZWFyQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0JChzZWxmLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKFwiXCIpO1xuXHRcdCQoc2VsZi5vcHRpb25zLmlGcmFtZUlkKS5hdHRyKFwic3JjXCIsIHNlbGYub3B0aW9ucy5kZWZhdWx0VXJsKTtcblxuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5pbmZvQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0aWYgKCQoc2VsZi5vcHRpb25zLmlGcmFtZUNvbnRhaW5lcklkKS5oYXNDbGFzcyhcImV4cGFuZGVkXCIpKSB7XG5cblx0XHRcdCQoc2VsZi5vcHRpb25zLmlGcmFtZUNvbnRhaW5lcklkKS5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpO1xuXHRcdFx0JChzZWxmLm9wdGlvbnMuZGF0YUNvbnRhaW5lcklkKS5oaWRlKCk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVDb250YWluZXJJZCkuYWRkQ2xhc3MoXCJleHBhbmRlZFwiKTtcblx0XHRcdCQoc2VsZi5vcHRpb25zLmRhdGFDb250YWluZXJJZCkuc2hvdygpO1xuXG5cdFx0fVxuXG5cdH0pO1xuXG5cdCQoc2VsZi5vcHRpb25zLnNhdmVTbGlkZUJ1dHRvbklkKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdCQodGhpcykudHJpZ2dlcihcIlNsaWRlSW5mbzpzYXZlU2xpZGVQcmVzc2VkXCIpO1xuXG5cdH0pO1xuXG59O1xuXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldFVSTCA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gJCh0aGlzLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKCk7XG5cbn07XG5cblNsaWRlSW5mby5wcm90b3R5cGUuZ2V0VGl0b2wgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnRpdG9sSW5wdXRJZCkudmFsKCk7XG5cbn07XG5cblNsaWRlSW5mby5wcm90b3R5cGUuZ2V0RGVzY3JpcGNpbyA9IGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gJCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJjbGlja1wiKTtcblxufTtcblxuU2xpZGVJbmZvLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcblxuXHQkKHRoaXMub3B0aW9ucy5pRnJhbWVJZCkuc3JjID0gXCJodHRwOi8vd3d3Lmluc3RhbWFwcy5jYXQvZ2VvY2F0d2ViL3Zpc29yLmh0bWxcIjtcblx0JCh0aGlzLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKFwiXCIpO1xuXHQkKHRoaXMub3B0aW9ucy50aXRvbElucHV0SWQpLnZhbChcIlwiKTtcblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoXCJjbGlja1wiLCBcIlwiKTtcblxufTtcbiIsIi8qIGdsb2JhbCAkLCBhbGVydCwgU2xpZGVCYXIsIFNsaWRlSW5mbywgU3RvcnlNYXBTZXJ2ZXIqL1xuXG5mdW5jdGlvbiBTdG9yeU1hcChvcHRpb25zKSB7XG5cblx0Y29uc3QgX2RlZmF1bHRPcHRpb25zID0ge1xuXG5cdFx0bGFuZ3VhZ2U6IFwiZW5cIixcblx0XHRzbGlkZUljb25SZWdleDogL15zbGlkZS1pY29uLVxcdyskLyxcblx0XHRzbGlkZVRlbXBsYXRlOiBcIiNzdG9yeW1hcF9zbGlkZV90ZW1wbGF0ZVwiLFxuXHRcdG1heFNsaWRlczogMTAsXG5cdFx0c3RyaW5nczoge1xuXHRcdFx0ZW46IHtcblx0XHRcdFx0bWF4U2xpZGVzOiBcIk1heGltdW0gbnVtYmVyIG9mIHNsaWRlcyByZWFjaGVkXCIsXG5cdFx0XHR9LFxuXHRcdFx0Y2E6IHtcblx0XHRcdFx0bWF4U2xpZGVzOiBcIk3DoHhpbSBuw7ptZXJvIGRlIHNsaWRlcyBhc3NvbGl0XCIsXG5cdFx0XHR9LFxuXHRcdFx0ZXM6IHtcblx0XHRcdFx0bWF4U2xpZGVzOiBcIkhhcyBsbGVnYWRvIGFsIG7Dum1lcm8gbcOheGltbyBkZSBzbGlkZXNcIixcblx0XHRcdH0sXG5cdFx0fSxcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMuX2N1cnJlbnRTbGlkZUluZGV4ID0gLTE7XG5cdHRoaXMuX3N0b3J5TWFwRGF0YSA9IG51bGw7XG5cdHRoaXMuc2xpZGVzID0gbnVsbDtcblx0dGhpcy5pZEVkaXRvciA9IFwiXCI7XG5cdHRoaXMuaWRTdG9yeU1hcCA9IFwiXCI7XG5cdHRoaXMuc2xpZGVCYXIgPSBuZXcgU2xpZGVCYXIoKTtcblx0dGhpcy5zbGlkZUluZm9QYW5lbCA9IG5ldyBTbGlkZUluZm8oKTtcblx0dGhpcy5zZXJ2ZXIgPSBuZXcgU3RvcnlNYXBTZXJ2ZXIoKTtcblxuXHR0aGlzLmFkZEV2ZW50cygpO1xuXG59XG5cblN0b3J5TWFwLnByb3RvdHlwZS5hZGRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0JChzZWxmLnNsaWRlSW5mb1BhbmVsKS5vbihcIlNsaWRlSW5mbzpzYXZlU2xpZGVQcmVzc2VkXCIsICgpID0+IHtcblxuXHRcdHNlbGYuc2F2ZVNsaWRlKCk7XG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5zYXZlU2xpZGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0Ly8gQWdhZmFyIGxlcyBkYWRlcyBkZSBsJ3NsaWRlSW5mb1BhbmVsIGkgZ3VhcmRhci1sZXMgYSBsJ29iamVjdGUgZGUgbCdzbGlkZVxuXHRjb25zdCBzbGlkZSA9IHtcblx0XHRpZDogdGhpcy5zbGlkZXMubGVuZ3RoLFxuXHRcdHVybF9tYXBhOiB0aGlzLnNsaWRlSW5mb1BhbmVsLmdldFVSTCgpLFxuXHRcdHRpdG9sOiB0aGlzLnNsaWRlSW5mb1BhbmVsLmdldFRpdG9sKCksXG5cdFx0ZGVzY3JpcGNpbzogdGhpcy5zbGlkZUluZm9QYW5lbC5nZXREZXNjcmljaW8oKSxcblx0fTtcblxuXHR0aGlzLnNsaWRlcy5wdXNoKHNsaWRlKTtcblxuXHQvLyBHdWFyZGVtIGxlcyBkYWRlcyBhbCBzZXJ2aWRvclxuXHR0aGlzLnNhdmUoKS50aGVuKCgpID0+IHtcblxuXHRcdHRoaXMuc2xpZGVJbmZvUGFuZWwucmVzZXQoKTtcblxuXHR9KTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLmFkZFNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IGRlZmF1bHREYXRhID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucy5zbGlkZURhdGEpO1xuXHRjb25zdCBuID0gdGhpcy5fc2xpZGVzLmxlbmd0aDtcblx0aWYgKG4gPT09IHRoaXMub3B0aW9ucy5tYXhTbGlkZXMpIHtcblxuXHRcdGFsZXJ0KHRoaXMub3B0aW9ucy5zdHJpbmdzW3RoaXMub3B0aW9ucy5sYW5ndWFnZV0ubWF4U2xpZGVzKTtcblxuXHR9XHRlbHNlIHtcblxuXHRcdHRoaXMuX3NsaWRlcy5wdXNoKGRlZmF1bHREYXRhKTtcblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJTdG9yeU1hcDpjaGFuZ2VkXCIpO1xuXHRcdGNvbnN0IHNsaWRlID0gdGhpcy5zbGlkZUJhci5hZGRTbGlkZShkZWZhdWx0RGF0YSk7XG5cdFx0c2xpZGUub24oXCJTbGlkZUJhcjpzbGlkZVNlbGVjdGVkXCIsIHRoaXMuX3NsaWRlU2VsZWN0ZWQpO1xuXHRcdHNsaWRlLm9uKFwiU2xpZGVCYXI6ZGVsZXRlU2xpZGVQcmVzc2VkXCIsIHRoaXMuX3NsaWRlRGVsZXRlUHJlc3NlZCk7XG5cblx0fVxuXG59O1xuXG5TdG9yeU1hcC5wcm90b3R5cGUuX3NsaWRlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZXZlbnQsIGluZGV4KSB7XG5cblx0aWYgKHRoaXMuc2xpZGVzICE9IG51bGwpIHtcblxuXHRcdGNvbnN0IGN1cnJlbnRTbGlkZSA9IHRoaXMuc2xpZGVzW2luZGV4XTtcblxuXHRcdC8vIFRPRE86IFBhc3NhciBhIGwnU2xpZGVJbmZvXG5cdFx0YWxlcnQoY3VycmVudFNsaWRlKTtcblxuXHR9XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5fc2xpZGVEZWxldGVQcmVzc2VkID0gZnVuY3Rpb24gKGV2ZW50LCBpbmRleCkge1xuXG5cdGNvbnN0IGRhdGEgPSB0aGlzLl9zbGlkZXNbaW5kZXhdO1xuXHRjb25zdCBzbGlkZVRpdGxlID0gKChkYXRhLnRleHQpID8gKGRhdGEudGV4dC5oZWFkbGluZSB8fCBcIih1bnRpdGxlZClcIikgOiBcIih1bnRpdGxlZClcIik7XG5cblx0dGhpcy5zaG93Q29uZmlybShgRGVsZXRlIFwiJHtzbGlkZVRpdGxlfVwiIHNsaWRlP2AsIHRoaXMub3B0aW9ucy5zbGlkZUVsZW0sIGluZGV4KTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3QgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG5cblx0aWYgKHRoaXMuaWRTdG9yeU1hcCAhPT0gXCJcIikge1xuXG5cdFx0aWYgKHRoaXMuaWRFZGl0b3IgPT09IFwiXCIpIHtcblxuXHRcdFx0Ly8gamEgZXhpc3RlaXggbCdzdG9yeW1hcCBjcmVhdC4gRW50cmVtIGVuIG1vZGUgZWRpY2nDs1xuXHRcdFx0dGhpcy5zZXJ2ZXIuZWRpdE1hcFNsaWRlcyh0aGlzLmlkU3RvcnlNYXApLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcblxuXHRcdFx0XHR0aGlzLmlkRWRpdG9yID0gcmVzdWx0cy5pZF9lZGl0b3I7XG5cblx0XHRcdFx0dGhpcy5zZXJ2ZXIudXBkYXRlTWFwU2xpZGVzKHRoaXMuaWRFZGl0b3IsIHRoaXMuaWRTdG9yeU1hcCxcblx0XHRcdFx0XHRKU09OLnN0cmluZ2lmeSh0aGlzLnNsaWRlcykpLnRoZW4oXG5cblx0XHRcdFx0XHQoKSA9PiB7XG5cblx0XHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0KCkgPT4ge1xuXG5cdFx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblxuXHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0KTtcblxuXHRcdFx0fSxcblx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblxuXHRcdFx0fSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnNlcnZlci51cGRhdGVNYXBTbGlkZXModGhpcy5pZEVkaXRvciwgdGhpcy5pZFN0b3J5TWFwLCBKU09OLnN0cmluZ2lmeSh0aGlzLnNsaWRlcykpLnRoZW4oXG5cblx0XHRcdFx0KCkgPT4ge1xuXG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSgpO1xuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdCgpO1xuXG5cdFx0XHRcdH0sXG5cblx0XHRcdCk7XG5cblx0XHR9XG5cblx0fSBlbHNlIHtcblxuXHRcdC8vIG5vIGV4aXN0ZWl4IGwnc3RvcnltYXAuIEVuIGNyZWVtIHVuIGRlIG5vdSBhbWIgbGEgaW5mbyBjb3JyZXNwb25lbnRcblx0XHR0aGlzLnNlcnZlci5uZXdNYXBTbGlkZXMoSlNPTi5zdHJpbmdpZnkodGhpcy5zbGlkZXMpKS50aGVuKChyZXN1bHRzKSA9PiB7XG5cblx0XHRcdHRoaXMuaWRTdG9yeU1hcCA9IHJlc3VsdHMuaWQ7XG5cdFx0XHR0aGlzLmlkRWRpdG9yID0gcmVzdWx0cy5pZF9lZGl0b3I7XG5cdFx0XHRkZWZlcnJlZC5yZXNvbHZlKCk7XG5cblx0XHR9LFxuXHRcdCgpID0+IHtcblxuXHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XG5cblx0XHR9KTtcblxuXHR9XG5cblx0cmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoaWQpIHtcblxuXHR0aGlzLmlkRWRpdG9yID0gaWQ7XG5cblx0dGhpcy5zZXJ2ZXIuZWRpdE1hcFNsaWRlcyhpZCkudGhlbigocmVzdWx0cykgPT4ge1xuXG5cdFx0dGhpcy5zbGlkZXMgPSBKU09OLnBhcnNlKHJlc3VsdHMuc2xpZGVzKTtcblxuXHR9KTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLnNob3dfY29uZmlybSA9IGZ1bmN0aW9uICgpIHsgLyogKG1zZywgc2xpZGVFbGVtLCBzbGlkZUluZGV4KSB7XG5cblx0Y29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpYWxvZ19kZWxldGVfc2xpZGVcIik7XG5cdCQoXCIjbXNnXCIpLmh0bWwoYDxzcGFuPiR7bXNnfTwvc3Bhbj5gKTtcblx0bW9kYWwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuXHQkKFwiI2RpYWxvZ19kZWxldGVfc2xpZGUgLmJ0bi1kZWZhdWx0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0bW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpYWxvZ19kZWxldGVfc2xpZGVcIik7XG5cdFx0bW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG5cdFx0Y29uc3QgaGVpZ2h0ID0gJChcIiNzbGlkZXNcIikuaGVpZ2h0KCkgLSBzbGlkZUVsZW0ub3V0ZXJIZWlnaHQodHJ1ZSk7XG5cblx0XHQvLyBEZWxldGUgdGhlIHNsaWRlIGRhdGFcblx0XHRfc2xpZGVzLnNwbGljZShzbGlkZUluZGV4LCAxKTtcblx0XHRzdG9yeW1hcF9kaXJ0eSgxKTtcblxuXHRcdC8vIFJlbW92ZSBET00gZWxlbWVudFxuXHRcdHNsaWRlRWxlbS5yZW1vdmUoKTtcblxuXHRcdC8vIEFkanVzdCBzbGlkZSBjb250YWluZXIgaGVpZ2h0XG5cdFx0JChcIiNzbGlkZXNcIikuY3NzKFwiaGVpZ2h0XCIsIGAke2hlaWdodH1weGApO1xuXG5cdFx0aWYoX2N1cnJlbnRfc2xpZGVfaW5kZXggPT0gMCkge1xuXG5cdFx0XHQvLyBVcGRhdGUgb3ZlcmxheSB2aWV3XG5cdFx0ICAgLy8gX21hcC5yZW1vdmVNYXJrZXIoc2xpZGVJbmRleCAtIDEpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0Ly8gUmVzZXQgY3VycmVudCBzbGlkZVxuXHRcdFx0aWYoc2xpZGVJbmRleCA8IF9jdXJyZW50X3NsaWRlX2luZGV4KSB7XG5cblx0XHRcdFx0X2N1cnJlbnRfc2xpZGVfaW5kZXgtLTtcblx0XHRcdFx0Ly9zdG9yeW1hcF9hdXRvX3NhdmUoKTtcblxuXHRcdFx0fSBlbHNlIGlmKHNsaWRlSW5kZXggPT0gX2N1cnJlbnRfc2xpZGVfaW5kZXgpIHtcblxuXHRcdFx0XHRjb25zdCBuID0gTWF0aC5taW4oX2N1cnJlbnRfc2xpZGVfaW5kZXgsIF9zbGlkZXMubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdCQoXCIuc2xpZGVcIikuZXEobikuY2xpY2soKTtcblxuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdH0pO1xuXHRcblx0JChcIiNkaWFsb2dfZGVsZXRlX3NsaWRlIC5jbG9zZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2dfZGVsZXRlX3NsaWRlXCIpO1xuXHRcdG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuXHR9KTtcblx0XG5cdCQoXCIjZGlhbG9nX2RlbGV0ZV9zbGlkZSAuYnRuLWRhbmdlclwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2dfZGVsZXRlX3NsaWRlXCIpO1xuXHRcdG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuXHR9KTsqL1xuXG59O1xuIiwiLyogZ2xvYmFsICQqL1xuXG5mdW5jdGlvbiBTdG9yeU1hcFNlcnZlcihvcHRpb25zKSB7XG5cblx0Y29uc3QgX2RlZmF1bHRPcHRpb25zID0ge1xuXG5cdFx0dXJsU3RvcnlNYXA6IFwiaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy9cIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG59XG5cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5nZXRNYXBTbGlkZXMgPSBmdW5jdGlvbiAoaWRNYXBhKSB7XG5cblx0Ly8gRXhhbXBsZTogaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy83NjhkZGM2MC02NmUyLTExZTctYWY1ZS0wOWFmZjAwNzIzMGRcblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiR0VUXCIsXG5cdFx0dXJsOiB0aGlzLm9wdGlvbnMudXJsU3RvcnlNYXAgKyBpZE1hcGEsXG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5lZGl0TWFwU2xpZGVzID0gZnVuY3Rpb24gKGlkTWFwYUVkaXRpbmcpIHtcblxuXHQvLyBFeGFtcGxlOiBodHRwOi8vMTcyLjcwLjEuMzIvc3RvcnltYXBzL2VkaXQvNzZkMjFmMDAtNDhlMC00MjE2LWJiNTItODRhOGE0MWNjNmEyXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIkdFVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfWAsXG5cdFx0YXN5bmM6IGZhbHNlLFxuXG5cdH0pLnJlc3BvbnNlVGV4dDtcblxufTtcblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5uZXdNYXBTbGlkZXMgPSBmdW5jdGlvbiAoanNvblNsaWRlcykge1xuXG5cdC8vIGh0dHA6Ly8xNzIuNzAuMS4zMi9zdG9yeW1hcHMvZWRpdC9cblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiUE9TVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvYCxcblx0XHRkYXRhVHlwZTogXCJqc29uXCIsXG5cdFx0ZGF0YTogeyBpZDogMCwgaWRfZWRpdG9yOiAwLCBzbGlkZXM6IGpzb25TbGlkZXMgfSxcblxuXHR9KTtcblxufTtcblxuXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUudXBkYXRlTWFwU2xpZGVzID0gZnVuY3Rpb24gKGlkTWFwYUVkaXRpbmcsIGlkTWFwYSwganNvblNsaWRlcykge1xuXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIlBVVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfWAsXG5cdFx0ZGF0YVR5cGU6IFwianNvblwiLFxuXHRcdGRhdGE6IHsgaWQ6IGlkTWFwYSwgaWRfZWRpdG9yOiBpZE1hcGFFZGl0aW5nLCBzbGlkZXM6IGpzb25TbGlkZXMgfSxcblxuXHR9KTtcblxufTtcblxuU3RvcnlNYXBTZXJ2ZXIucHJvdG90eXBlLmRlbGV0ZU1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZE1hcGFFZGl0aW5nLCBpZE1hcGEpIHtcblxuXHQkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIkRFTEVURVwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfS8ke2lkTWFwYX1gLFxuXHRcdGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcblxuXHR9KVxuXHRcdC5kb25lKCgpID0+IHtcblxuXHRcdH0pO1xuXG59O1xuIl19
