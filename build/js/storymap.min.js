function SlideBar(i){const d={maxSlides:10,slideIconRegex:/^slide-icon-\w+$/,slidesContainerId:"#slidesContainer",slideListId:"#slideList",addSlideButton:"#storymap_add_slide"};this.options=$.extend(!0,{},d,i),this.addEvents(),this.addSlide()}SlideBar.prototype.addEvents=function(){const i=this;$(i.options.addSlideButton).click(()=>{i.addSlide()})},SlideBar.prototype.addSlide=function(){const i=this,d=new SlideIcon;d.appendTo(this.options.slideListId),$(d).on("Slide:deleted",(d,e)=>{i.removeSlide(e)}),$(this.options.slidesContainerId).scrollTop(Math.max(0,$(this.options.slideListId).height()-$(this.options.slideListId).parent().height())),d.clicked()},SlideBar.prototype.removeSlide=function(i){$(`${this.options.slideListId} li:nth-child(${i+1})`).remove()};
function SlideIcon(e){const t={text:"",templateId:"#storymap_slide_template",slideClass:".slide"};this.options=$.extend(!0,{},t,e),this.template=_.template($(this.options.templateId).html().trim()),this.slideDOMElem=$(this.template(this.options)),this.deleteDOMElem=$('<a class="close" href="javascript:">&nbsp;</a>'),this.addEvents()}SlideIcon.prototype.addEvents=function(){const e=this;e.slideDOMElem.click(()=>{e.clicked()}),e.deleteDOMElem.click(()=>{e.deleteButtonPressed()})},SlideIcon.prototype.clicked=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);return $(":focus").blur(),$(`${this.options.slideClass}.selected`).removeClass("selected"),$(e.slideDOMElem).addClass("selected"),$(e).trigger("Slide:selected",[t]),!1},SlideIcon.prototype.deleteButtonPressed=function(){const e=this,t=$(e.options.slideClass).index(e.slideDOMElem);$(e).trigger("Slide:deleted",[t])},SlideIcon.prototype.appendTo=function(e){this.slideDOMElem.appendTo(e),this.deleteDOMElem.appendTo(this.slideDOMElem)};
function SlideInfo(t,o){const n={urlLoadButtonId:"#storymap_load",urlClearButtonId:"#storymap_unload",infoButtonId:"#obrir_menu",saveSlideButtonId:"#storymap_save_slide",urlInputId:"#urlMap",titolInputId:"#urlMap",textInputId:"#summernote",iFrameId:"#instamapsMap",iFrameContainerId:"#mapaFrame",dataContainerId:"#dataSection",defaultUrl:"https://www.instamaps.cat/geocatweb/visor.html"};this.options=$.extend(!0,{},n,o),this.addEvents(),$(this.options.textInputId).summernote()}SlideInfo.prototype.addEvents=function(){const t=this;$(t.options.urlLoadButtonId).on("click",()=>{const o=$(t.options.urlInputId).val();$(t.options.iFrameId).attr("src",o)}),$(t.options.urlClearButtonId).on("click",()=>{$(t.options.urlInputId).val(""),$(t.options.iFrameId).attr("src",t.options.defaultUrl)}),$(t.options.infoButtonId).on("click",()=>{$(t.options.iFrameContainerId).hasClass("expanded")?($(t.options.iFrameContainerId).removeClass("expanded"),$(t.options.dataContainerId).hide()):($(t.options.iFrameContainerId).addClass("expanded"),$(t.options.dataContainerId).show())}),$(t.options.saveSlideButtonId).on("click",()=>{$(this).trigger("SlideInfo:saveSlidePressed")})},SlideInfo.prototype.getURL=function(){return $(this.options.urlInputId).val()},SlideInfo.prototype.getTitol=function(){return $(this.options.titolInputId).val()},SlideInfo.prototype.getDescripcio=function(){return $(this.options.textInputId).summernote("click")},SlideInfo.prototype.reset=function(){$(this.options.iFrameId).src="http://www.instamaps.cat/geocatweb/visor.html",$(this.options.urlInputId).val(""),$(this.options.titolInputId).val(""),$(this.options.textInputId).summernote("click","")};
function StoryMap(e){const i={language:"en",slideIconRegex:/^slide-icon-\w+$/,slideTemplate:"#storymap_slide_template",maxSlides:10,strings:{en:{maxSlides:"Maximum number of slides reached"},ca:{maxSlides:"Màxim número de slides assolit"},es:{maxSlides:"Has llegado al número máximo de slides"}}};this.options=$.extend(!0,{},i,e),this._currentSlideIndex=-1,this._storyMapData=null,this.slides=null,this.idEditor="",this.idStoryMap="",this.slideBar=new SlideBar,this.slideInfoPanel=new SlideInfo,this.server=new StoryMapServer,this.addEvents()}StoryMap.prototype.addEvents=function(){const e=this;$(e.slideInfoPanel).on("SlideInfo:saveSlidePressed",()=>{e.saveSlide()})},StoryMap.prototype.saveSlide=function(){const e={id:this.slides.length,url_mapa:this.slideInfoPanel.getURL(),titol:this.slideInfoPanel.getTitol(),descripcio:this.slideInfoPanel.getDescricio()};this.slides.push(e),this.save().then(()=>{this.slideInfoPanel.reset()})},StoryMap.prototype.addSlide=function(){const e=$.extend(!0,{},this.options.slideData);if(this._slides.length===this.options.maxSlides);else{this._slides.push(e),$(this).trigger("StoryMap:changed");const i=this.slideBar.addSlide(e);i.on("SlideBar:slideSelected",this._slideSelected),i.on("SlideBar:deleteSlidePressed",this._slideDeletePressed)}},StoryMap.prototype._slideSelected=function(e,i){if(null!=this.slides){const e=this.slides[i];alert(e)}},StoryMap.prototype._slideDeletePressed=function(e,i){const s=this._slides[i],t=s.text?s.text.headline||"(untitled)":"(untitled)";this.showConfirm(`Delete "${t}" slide?`,this.options.slideElem,i)},StoryMap.prototype.save=function(){const e=$.Deferred();return""!==this.idStoryMap?""===this.idEditor?this.server.editMapSlides(this.idStoryMap).then(function(i){this.idEditor=i.id_editor,this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()})},()=>{e.reject()}):this.server.updateMapSlides(this.idEditor,this.idStoryMap,JSON.stringify(this.slides)).then(()=>{e.resolve()},()=>{e.reject()}):this.server.newMapSlides(JSON.stringify(this.slides)).then(i=>{this.idStoryMap=i.id,this.idEditor=i.id_editor,e.resolve()},()=>{e.reject()}),e.promise()},StoryMap.prototype.load=function(e){this.idEditor=e,this.server.editMapSlides(e).then(e=>{this.slides=JSON.parse(e.slides)})},StoryMap.prototype.loadVisor=function(e){this.idStoryMap=e,this.server.getMapSlides(e).then(e=>{this.slides=JSON.parse(e.slides),console.debug(this.slides)})};
function StoryMapServer(t){const e={urlStoryMap:"http://172.70.1.32/storymaps/"};this.options=$.extend(!0,{},e,t)}StoryMapServer.prototype.getMapSlides=function(t){return $.ajax({method:"GET",url:this.options.urlStoryMap+t})},StoryMapServer.prototype.editMapSlides=function(t){return $.ajax({method:"GET",url:`${this.options.urlStoryMap}edit/${t}`,async:!1}).responseText},StoryMapServer.prototype.newMapSlides=function(t){return $.ajax({method:"POST",url:`${this.options.urlStoryMap}edit/`,dataType:"json",data:{id:0,id_editor:0,slides:t}})},StoryMapServer.prototype.updateMapSlides=function(t,e,o){return $.ajax({method:"PUT",url:`${this.options.urlStoryMap}edit/${t}`,dataType:"json",data:{id:e,id_editor:t,slides:o}})},StoryMapServer.prototype.deleteMapSlides=function(t,e){$.ajax({method:"DELETE",url:`${this.options.urlStoryMap}edit/${t}/${e}`,contentType:"application/json"}).done(()=>{})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNsaWRlQmFyLmpzIiwic2xpZGVJY29uLmpzIiwic2xpZGVJbmZvLmpzIiwic3RvcnlNYXAuanMiLCJzdG9yeU1hcFNlcnZlci5qcyJdLCJuYW1lcyI6WyJTbGlkZUJhciIsIm9wdGlvbnMiLCJfZGVmYXVsdE9wdGlvbnMiLCJtYXhTbGlkZXMiLCJzbGlkZUljb25SZWdleCIsInNsaWRlc0NvbnRhaW5lcklkIiwic2xpZGVMaXN0SWQiLCJhZGRTbGlkZUJ1dHRvbiIsInRoaXMiLCIkIiwiZXh0ZW5kIiwiYWRkRXZlbnRzIiwiYWRkU2xpZGUiLCJwcm90b3R5cGUiLCJzZWxmIiwiY2xpY2siLCJzbGlkZSIsIlNsaWRlSWNvbiIsImFwcGVuZFRvIiwib24iLCJldmVudCIsImlkIiwicmVtb3ZlU2xpZGUiLCJzY3JvbGxUb3AiLCJNYXRoIiwibWF4IiwiaGVpZ2h0IiwicGFyZW50IiwiY2xpY2tlZCIsInJlbW92ZSIsInRleHQiLCJ0ZW1wbGF0ZUlkIiwic2xpZGVDbGFzcyIsInRlbXBsYXRlIiwiXyIsImh0bWwiLCJ0cmltIiwic2xpZGVET01FbGVtIiwiZGVsZXRlRE9NRWxlbSIsImRlbGV0ZUJ1dHRvblByZXNzZWQiLCJjdXJyZW50U2xpZGVJbmRleCIsImluZGV4IiwiYmx1ciIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJ0cmlnZ2VyIiwiU2xpZGVJbmZvIiwidXJsTG9hZEJ1dHRvbklkIiwidXJsQ2xlYXJCdXR0b25JZCIsImluZm9CdXR0b25JZCIsInNhdmVTbGlkZUJ1dHRvbklkIiwidXJsSW5wdXRJZCIsInRpdG9sSW5wdXRJZCIsInRleHRJbnB1dElkIiwiaUZyYW1lSWQiLCJpRnJhbWVDb250YWluZXJJZCIsImRhdGFDb250YWluZXJJZCIsImRlZmF1bHRVcmwiLCJzdW1tZXJub3RlIiwidXJsIiwidmFsIiwiYXR0ciIsImhhc0NsYXNzIiwiaGlkZSIsInNob3ciLCJnZXRVUkwiLCJnZXRUaXRvbCIsImdldERlc2NyaXBjaW8iLCJyZXNldCIsInNyYyIsIlN0b3J5TWFwIiwibGFuZ3VhZ2UiLCJzbGlkZVRlbXBsYXRlIiwic3RyaW5ncyIsImVuIiwiY2EiLCJlcyIsIl9jdXJyZW50U2xpZGVJbmRleCIsIl9zdG9yeU1hcERhdGEiLCJzbGlkZXMiLCJpZEVkaXRvciIsImlkU3RvcnlNYXAiLCJzbGlkZUJhciIsInNsaWRlSW5mb1BhbmVsIiwic2VydmVyIiwiU3RvcnlNYXBTZXJ2ZXIiLCJzYXZlU2xpZGUiLCJsZW5ndGgiLCJ1cmxfbWFwYSIsInRpdG9sIiwiZGVzY3JpcGNpbyIsImdldERlc2NyaWNpbyIsInB1c2giLCJzYXZlIiwidGhlbiIsImRlZmF1bHREYXRhIiwic2xpZGVEYXRhIiwiX3NsaWRlcyIsIl9zbGlkZVNlbGVjdGVkIiwiX3NsaWRlRGVsZXRlUHJlc3NlZCIsImN1cnJlbnRTbGlkZSIsImFsZXJ0IiwiZGF0YSIsInNsaWRlVGl0bGUiLCJoZWFkbGluZSIsInNob3dDb25maXJtIiwic2xpZGVFbGVtIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImVkaXRNYXBTbGlkZXMiLCJyZXN1bHRzIiwiaWRfZWRpdG9yIiwidXBkYXRlTWFwU2xpZGVzIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc29sdmUiLCJyZWplY3QiLCJuZXdNYXBTbGlkZXMiLCJwcm9taXNlIiwibG9hZCIsInBhcnNlIiwibG9hZFZpc29yIiwiZ2V0TWFwU2xpZGVzIiwiY29uc29sZSIsImRlYnVnIiwidXJsU3RvcnlNYXAiLCJpZE1hcGEiLCJhamF4IiwibWV0aG9kIiwiaWRNYXBhRWRpdGluZyIsImFzeW5jIiwicmVzcG9uc2VUZXh0IiwianNvblNsaWRlcyIsImRhdGFUeXBlIiwiZGVsZXRlTWFwU2xpZGVzIiwiY29udGVudFR5cGUiLCJkb25lIl0sIm1hcHBpbmdzIjoiQUFFQSxTQUFTQSxTQUFTQyxHQUVqQixNQUFNQyxHQUNMQyxVQUFXLEdBQ1hDLGVBQWdCLG1CQUNoQkMsa0JBQW1CLG1CQUNuQkMsWUFBYSxhQUNiQyxlQUFnQix1QkFJakJDLEtBQUtQLFFB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akYsR0FBSXlHLEVBQVFmLFVBQVdrQixFQUFlbEQsT0FBUXFELE1BTXhEL0MsZUFBZXhFLFVBQVV5SCxnQkFBa0IsU0FBVUwsRUFBZUgsR0FFbkVySCxFQUFFc0gsTUFFREMsT0FBUSxTQUNSckUsT0FBUW5ELEtBQUtQLFFBQVE0SCxtQkFBbUJJLEtBQWlCSCxJQUN6RFMsWUFBYSxxQkFHWkMsS0FBSyIsImZpbGUiOiJzdG9yeW1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgJCwgU2xpZGVJY29uKi9cblxuZnVuY3Rpb24gU2xpZGVCYXIob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblx0XHRtYXhTbGlkZXM6IDEwLFxuXHRcdHNsaWRlSWNvblJlZ2V4OiAvXnNsaWRlLWljb24tXFx3KyQvLFxuXHRcdHNsaWRlc0NvbnRhaW5lcklkOiBcIiNzbGlkZXNDb250YWluZXJcIixcblx0XHRzbGlkZUxpc3RJZDogXCIjc2xpZGVMaXN0XCIsXG5cdFx0YWRkU2xpZGVCdXR0b246IFwiI3N0b3J5bWFwX2FkZF9zbGlkZVwiLFxuXG5cdH07XG5cblx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIF9kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblx0dGhpcy5hZGRTbGlkZSgpO1xuXG59XG5cblNsaWRlQmFyLnByb3RvdHlwZS5hZGRFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0JChzZWxmLm9wdGlvbnMuYWRkU2xpZGVCdXR0b24pLmNsaWNrKCgpID0+IHtcblxuXHRcdHNlbGYuYWRkU2xpZGUoKTtcblxuXHR9KTtcblxufTtcblxuU2xpZGVCYXIucHJvdG90eXBlLmFkZFNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdGNvbnN0IHNsaWRlID0gbmV3IFNsaWRlSWNvbigpO1xuXHRzbGlkZS5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpO1xuXHQkKHNsaWRlKS5vbihcIlNsaWRlOmRlbGV0ZWRcIiwgKGV2ZW50LCBpZCkgPT4ge1xuXG5cdFx0c2VsZi5yZW1vdmVTbGlkZShpZCk7XG5cblx0fSk7XG5cdCQodGhpcy5vcHRpb25zLnNsaWRlc0NvbnRhaW5lcklkKS5zY3JvbGxUb3AoTWF0aC5tYXgoMCwgJCh0aGlzLm9wdGlvbnMuc2xpZGVMaXN0SWQpLmhlaWdodCgpIC1cblx0XHQkKHRoaXMub3B0aW9ucy5zbGlkZUxpc3RJZCkucGFyZW50KCkuaGVpZ2h0KCkpKTtcblx0c2xpZGUuY2xpY2tlZCgpO1xuXG59O1xuXG5TbGlkZUJhci5wcm90b3R5cGUucmVtb3ZlU2xpZGUgPSBmdW5jdGlvbiAoaWQpIHtcblxuXHQkKGAke3RoaXMub3B0aW9ucy5zbGlkZUxpc3RJZH0gbGk6bnRoLWNoaWxkKCR7aWQgKyAxfSlgKS5yZW1vdmUoKTtcblxufTtcbiIsIi8qIGdsb2JhbCAkLCBfKi9cblxuZnVuY3Rpb24gU2xpZGVJY29uKG9wdGlvbnMpIHtcblxuXHRjb25zdCBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR0ZXh0OiBcIlwiLFxuXHRcdHRlbXBsYXRlSWQ6IFwiI3N0b3J5bWFwX3NsaWRlX3RlbXBsYXRlXCIsXG5cdFx0c2xpZGVDbGFzczogXCIuc2xpZGVcIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQodGhpcy5vcHRpb25zLnRlbXBsYXRlSWQpLmh0bWwoKS50cmltKCkpO1xuXHR0aGlzLnNsaWRlRE9NRWxlbSA9ICQodGhpcy50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMpKTtcblx0dGhpcy5kZWxldGVET01FbGVtID0gJChcIjxhIGNsYXNzPVxcXCJjbG9zZVxcXCIgaHJlZj1cXFwiamF2YXNjcmlwdDpcXFwiPiZuYnNwOzwvYT5cIik7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxufVxuXG5TbGlkZUljb24ucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRzZWxmLnNsaWRlRE9NRWxlbS5jbGljaygoKSA9PiB7XG5cblx0XHRzZWxmLmNsaWNrZWQoKTtcblxuXHR9KTtcblx0c2VsZi5kZWxldGVET01FbGVtLmNsaWNrKCgpID0+IHtcblxuXHRcdHNlbGYuZGVsZXRlQnV0dG9uUHJlc3NlZCgpO1xuXG5cdH0pO1xuXG59O1xuXG5TbGlkZUljb24ucHJvdG90eXBlLmNsaWNrZWQgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0Y29uc3QgY3VycmVudFNsaWRlSW5kZXggPSAkKHNlbGYub3B0aW9ucy5zbGlkZUNsYXNzKS5pbmRleChzZWxmLnNsaWRlRE9NRWxlbSk7XG5cdCQoXCI6Zm9jdXNcIikuYmx1cigpOyAvLyBmb3JjZSBjaGFuZ2UgZXZlbnQhXG5cblx0JChgJHt0aGlzLm9wdGlvbnMuc2xpZGVDbGFzc30uc2VsZWN0ZWRgKS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpO1xuXHQkKHNlbGYuc2xpZGVET01FbGVtKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuXG5cdCQoc2VsZikudHJpZ2dlcihcIlNsaWRlOnNlbGVjdGVkXCIsIFtjdXJyZW50U2xpZGVJbmRleF0pO1xuXG5cdHJldHVybiBmYWxzZTtcblxufTtcblxuU2xpZGVJY29uLnByb3RvdHlwZS5kZWxldGVCdXR0b25QcmVzc2VkID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdGNvbnN0IGN1cnJlbnRTbGlkZUluZGV4ID0gJChzZWxmLm9wdGlvbnMuc2xpZGVDbGFzcykuaW5kZXgoc2VsZi5zbGlkZURPTUVsZW0pO1xuXHQkKHNlbGYpLnRyaWdnZXIoXCJTbGlkZTpkZWxldGVkXCIsIFtjdXJyZW50U2xpZGVJbmRleF0pO1xuXG59O1xuXG5TbGlkZUljb24ucHJvdG90eXBlLmFwcGVuZFRvID0gZnVuY3Rpb24gKGlkKSB7XG5cblx0dGhpcy5zbGlkZURPTUVsZW0uYXBwZW5kVG8oaWQpO1xuXHR0aGlzLmRlbGV0ZURPTUVsZW0uYXBwZW5kVG8odGhpcy5zbGlkZURPTUVsZW0pO1xuXG59O1xuIiwiLyogZ2xvYmFsICQqL1xuXG5mdW5jdGlvbiBTbGlkZUluZm8oaW5kZXgsIG9wdGlvbnMpIHtcblxuXHRjb25zdCBfZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0XHR1cmxMb2FkQnV0dG9uSWQ6IFwiI3N0b3J5bWFwX2xvYWRcIixcblx0XHR1cmxDbGVhckJ1dHRvbklkOiBcIiNzdG9yeW1hcF91bmxvYWRcIixcblx0XHRpbmZvQnV0dG9uSWQ6IFwiI29icmlyX21lbnVcIixcblx0XHRzYXZlU2xpZGVCdXR0b25JZDogXCIjc3RvcnltYXBfc2F2ZV9zbGlkZVwiLFxuXHRcdHVybElucHV0SWQ6IFwiI3VybE1hcFwiLFxuXHRcdHRpdG9sSW5wdXRJZDogXCIjdXJsTWFwXCIsXG5cdFx0dGV4dElucHV0SWQ6IFwiI3N1bW1lcm5vdGVcIixcblx0XHRpRnJhbWVJZDogXCIjaW5zdGFtYXBzTWFwXCIsXG5cdFx0aUZyYW1lQ29udGFpbmVySWQ6IFwiI21hcGFGcmFtZVwiLFxuXHRcdGRhdGFDb250YWluZXJJZDogXCIjZGF0YVNlY3Rpb25cIixcblx0XHRkZWZhdWx0VXJsOiBcImh0dHBzOi8vd3d3Lmluc3RhbWFwcy5jYXQvZ2VvY2F0d2ViL3Zpc29yLmh0bWxcIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMuYWRkRXZlbnRzKCk7XG5cblx0JCh0aGlzLm9wdGlvbnMudGV4dElucHV0SWQpLnN1bW1lcm5vdGUoKTtcblxufVxuXG5TbGlkZUluZm8ucHJvdG90eXBlLmFkZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBzZWxmID0gdGhpcztcblxuXHQkKHNlbGYub3B0aW9ucy51cmxMb2FkQnV0dG9uSWQpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0Y29uc3QgdXJsID0gJChzZWxmLm9wdGlvbnMudXJsSW5wdXRJZCkudmFsKCk7XG5cdFx0JChzZWxmLm9wdGlvbnMuaUZyYW1lSWQpLmF0dHIoXCJzcmNcIiwgdXJsKTtcblxuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy51cmxDbGVhckJ1dHRvbklkKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdCQoc2VsZi5vcHRpb25zLnVybElucHV0SWQpLnZhbChcIlwiKTtcblx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVJZCkuYXR0cihcInNyY1wiLCBzZWxmLm9wdGlvbnMuZGVmYXVsdFVybCk7XG5cblx0fSk7XG5cblx0JChzZWxmLm9wdGlvbnMuaW5mb0J1dHRvbklkKS5vbihcImNsaWNrXCIsICgpID0+IHtcblxuXHRcdGlmICgkKHNlbGYub3B0aW9ucy5pRnJhbWVDb250YWluZXJJZCkuaGFzQ2xhc3MoXCJleHBhbmRlZFwiKSkge1xuXG5cdFx0XHQkKHNlbGYub3B0aW9ucy5pRnJhbWVDb250YWluZXJJZCkucmVtb3ZlQ2xhc3MoXCJleHBhbmRlZFwiKTtcblx0XHRcdCQoc2VsZi5vcHRpb25zLmRhdGFDb250YWluZXJJZCkuaGlkZSgpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0JChzZWxmLm9wdGlvbnMuaUZyYW1lQ29udGFpbmVySWQpLmFkZENsYXNzKFwiZXhwYW5kZWRcIik7XG5cdFx0XHQkKHNlbGYub3B0aW9ucy5kYXRhQ29udGFpbmVySWQpLnNob3coKTtcblxuXHRcdH1cblxuXHR9KTtcblxuXHQkKHNlbGYub3B0aW9ucy5zYXZlU2xpZGVCdXR0b25JZCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJTbGlkZUluZm86c2F2ZVNsaWRlUHJlc3NlZFwiKTtcblxuXHR9KTtcblxufTtcblxuU2xpZGVJbmZvLnByb3RvdHlwZS5nZXRVUkwgPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbCgpO1xuXG59O1xuXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldFRpdG9sID0gZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiAkKHRoaXMub3B0aW9ucy50aXRvbElucHV0SWQpLnZhbCgpO1xuXG59O1xuXG5TbGlkZUluZm8ucHJvdG90eXBlLmdldERlc2NyaXBjaW8gPSBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuICQodGhpcy5vcHRpb25zLnRleHRJbnB1dElkKS5zdW1tZXJub3RlKFwiY2xpY2tcIik7XG5cbn07XG5cblNsaWRlSW5mby5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG5cblx0JCh0aGlzLm9wdGlvbnMuaUZyYW1lSWQpLnNyYyA9IFwiaHR0cDovL3d3dy5pbnN0YW1hcHMuY2F0L2dlb2NhdHdlYi92aXNvci5odG1sXCI7XG5cdCQodGhpcy5vcHRpb25zLnVybElucHV0SWQpLnZhbChcIlwiKTtcblx0JCh0aGlzLm9wdGlvbnMudGl0b2xJbnB1dElkKS52YWwoXCJcIik7XG5cdCQodGhpcy5vcHRpb25zLnRleHRJbnB1dElkKS5zdW1tZXJub3RlKFwiY2xpY2tcIiwgXCJcIik7XG5cbn07XG4iLCIvKiBnbG9iYWwgJCwgYWxlcnQsIFNsaWRlQmFyLCBTbGlkZUluZm8sIFN0b3J5TWFwU2VydmVyKi9cblxuZnVuY3Rpb24gU3RvcnlNYXAob3B0aW9ucykge1xuXG5cdGNvbnN0IF9kZWZhdWx0T3B0aW9ucyA9IHtcblxuXHRcdGxhbmd1YWdlOiBcImVuXCIsXG5cdFx0c2xpZGVJY29uUmVnZXg6IC9ec2xpZGUtaWNvbi1cXHcrJC8sXG5cdFx0c2xpZGVUZW1wbGF0ZTogXCIjc3RvcnltYXBfc2xpZGVfdGVtcGxhdGVcIixcblx0XHRtYXhTbGlkZXM6IDEwLFxuXHRcdHN0cmluZ3M6IHtcblx0XHRcdGVuOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJNYXhpbXVtIG51bWJlciBvZiBzbGlkZXMgcmVhY2hlZFwiLFxuXHRcdFx0fSxcblx0XHRcdGNhOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJNw6B4aW0gbsO6bWVybyBkZSBzbGlkZXMgYXNzb2xpdFwiLFxuXHRcdFx0fSxcblx0XHRcdGVzOiB7XG5cdFx0XHRcdG1heFNsaWRlczogXCJIYXMgbGxlZ2FkbyBhbCBuw7ptZXJvIG3DoXhpbW8gZGUgc2xpZGVzXCIsXG5cdFx0XHR9LFxuXHRcdH0sXG5cblx0fTtcblxuXHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgX2RlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuXHR0aGlzLl9jdXJyZW50U2xpZGVJbmRleCA9IC0xO1xuXHR0aGlzLl9zdG9yeU1hcERhdGEgPSBudWxsO1xuXHR0aGlzLnNsaWRlcyA9IG51bGw7XG5cdHRoaXMuaWRFZGl0b3IgPSBcIlwiO1xuXHR0aGlzLmlkU3RvcnlNYXAgPSBcIlwiO1xuXHR0aGlzLnNsaWRlQmFyID0gbmV3IFNsaWRlQmFyKCk7XG5cdHRoaXMuc2xpZGVJbmZvUGFuZWwgPSBuZXcgU2xpZGVJbmZvKCk7XG5cdHRoaXMuc2VydmVyID0gbmV3IFN0b3J5TWFwU2VydmVyKCk7XG5cblx0dGhpcy5hZGRFdmVudHMoKTtcblxufVxuXG5TdG9yeU1hcC5wcm90b3R5cGUuYWRkRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuXG5cdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdCQoc2VsZi5zbGlkZUluZm9QYW5lbCkub24oXCJTbGlkZUluZm86c2F2ZVNsaWRlUHJlc3NlZFwiLCAoKSA9PiB7XG5cblx0XHRzZWxmLnNhdmVTbGlkZSgpO1xuXG5cdH0pO1xuXG59O1xuXG5TdG9yeU1hcC5wcm90b3R5cGUuc2F2ZVNsaWRlID0gZnVuY3Rpb24gKCkge1xuXG5cdC8vIEFnYWZhciBsZXMgZGFkZXMgZGUgbCdzbGlkZUluZm9QYW5lbCBpIGd1YXJkYXItbGVzIGEgbCdvYmplY3RlIGRlIGwnc2xpZGVcblx0Y29uc3Qgc2xpZGUgPSB7XG5cdFx0aWQ6IHRoaXMuc2xpZGVzLmxlbmd0aCxcblx0XHR1cmxfbWFwYTogdGhpcy5zbGlkZUluZm9QYW5lbC5nZXRVUkwoKSxcblx0XHR0aXRvbDogdGhpcy5zbGlkZUluZm9QYW5lbC5nZXRUaXRvbCgpLFxuXHRcdGRlc2NyaXBjaW86IHRoaXMuc2xpZGVJbmZvUGFuZWwuZ2V0RGVzY3JpY2lvKCksXG5cdH07XG5cblx0dGhpcy5zbGlkZXMucHVzaChzbGlkZSk7XG5cblx0Ly8gR3VhcmRlbSBsZXMgZGFkZXMgYWwgc2Vydmlkb3Jcblx0dGhpcy5zYXZlKCkudGhlbigoKSA9PiB7XG5cblx0XHR0aGlzLnNsaWRlSW5mb1BhbmVsLnJlc2V0KCk7XG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5hZGRTbGlkZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRjb25zdCBkZWZhdWx0RGF0YSA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMuc2xpZGVEYXRhKTtcblx0Y29uc3QgbiA9IHRoaXMuX3NsaWRlcy5sZW5ndGg7XG5cdGlmIChuID09PSB0aGlzLm9wdGlvbnMubWF4U2xpZGVzKSB7XG5cblx0XHQvL2FsZXJ0KHRoaXMub3B0aW9ucy5zdHJpbmdzW3RoaXMub3B0aW9ucy5sYW5ndWFnZV0ubWF4U2xpZGVzKTtcblxuXHR9XHRlbHNlIHtcblxuXHRcdHRoaXMuX3NsaWRlcy5wdXNoKGRlZmF1bHREYXRhKTtcblx0XHQkKHRoaXMpLnRyaWdnZXIoXCJTdG9yeU1hcDpjaGFuZ2VkXCIpO1xuXHRcdGNvbnN0IHNsaWRlID0gdGhpcy5zbGlkZUJhci5hZGRTbGlkZShkZWZhdWx0RGF0YSk7XG5cdFx0c2xpZGUub24oXCJTbGlkZUJhcjpzbGlkZVNlbGVjdGVkXCIsIHRoaXMuX3NsaWRlU2VsZWN0ZWQpO1xuXHRcdHNsaWRlLm9uKFwiU2xpZGVCYXI6ZGVsZXRlU2xpZGVQcmVzc2VkXCIsIHRoaXMuX3NsaWRlRGVsZXRlUHJlc3NlZCk7XG5cblx0fVxuXG59O1xuXG5TdG9yeU1hcC5wcm90b3R5cGUuX3NsaWRlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZXZlbnQsIGluZGV4KSB7XG5cblx0aWYgKHRoaXMuc2xpZGVzICE9IG51bGwpIHtcblxuXHRcdGNvbnN0IGN1cnJlbnRTbGlkZSA9IHRoaXMuc2xpZGVzW2luZGV4XTtcblxuXHRcdC8vIFRPRE86IFBhc3NhciBhIGwnU2xpZGVJbmZvXG5cdFx0YWxlcnQoY3VycmVudFNsaWRlKTtcblxuXHR9XG5cbn07XG5cblN0b3J5TWFwLnByb3RvdHlwZS5fc2xpZGVEZWxldGVQcmVzc2VkID0gZnVuY3Rpb24gKGV2ZW50LCBpbmRleCkge1xuXG5cdGNvbnN0IGRhdGEgPSB0aGlzLl9zbGlkZXNbaW5kZXhdO1xuXHRjb25zdCBzbGlkZVRpdGxlID0gKChkYXRhLnRleHQpID8gKGRhdGEudGV4dC5oZWFkbGluZSB8fCBcIih1bnRpdGxlZClcIikgOiBcIih1bnRpdGxlZClcIik7XG5cblx0dGhpcy5zaG93Q29uZmlybShgRGVsZXRlIFwiJHtzbGlkZVRpdGxlfVwiIHNsaWRlP2AsIHRoaXMub3B0aW9ucy5zbGlkZUVsZW0sIGluZGV4KTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG5cblx0Y29uc3QgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG5cblx0aWYgKHRoaXMuaWRTdG9yeU1hcCAhPT0gXCJcIikge1xuXG5cdFx0aWYgKHRoaXMuaWRFZGl0b3IgPT09IFwiXCIpIHtcblxuXHRcdFx0Ly8gamEgZXhpc3RlaXggbCdzdG9yeW1hcCBjcmVhdC4gRW50cmVtIGVuIG1vZGUgZWRpY2nDs1xuXHRcdFx0dGhpcy5zZXJ2ZXIuZWRpdE1hcFNsaWRlcyh0aGlzLmlkU3RvcnlNYXApLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcblxuXHRcdFx0XHR0aGlzLmlkRWRpdG9yID0gcmVzdWx0cy5pZF9lZGl0b3I7XG5cblx0XHRcdFx0dGhpcy5zZXJ2ZXIudXBkYXRlTWFwU2xpZGVzKHRoaXMuaWRFZGl0b3IsIHRoaXMuaWRTdG9yeU1hcCxcblx0XHRcdFx0XHRKU09OLnN0cmluZ2lmeSh0aGlzLnNsaWRlcykpLnRoZW4oXG5cblx0XHRcdFx0XHQoKSA9PiB7XG5cblx0XHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0KCkgPT4ge1xuXG5cdFx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblxuXHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0KTtcblxuXHRcdFx0fSxcblx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoKTtcblxuXHRcdFx0fSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHR0aGlzLnNlcnZlci51cGRhdGVNYXBTbGlkZXModGhpcy5pZEVkaXRvciwgdGhpcy5pZFN0b3J5TWFwLCBKU09OLnN0cmluZ2lmeSh0aGlzLnNsaWRlcykpLnRoZW4oXG5cblx0XHRcdFx0KCkgPT4ge1xuXG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSgpO1xuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdCgpID0+IHtcblxuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdCgpO1xuXG5cdFx0XHRcdH0sXG5cblx0XHRcdCk7XG5cblx0XHR9XG5cblx0fSBlbHNlIHtcblxuXHRcdC8vIG5vIGV4aXN0ZWl4IGwnc3RvcnltYXAuIEVuIGNyZWVtIHVuIGRlIG5vdSBhbWIgbGEgaW5mbyBjb3JyZXNwb25lbnRcblx0XHR0aGlzLnNlcnZlci5uZXdNYXBTbGlkZXMoSlNPTi5zdHJpbmdpZnkodGhpcy5zbGlkZXMpKS50aGVuKChyZXN1bHRzKSA9PiB7XG5cblx0XHRcdHRoaXMuaWRTdG9yeU1hcCA9IHJlc3VsdHMuaWQ7XG5cdFx0XHR0aGlzLmlkRWRpdG9yID0gcmVzdWx0cy5pZF9lZGl0b3I7XG5cdFx0XHRkZWZlcnJlZC5yZXNvbHZlKCk7XG5cblx0XHR9LFxuXHRcdCgpID0+IHtcblxuXHRcdFx0ZGVmZXJyZWQucmVqZWN0KCk7XG5cblx0XHR9KTtcblxuXHR9XG5cblx0cmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoaWQpIHtcblxuXHR0aGlzLmlkRWRpdG9yID0gaWQ7XG5cblx0dGhpcy5zZXJ2ZXIuZWRpdE1hcFNsaWRlcyhpZCkudGhlbigocmVzdWx0cykgPT4ge1xuXG5cdFx0dGhpcy5zbGlkZXMgPSBKU09OLnBhcnNlKHJlc3VsdHMuc2xpZGVzKTtcblxuXHR9KTtcblxufTtcblxuU3RvcnlNYXAucHJvdG90eXBlLmxvYWRWaXNvciA9IGZ1bmN0aW9uIChpZCkge1xuXG5cdHRoaXMuaWRTdG9yeU1hcCA9IGlkO1xuXG5cdHRoaXMuc2VydmVyLmdldE1hcFNsaWRlcyhpZCkudGhlbigocmVzdWx0cykgPT4ge1xuXHRcdHRoaXMuc2xpZGVzID0gSlNPTi5wYXJzZShyZXN1bHRzLnNsaWRlcyk7XG5cdFx0Y29uc29sZS5kZWJ1Zyh0aGlzLnNsaWRlcyk7XG5cdH0pO1xuXG59O1xuLypcblN0b3J5TWFwLnByb3RvdHlwZS5zaG93X2NvbmZpcm0gPSBmdW5jdGlvbiAoKSB7ICAobXNnLCBzbGlkZUVsZW0sIHNsaWRlSW5kZXgpIHtcblxuXHRjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlhbG9nX2RlbGV0ZV9zbGlkZVwiKTtcblx0JChcIiNtc2dcIikuaHRtbChgPHNwYW4+JHttc2d9PC9zcGFuPmApO1xuXHRtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG5cdCQoXCIjZGlhbG9nX2RlbGV0ZV9zbGlkZSAuYnRuLWRlZmF1bHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cblx0XHRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlhbG9nX2RlbGV0ZV9zbGlkZVwiKTtcblx0XHRtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0XHRjb25zdCBoZWlnaHQgPSAkKFwiI3NsaWRlc1wiKS5oZWlnaHQoKSAtIHNsaWRlRWxlbS5vdXRlckhlaWdodCh0cnVlKTtcblxuXHRcdC8vIERlbGV0ZSB0aGUgc2xpZGUgZGF0YVxuXHRcdF9zbGlkZXMuc3BsaWNlKHNsaWRlSW5kZXgsIDEpO1xuXHRcdHN0b3J5bWFwX2RpcnR5KDEpO1xuXG5cdFx0Ly8gUmVtb3ZlIERPTSBlbGVtZW50XG5cdFx0c2xpZGVFbGVtLnJlbW92ZSgpO1xuXG5cdFx0Ly8gQWRqdXN0IHNsaWRlIGNvbnRhaW5lciBoZWlnaHRcblx0XHQkKFwiI3NsaWRlc1wiKS5jc3MoXCJoZWlnaHRcIiwgYCR7aGVpZ2h0fXB4YCk7XG5cblx0XHRpZihfY3VycmVudF9zbGlkZV9pbmRleCA9PSAwKSB7XG5cblx0XHRcdC8vIFVwZGF0ZSBvdmVybGF5IHZpZXdcblx0XHQgICAvLyBfbWFwLnJlbW92ZU1hcmtlcihzbGlkZUluZGV4IC0gMSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHQvLyBSZXNldCBjdXJyZW50IHNsaWRlXG5cdFx0XHRpZihzbGlkZUluZGV4IDwgX2N1cnJlbnRfc2xpZGVfaW5kZXgpIHtcblxuXHRcdFx0XHRfY3VycmVudF9zbGlkZV9pbmRleC0tO1xuXHRcdFx0XHQvL3N0b3J5bWFwX2F1dG9fc2F2ZSgpO1xuXG5cdFx0XHR9IGVsc2UgaWYoc2xpZGVJbmRleCA9PSBfY3VycmVudF9zbGlkZV9pbmRleCkge1xuXG5cdFx0XHRcdGNvbnN0IG4gPSBNYXRoLm1pbihfY3VycmVudF9zbGlkZV9pbmRleCwgX3NsaWRlcy5sZW5ndGggLSAxKTtcblx0XHRcdFx0JChcIi5zbGlkZVwiKS5lcShuKS5jbGljaygpO1xuXG5cdFx0XHR9XG5cblx0XHR9XG5cblx0fSk7XG5cdFxuXHQkKFwiI2RpYWxvZ19kZWxldGVfc2xpZGUgLmNsb3NlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0bW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpYWxvZ19kZWxldGVfc2xpZGVcIik7XG5cdFx0bW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG5cdH0pO1xuXHRcblx0JChcIiNkaWFsb2dfZGVsZXRlX3NsaWRlIC5idG4tZGFuZ2VyXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG5cdFx0bW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpYWxvZ19kZWxldGVfc2xpZGVcIik7XG5cdFx0bW9kYWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG5cdH0pO1xuXG59OyovIiwiLyogZ2xvYmFsICQqL1xuXG5mdW5jdGlvbiBTdG9yeU1hcFNlcnZlcihvcHRpb25zKSB7XG5cblx0Y29uc3QgX2RlZmF1bHRPcHRpb25zID0ge1xuXG5cdFx0dXJsU3RvcnlNYXA6IFwiaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy9cIixcblxuXHR9O1xuXG5cdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBfZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG59XG5cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5nZXRNYXBTbGlkZXMgPSBmdW5jdGlvbiAoaWRNYXBhKSB7XG5cblx0Ly8gRXhhbXBsZTogaHR0cDovLzE3Mi43MC4xLjMyL3N0b3J5bWFwcy83NjhkZGM2MC02NmUyLTExZTctYWY1ZS0wOWFmZjAwNzIzMGRcblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiR0VUXCIsXG5cdFx0dXJsOiB0aGlzLm9wdGlvbnMudXJsU3RvcnlNYXAgKyBpZE1hcGEsXG5cblx0fSk7XG5cbn07XG5cblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5lZGl0TWFwU2xpZGVzID0gZnVuY3Rpb24gKGlkTWFwYUVkaXRpbmcpIHtcblxuXHQvLyBFeGFtcGxlOiBodHRwOi8vMTcyLjcwLjEuMzIvc3RvcnltYXBzL2VkaXQvNzZkMjFmMDAtNDhlMC00MjE2LWJiNTItODRhOGE0MWNjNmEyXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIkdFVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfWAsXG5cdFx0YXN5bmM6IGZhbHNlLFxuXG5cdH0pLnJlc3BvbnNlVGV4dDtcblxufTtcblN0b3J5TWFwU2VydmVyLnByb3RvdHlwZS5uZXdNYXBTbGlkZXMgPSBmdW5jdGlvbiAoanNvblNsaWRlcykge1xuXG5cdC8vIGh0dHA6Ly8xNzIuNzAuMS4zMi9zdG9yeW1hcHMvZWRpdC9cblx0cmV0dXJuICQuYWpheCh7XG5cblx0XHRtZXRob2Q6IFwiUE9TVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvYCxcblx0XHRkYXRhVHlwZTogXCJqc29uXCIsXG5cdFx0ZGF0YTogeyBpZDogMCwgaWRfZWRpdG9yOiAwLCBzbGlkZXM6IGpzb25TbGlkZXMgfSxcblxuXHR9KTtcblxufTtcblxuXG5TdG9yeU1hcFNlcnZlci5wcm90b3R5cGUudXBkYXRlTWFwU2xpZGVzID0gZnVuY3Rpb24gKGlkTWFwYUVkaXRpbmcsIGlkTWFwYSwganNvblNsaWRlcykge1xuXG5cdHJldHVybiAkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIlBVVFwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfWAsXG5cdFx0ZGF0YVR5cGU6IFwianNvblwiLFxuXHRcdGRhdGE6IHsgaWQ6IGlkTWFwYSwgaWRfZWRpdG9yOiBpZE1hcGFFZGl0aW5nLCBzbGlkZXM6IGpzb25TbGlkZXMgfSxcblxuXHR9KTtcblxufTtcblxuU3RvcnlNYXBTZXJ2ZXIucHJvdG90eXBlLmRlbGV0ZU1hcFNsaWRlcyA9IGZ1bmN0aW9uIChpZE1hcGFFZGl0aW5nLCBpZE1hcGEpIHtcblxuXHQkLmFqYXgoe1xuXG5cdFx0bWV0aG9kOiBcIkRFTEVURVwiLFxuXHRcdHVybDogYCR7dGhpcy5vcHRpb25zLnVybFN0b3J5TWFwfWVkaXQvJHtpZE1hcGFFZGl0aW5nfS8ke2lkTWFwYX1gLFxuXHRcdGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcblxuXHR9KVxuXHRcdC5kb25lKCgpID0+IHtcblxuXHRcdH0pO1xuXG59O1xuIl19
